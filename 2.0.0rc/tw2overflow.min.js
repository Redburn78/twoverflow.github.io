/*! tw2overflow.min.js@2.0.0rc | Licence: WTFPL */
define("Lockr",function(e,t){"use strict";return t.prefix="",t._getPrefixedKey=function(e,t){return(t=t||{}).noPrefix?e:this.prefix+e},t.set=function(e,t,i){var a=this._getPrefixedKey(e,i);try{localStorage.setItem(a,JSON.stringify({data:t}))}catch(e){}},t.get=function(e,t,i){var a,n=this._getPrefixedKey(e,i);try{a=JSON.parse(localStorage.getItem(n))}catch(e){a=localStorage[n]?{data:localStorage.getItem(n)}:null}return null===a?t:"object"==typeof a&&void 0!==a.data?a.data:t},t}(0,{})),function(e,t){var i=injector.get("$rootScope"),a=injector.get("transferredSharedDataService"),n=injector.get("modelDataService"),o=injector.get("socketService"),l=injector.get("routeProvider"),r=injector.get("eventTypeProvider"),s=injector.get("windowDisplayService"),c=injector.get("windowManagerService"),d=(injector.get("hotkeys"),injector.get("armyService")),u=injector.get("villageService"),g=injector.get("mapService"),_=injector.get("$filter"),p=(injector.get("$timeout"),injector.get("storageService"));define("two/eventQueue",function(){var e={},t={bind:function(t,i){e.hasOwnProperty(t)||(e[t]=[]),e[t].push(i)},trigger:function(t,i){e.hasOwnProperty(t)&&e[t].forEach(function(e){e.apply(this,i)})}};return t}),define("two/EventScope",["queues/EventQueue"],function(e){var t=function(e,t){if(void 0===e)throw new Error("EventScope: no windowId");this.windowId=e,this.onDestroy=t||function(){},this.listeners=[];var a=i.$on(r.WINDOW_CLOSED,(e,t)=>{t==="!"+this.windowId&&(this.destroy(),a())})};return t.prototype.register=function(t,a,n){n?this.listeners.push(i.$on(t,a)):(e.register(t,a),this.listeners.push(function(){e.unregister(t,a)}))},t.prototype.destroy=function(){this.listeners.forEach(e=>{e(),this.onDestroy()})},t}),define("two/utils",["helper/time"],function(e){var t={randomSeconds:function(e){var t=(e=parseInt(e,10))+e/2,i=e-e/2;return Math.round(Math.random()*(t-i)+i)},time2seconds:function(e){return(e=e.split(":"))[0]=60*parseInt(e[0],10)*60,e[1]=60*parseInt(e[1],10),e[2]=parseInt(e[2],10),e.reduce(function(e,t){return e+t})},emitNotif:function(e,t){var a="success"===e?r.MESSAGE_SUCCESS:r.MESSAGE_ERROR;i.$broadcast(a,{message:t})},genVillageLabel:function(e){return e.name+" ("+e.x+"|"+e.y+")"},isValidCoords:function(e){return/\s*\d{2,3}\|\d{2,3}\s*/.test(e)},isValidDateTime:function(e){return/^\s*([01][0-9]|2[0-3]):[0-5]\d:[0-5]\d(:\d{1,3})? (0[1-9]|[12][0-9]|3[0-1])\/(0[1-9]|1[0-2])\/\d{4}\s*$/.test(e)},fixDate:function(e){var t=e.split(" "),i=t[0],a=t[1].split("/");return i+" "+a[1]+"/"+a[0]+"/"+a[2]},guid:function(){return Math.floor(16777216*Math.random()).toString(16)},matchesElem:function(e,t){return!!$(e).parents(t).length},getTimeFromString:function(e,t){var i=e.trim().split(" "),a=i[0].split(":"),n=i[1].split("/"),o=a[0],l=a[1],r=a[2],s=a[3]||null,c=parseInt(n[0],10)-1,d=n[1],u=n[2];return(n=new Date(u,c,d,o,l,r,s)).getTime()+(t||0)},formatDate:function(e,t){return _("readableDateFilter")(e,null,i.GAME_TIMEZONE,i.GAME_TIME_OFFSET,t||"HH:mm:ss dd/MM/yyyy")},getTimeOffset:function(){return 1e3*e.gameDate().getTimezoneOffset()*60+i.GAME_TIME_OFFSET},xhrGet:function(e,t,i){if(!e)return!1;var a;i=i||"text",t=t||function(){},(a=new XMLHttpRequest).open("GET",e,!0),a.responseType=i,a.addEventListener("load",function(){t(a.response)},!1),a.send()},obj2selectOptions:function(e,t){var i,a,n=[];for(a in e)i={name:e[a].name,value:e[a].id},t&&(i.leftIcon=e[a].icon),n.push(i);return n}};return t}),define("two/ready",["conf/gameStates"],function(e){var t=function(o,l){l=l||["map"];var s=function(e){(l=l.filter(function(t){return t!==e})).length||o()},c={map:function(){if(a.getSharedData("MapController").isInitialized)return s("map");i.$on(r.MAP_INITIALIZED,function(){s("map")})},tribe_relations:function(){var e=n.getSelectedCharacter();if(e){var t=e.getTribeRelations();if(!e.getTribeId()||t)return s("tribe_relations")}var a=i.$on(r.TRIBE_RELATION_LIST,function(){a(),s("tribe_relations")})},initial_village:function(){if(n.getGameState().getGameState(e.INITIAL_VILLAGE_READY))return s("initial_village");i.$on(r.GAME_STATE_INITIAL_VILLAGE_READY,function(){s("initial_village")})},all_villages_ready:function(){if(n.getGameState().getGameState(e.ALL_VILLAGES_READY))return s("all_villages_ready");i.$on(r.GAME_STATE_ALL_VILLAGES_READY,function(){s("all_villages_ready")})}};if(!a.getSharedData("MapController"))return setTimeout(function(){t(o,l)},100);l.forEach(function(e){c[e]()})};return t}),require(["two/ready","Lockr"],function(e,t){e(function(){var e=n.getSelectedCharacter();t.prefix=e.getId()+"_twOverflow_"+e.getWorldId()+"-"})}),require(["helper/i18n","two/ready"],function(e,t){t(function(){var t,a,n;t={en_us:{common:{start:"Start",started:"Started",pause:"Pause",paused:"Paused",stop:"Stop",stopped:"Stopped",status:"Status",none:"None",info:"Information",settings:"Settings",others:"Others",village:"Village",villages:"Villages",building:"Building",buildings:"Buildings",level:"Level",registers:"Registers",filters:"Filters",add:"Add",waiting:"Waiting",attack:"Attack",support:"Support",relocate:"Transfer",activate:"Enable",deactivate:"Disable",units:"Units",officers:"Officers",origin:"Origin",target:"Target",save:"Save",logs:"Logs",headquarter:"Headquarters",barracks:"Barracks",tavern:"Tavern",hospital:"Hospital",preceptory:"Hall of Orders",chapel:"Chapel",church:"Church",academy:"Academy",rally_point:"Rally Point",statue:"Statue",market:"Market",timber_camp:"Timber Camp",clay_pit:"Clay Pit",iron_mine:"Iron Mine",farm:"Farm",warehouse:"Warehouse",wall:"Wall",spear:"Spearman",sword:"Swordsman",axe:"Axe Fighter",archer:"Archer",light_cavalry:"Light Cavalry",mounted_archer:"Mounted Archer",heavy_cavalry:"Heavy Cavalry",ram:"Ram",catapult:"Catapult",doppelsoldner:"Berserker",trebuchet:"Trebuchet",snob:"Nobleman",knight:"Paladin","no-results":"No results...",selected:"Selected",now:"Now",costs:"Costs",duration:"Duration",points:"Points",player:"Player",players:"Players",next_features:"Next features",misc:"Miscellaneous",colors:"Colors",reset:"Reset",here:"here",disabled:"— Disabled —",cancel:"Cancel",actions:"Actions",remove:"Remove"}},pl_pl:{common:{start:"Start",started:"Uruchomiony",pause:"Pauza",paused:"Wstrzymany",stop:"Zatrzymany",stopped:"Zatrzymany",status:"Status",none:"Żaden",info:"Informacje",settings:"Ustawienia",others:"Inne",village:"Wioska",villages:"Wioski",building:"Budynek",buildings:"Budynki",level:"Poziom",registers:"Rejestry",filters:"Filtry",add:"Dodaj",waiting:"Oczekujące",attack:"Atak",support:"Wsparcie",relocate:"Przeniesienie",activate:"Włącz",deactivate:"Wyłącz",units:"Jednostki",officers:"Oficerowie",origin:"Źródło",target:"Cel",save:"Zapisz",logs:"Logi",headquarter:"Ratusz",barracks:"Koszary",tavern:"Tawerna",hospital:"Szpital",preceptory:"Komturia",chapel:"Kaplica",church:"Kościół",academy:"Akademia",rally_point:"Plac",statue:"Piedestał",market:"Rynek",timber_camp:"Tartak",clay_pit:"Kopalnia gliny",iron_mine:"Huta żelaza",farm:"Farma",warehouse:"Magazyn",wall:"Mur",spear:"Pikinier",sword:"Miecznik",axe:"Topornik",archer:"Łucznik",light_cavalry:"Lekki kawalerzysta",mounted_archer:"Łucznik konny",heavy_cavalry:"Ciężki kawalerzysta",ram:"Taran",catapult:"Katapulta",doppelsoldner:"Berserker",trebuchet:"Trebusz",snob:"Szlachcic",knight:"Rycerz","no-results":"Brak wyników...",selected:"Wybrana",now:"Teraz",costs:"Koszty",duration:"Czas trwania",points:"Punkty",player:"Gracz",players:"Gracze",next_features:"Następne funkcje",misc:"Różne",colors:"Kolory",reset:"Reset",here:"here",disabled:"— Wyłączony —",cancel:"Cancel",actions:"Actions",remove:"Remove"}},pt_br:{common:{start:"Iniciar",started:"Iniciado",pause:"Pausar",paused:"Pausado",stop:"Parar",stopped:"Parado",status:"Status",none:"Nenhum",info:"Informações",settings:"Configurações",others:"Outros",village:"Aldeia",villages:"Aldeias",building:"Edifício",buildings:"Edifícios",level:"Nível",registers:"Registros",filters:"Filtros",add:"Adicionar",waiting:"Em espera",attack:"Ataque",support:"Apoio",relocate:"Transferência",activate:"Ativar",deactivate:"Desativar",units:"Unidades",officers:"Oficiais",origin:"Origem",target:"Alvo",save:"Salvar",logs:"Eventos",headquarter:"Edifício Principal",barracks:"Quartel",tavern:"Taverna",hospital:"Hospital",preceptory:"Salão das Ordens",chapel:"Capela",church:"Igreja",academy:"Academia",rally_point:"Ponto de Encontro",statue:"Estátua",market:"Mercado",timber_camp:"Bosque",clay_pit:"Poço de Argila",iron_mine:"Mina de Ferro",farm:"Fazenda",warehouse:"Armazém",wall:"Muralha",spear:"Lanceiro",sword:"Espadachim",axe:"Viking",archer:"Arqueiro",light_cavalry:"Cavalaria Leve",mounted_archer:"Arqueiro Montado",heavy_cavalry:"Cavalaria Pesada",ram:"Aríete",catapult:"Catapulta",doppelsoldner:"Berserker",trebuchet:"Trabuco",snob:"Nobre",knight:"Paladino","no-results":"Sem resultados...",selected:"Selecionado",now:"Agora",costs:"Custos",duration:"Duração",points:"Pontos",player:"Jogador",players:"Jogadores",next_features:"Próximas funcionalidades",misc:"Diversos",colors:"Cores",reset:"Resetar",here:"aqui",disabled:"— Desativado —",cancel:"Cancelar",actions:"Ações",remove:"Remover"}}},a=i.loc.ale,n=a in t?t[a]:t.en_us,e.setJSON(n)})}),define("two/attackView",["two/queue","two/eventQueue","two/ready","models/CommandModel","conf/unitTypes","Lockr","helper/math","helper/mapconvert","struct/MapData"],function(e,t,i,a,s,c,d,u,g){for(var _={ORIGIN_VILLAGE:"origin_village_name",COMMAND_TYPE:"command_type",TARGET_VILLAGE:"target_village_name",TIME_COMPLETED:"time_completed",COMMAND_PROGRESS:"command_progress",ORIGIN_CHARACTER:"origin_character_name"},p={ATTACK:"attack",SUPPORT:"support",RELOCATE:"relocate"},m={COMMAND_TYPES:"commandTypes",VILLAGE:"village",INCOMING_UNITS:"incomingUnits"},E=[s.LIGHT_CAVALRY,s.HEAVY_CAVALRY,s.AXE,s.SWORD,s.RAM,s.SNOB,s.TREBUCHET],f={},v=0;v<E.length;v++)f[E[v]]=!0;var T,h={},b=injector.get("overviewService"),A=[],S={},I={},R={reverse:!1,column:_.COMMAND_PROGRESS},O=function(){var e,t,i=[m.COMMAND_TYPES],a=n.getSelectedVillage().getId(),o={};for(e=0;e<i.length;e++)for(t in S[i[e]])if(o[i[e]]||(o[i[e]]=[]),S[i[e]][t])switch(i[e]){case m.COMMAND_TYPES:"ATTACK"===t?o[i[e]].push(p.ATTACK):"SUPPORT"===t?o[i[e]].push(p.SUPPORT):"RELOCATE"===t&&o[i[e]].push(p.RELOCATE)}(I=o).village=S[m.VILLAGE]?[a]:[]},w=function(){G()},L=function(e,i){t.trigger("attackView/commandCancelled",[i.id||i.command_id])},C=function(e,i){for(var a=0;a<A.length;a++)A[a].command_id===i.command_id&&A.splice(a,1);t.trigger("attackView/commandIgnored",[i.command_id])},x=function(e,i){for(var a=0;a<A.length;a++)A[a].target_village_id===i.village_id&&(A[a].target_village_name=i.name,A[a].targetVillage.name=i.name);t.trigger("attackView/villageRenamed",[i])},N=function(e,t){I[m.VILLAGE].length&&(I[m.VILLAGE]=[t],G())},y=function(){c.set("attackView-filters",S),G()},M=function(){G()},D=function(e){A=e.commands;for(var i=0;i<A.length;i++)b.formatCommand(A[i]),A[i].slowestUnit=P(A[i]);A=A.filter(function(e){return S[m.INCOMING_UNITS][e.slowestUnit]}),t.trigger("attackView/commandsLoaded",[A])},G=function(){var e=T.getCommandListModel().getIncomingCommands().length,t=e>25?e:25;o.emit(l.OVERVIEW_GET_INCOMING,{count:t,offset:0,sorting:R.column,reverse:R.reverse?1:0,groups:[],command_types:I[m.COMMAND_TYPES],villages:I[m.VILLAGE]},D)},P=function(t){var i=t.model.duration,a={},n={x:t.origin_x,y:t.origin_y},o={x:t.target_x,y:t.target_y},l=[];return E.forEach(function(i){a[i]=1,l.push({unit:i,duration:e.getTravelTime(n,o,a,t.command_type,{})})}),(l=l.map(function(e){return e.duration=Math.abs(e.duration-i),e}).sort(function(e,t){return e.duration-t.duration}))[0].unit},k=function(e,t){return e.sort(function(e,i){return d.actualDistance(t,e)-d.actualDistance(t,i)})},U=function(e,t){if(g.hasTownDataInChunk(e.x,e.y)){var i,a,o,l,r,s=g.loadTownData(e.x,e.y,25,25,25),c=[],d=[],_=n.getSelectedCharacter().getTribeId(),p=n.getSelectedCharacter().getId();if(s.forEach(function(e){for(l in e.data)for(r in e.data[l])c.push(e.data[l][r])}),a=c.filter(function(e){return null===e.character_id&&e.id>0}),o=c.filter(function(t){return t.character_id===p&&e.id!==t.id}),_&&(d=c.filter(function(e){return _&&e.tribe_id===_})),a.length)i=k(a,e);else if(o.length)i=k(o,e);else{if(!d.length)return t(!1);i=k(d,e)}return t(i[0])}var m=u.scaledGridCoordinates(e.x,e.y,25,25,25),E=0;g.loadTownDataAsync(e.x,e.y,25,25,function(){++E===m.length&&U(e,t)})};return{init:function(){Locale.create("attackView",{en:{title:"AttackView","filters.tooltip.current-only":"Current village only","filters.types":"Types","filters.tooltip.show-attacks":"Show attacks","filters.tooltip.show-supports":"Show supports","filters.tooltip.show-relocations":"Show relocations","filters.incoming-units":"Incoming Units","tooltip.command-type":"Command Type","tooltip.slowest-unit":"Slowest Unit","command-type":"CT","slowest-unit":"SU",actions:"Actions","no-incoming":"No commands incoming.","commands.tooltip.copy-arrival":"Copy arrival date.","commands.tooltip.copy-back":"Copy backtime date.","commands.tooltip.set-remove":"Set a CommandQueue to remove all troops before the attack hit."},pl:{title:"Strażnik","filters.tooltip.current-only":"Tylko aktywna wioska","filters.types":"Rodzaj","filters.tooltip.show-attacks":"Pokaż ataki","filters.tooltip.show-supports":"Pokaż wsparcia","filters.tooltip.show-relocations":"Pokaż przeniesienia","filters.incoming-units":"Nadchodzące jednostki","tooltip.command-type":"Rodzaj","tooltip.slowest-unit":"Najwolniejsza jednostka","command-type":"Rodzaj","slowest-unit":"Co?",actions:"Dostępne akcje","no-incoming":"Brak nadchodzących wojsk.","commands.tooltip.copy-arrival":"Kopiuj czas dotarcia.","commands.tooltip.copy-back":"Kopiuj czas powrotu do wioski źródłowej.","commands.tooltip.set-remove":"Wstaw rozkaz wycofania wojsk przed dotarciem ataku do Kolejki rozkazów."},pt:{title:"AttackView","filters.tooltip.current-only":"Apenas aldeia selecionada","filters.types":"Tipos","filters.tooltip.show-attacks":"Mostrar ataques","filters.tooltip.show-supports":"Mostrar apoios","filters.tooltip.show-relocations":"Mostrar transferências","filters.incoming-units":"Unidades Chegando","tooltip.command-type":"Tipo de Comando","tooltip.slowest-unit":"Unidade mais Lenta","command-type":"TC","slowest-unit":"UL",actions:"Ações","no-incoming":"Nenhum comando chegando.","commands.tooltip.copy-arrival":"Copiar data de chegada.","commands.tooltip.copy-back":"Copiar backtime.","commands.tooltip.set-remove":"Criar um comando no CommandQueue para remover todas tropas da aldeia antes do comando bater na aldeia."}},"en");var e={};e[m.COMMAND_TYPES]=angular.copy(p),e[m.INCOMING_UNITS]=angular.copy(f),e[m.VILLAGE]=!1,!0,T=n.getSelectedCharacter().getGlobalInfo(),S=c.get("attackView-filters",{},!0),angular.merge(S,e),i(function(){O()},["initial_village"]),t.bind("attackView/filtersChanged",y),t.bind("attackView/sortingChanged",M)},version:"1.0.0",loadCommands:G,getCommands:function(){return A},getFilters:function(){return S},getSortings:function(){return R},toggleFilter:function(e,i){i?S[e][i]=!S[e][i]:S[e]=!S[e],O(),t.trigger("attackView/filtersChanged")},toggleSorting:function(e){if(!_[e])return!1;_[e]===R.column?R.reverse=!R.reverse:(R.column=_[e],R.reverse=!1),t.trigger("attackView/sortingChanged")},FILTER_TYPES:m,COMMAND_TYPES:p,UNIT_SPEED_ORDER:E,COLUMN_TYPES:_,registerListeners:function(){h[r.COMMAND_INCOMING]=rootScope.$on(r.COMMAND_INCOMING,w),h[r.COMMAND_CANCELLED]=rootScope.$on(r.COMMAND_CANCELLED,L),h[r.MAP_SELECTED_VILLAGE]=rootScope.$on(r.MAP_SELECTED_VILLAGE,N),h[r.VILLAGE_NAME_CHANGED]=rootScope.$on(r.VILLAGE_NAME_CHANGED,x),h[r.COMMAND_IGNORED]=rootScope.$on(r.COMMAND_IGNORED,C)},unregisterListeners:function(){for(var e in h)h[e]()},setQueueCommand:function(t,i){U(t.targetVillage,function(a){var n=t.targetVillage,o=a,l=null===o.character_id?"attack":"support";e.addCommand({origin:n,target:o,date:i,dateType:"out",units:{spear:"*",sword:"*",axe:"*",archer:"*",light_cavalry:"*",mounted_archer:"*",heavy_cavalry:"*",ram:"*",catapult:"*",snob:"*",knight:"*",doppelsoldner:"*",trebuchet:"*"},officers:{},type:l,catapultTarget:"wall"}),e.isRunning()||e.start()})}}}),require(["two/ready","two/attackView","two/attackView/ui"],function(e,t){if(t.initialized)return!1;e(function(){t.init(),t.interface()})}),define("two/attackView/ui",["two/attackView","two/queue","two/ui","two/FrontButton","two/utils","two/eventQueue","helper/time","conf/unitTypes","ejs"],function(e,t,i,a,o,l,c,d,u){var _,p,m,E,f,v,T,h=function(){for(var t,i=e.getCommands(),a=.001*Date.now(),n=0;n<i.length;n++)100!==(t=i[n].model.percent())?(i[n].$arrivalProgress.style.width=t+"%",i[n].$arrivalIn.innerHTML=c.readableSeconds(c.server2ClientTimeInSeconds(i[n].time_completed-a))):i[n].$command.remove()},b=function(t){m.children().remove();var i=Date.now();if(!t.length)return E.css("display","");E.hide(),t.forEach(function(t){var a=document.createElement("tr"),n=1e3*t.time_completed,l=o.formatDate(n,"HH:mm:ss dd/MM/yyyy"),r=c.server2ClientTimeInSeconds(n-i),_=c.readableMilliseconds(r,!1,!0),p=t.time_completed-t.time_start,E=1e3*(t.time_completed+p),f=o.formatDate(E,"HH:mm:ss dd/MM/yyyy"),v="command-"+t.command_id+" "+t.command_type;t.slowestUnit===d.SNOB&&(v+=" snob"),a.className=v,a.innerHTML=u.render('<td class="commandType"><span class="icon-20x20-<#= commandType #>"></span></td><td class="originCharacter character player-<#= originCharacter.id #>"><span class="name"><#= originCharacter.name #> </span></td><td class="originVillage village village-<#= originVillage.id #>"><span class="name"><#= originVillage.name #></span><span class="coords"> <#= originVillage.x #>|<#= originVillage.y #></span></td><td class="targetVillage village village-<#= targetVillage.id #>"><span class="name"><#= targetVillage.name #></span><span class="coords"> <#= targetVillage.x #>|<#= targetVillage.y #></span></td><td><span class="icon-20x20-unit-<#= slowestUnit #>"></span></td><td><div class="progress-wrapper" tooltip="<#= arrivalDate #>"><div class="progress-bar arrivalProgress" style="width:<#= progress #>%"></div><div class="progress-text"><span class="arrivalIn"><#= arrivalIn #></span></div></div></td><td class="actions"><a class="copyArriveTime btn btn-orange size-20x20 icon-20x20-arrivetime" tooltip="<#= locale("attackView", "commands.tooltip.copy-arrival") #>"></a> <a class="copyBackTime btn btn-red size-20x20 icon-20x20-backtime" tooltip="<#= locale("attackView", "commands.tooltip.copy-back") #>"></a> <a class="removeTroops btn btn-orange size-20x20 icon-20x20-units-outgoing" tooltip="<#= locale("attackView", "commands.tooltip.set-remove") #>"></a></td>',{locale:Locale,originCharacter:t.originCharacter,originVillage:t.originVillage,targetVillage:t.targetVillage,arrivalDate:l,arrivalIn:_,slowestUnit:t.slowestUnit,progress:t.model.percent(),commandType:t.command_type});var T=a.querySelector(".originCharacter .name"),h=a.querySelector(".originVillage .name"),b=a.querySelector(".originVillage .coords"),A=a.querySelector(".targetVillage .name"),S=a.querySelector(".targetVillage .coords"),I=a.querySelector(".arrivalProgress"),R=a.querySelector(".arrivalIn"),O=a.querySelector(".removeTroops"),w=a.querySelector(".copyArriveTime"),L=a.querySelector(".copyBackTime");T.addEventListener("click",function(){s.openCharacterProfile(t.originCharacter.id)}),h.addEventListener("click",function(){s.openVillageInfo(t.originVillage.id)}),b.addEventListener("click",function(){g.jumpToVillage(t.originVillage.x,t.originVillage.y)}),A.addEventListener("click",function(){s.openVillageInfo(t.targetVillage.id)}),S.addEventListener("click",function(){g.jumpToVillage(t.targetVillage.x,t.targetVillage.y)}),O.addEventListener("click",function(){var i=o.formatDate(1e3*(t.time_completed-10),"HH:mm:ss:sss dd/MM/yyyy");e.setQueueCommand(t,i)}),w.addEventListener("click",function(){document.execCommand("copy")}),w.addEventListener("copy",function(e){e.preventDefault(),e.clipboardData.setData("text/plain",l),o.emitNotif("success","Arrive time copied!")}),L.addEventListener("click",function(){document.execCommand("copy")}),L.addEventListener("copy",function(e){e.preventDefault(),e.clipboardData.setData("text/plain",f),o.emitNotif("success","Back time copied!")}),m.append(a),t.$command=a,t.$arrivalProgress=I,t.$arrivalIn=R}),_.setTooltips(),_.recalcScrollbar(),O()},A=function(e){m.find(".command-"+e).remove(),_.recalcScrollbar()},S=function(e){m.find(".command-"+e).remove(),_.recalcScrollbar()},I=function(e){var t=".village-"+e.village_id+" .name";m.find(t).html(e.name)},R=function(t,i){e.getFilters()[e.FILTER_TYPES.VILLAGE]||O(i)},O=function(e){m.find(".village.selected").removeClass("selected"),e=e||n.getSelectedVillage().getId(),m.find(".village-"+e).addClass("selected")},w=function(){var t,i,a,n=e.getFilters();for(t in n)if(angular.isObject(n[t]))for(i in n[t])a=n[t][i]?"addClass":"removeClass",f[t][i][a]("active");else a=n[t]?"addClass":"removeClass",f[t][a]("active")},L=function(){var t=e.getSortings(),i=document.createElement("span");i.className="float-right arrow ",i.className+=t.reverse?"icon-26x26-normal-arrow-up":"icon-26x26-normal-arrow-down",T.find(".arrow").remove(),T.some(function(a,n){var o=a.dataset.sort;if(t.column===e.COLUMN_TYPES[o])return a.appendChild(i),!0})};e.interface=function(){e.interface=(_=new i("AttackView",{template:'<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2><#= locale("attackView", "title") #> <span class="small">v<#= version #></span></h2><ul class="list-btn"><li><a href="#" class="twOverflow-close size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="win-main"><div class="box-paper"><div class="filters"><table class="tbl-border-light"><tbody><tr><th><#= locale("common", "village") #></th></tr><tr><td><div class="box-border-dark icon village" tooltip="<#= locale("attackView", "filters.tooltip.current-only") #>"><span class="icon-34x34-village-info icon-bg-black"></span></div></td></tr></tbody></table><table class="tbl-border-light"><tbody><tr><th><#= locale("attackView", "filters.types") #></th></tr><tr><td><div data-filter="ATTACK" class="box-border-dark icon commandTypes attack" tooltip="<#= locale("attackView", "filters.tooltip.show-attacks") #>"><span class="icon-34x34-attack icon-bg-black"></span></div><div data-filter="SUPPORT" class="box-border-dark icon commandTypes support" tooltip="<#= locale("attackView", "filters.tooltip.show-supports") #>"><span class="icon-34x34-support icon-bg-black"></span></div><div data-filter="RELOCATE" class="box-border-dark icon commandTypes relocate" tooltip="<#= locale("attackView", "filters.tooltip.show-relocations") #>"><span class="icon-34x34-relocate icon-bg-black"></span></div></td></tr></tbody></table><table class="tbl-border-light"><tbody><tr><th><#= locale("attackView", "filters.incoming-units") #></th></tr><tr><td> <# UNIT_SPEED_ORDER.forEach(function(unit) { #> <div data-filter="<#= unit #>" class="box-border-dark icon incomingUnits <#= unit #>" tooltip="<#= locale("common", unit) #>"><span class="icon-34x34-unit-<#= unit #> icon-bg-black"></span></div> <# }) #> </td></tr></tbody></table></div><table class="tbl-border-light commands-table"><colgroup><col width="7%"><col width="14%"><col width=""><col width=""><col width="4%"><col width="12%"><col width="11%"></colgroup><thead class="sorting"><tr><th data-sort="COMMAND_TYPE" tooltip="<#= locale("attackView", "tooltip.command-type") #>"><#= locale("attackView", "command-type") #></th><th data-sort="ORIGIN_CHARACTER"><#= locale("common", "player") #></th><th data-sort="ORIGIN_VILLAGE"><#= locale("common", "origin") #></th><th data-sort="TARGET_VILLAGE"><#= locale("common", "target") #></th><th tooltip="<#= locale("attackView", "tooltip.slowest-unit") #>"><#= locale("attackView", "slowest-unit") #></th><th data-sort="TIME_COMPLETED">Arrive</th><th><#= locale("attackView", "actions") #></th></tr></thead><tbody class="commands"></tbody><tbody class="empty"><tr><td colspan="7"><#= locale("attackView", "no-incoming") #></td></tr></tbody></table></div></div></div>',activeTab:"attacks",replaces:{version:e.version,locale:Locale,UNIT_SPEED_ORDER:e.UNIT_SPEED_ORDER},css:'#AttackView table.commands-table{table-layout:fixed;font-size:13px}#AttackView table.commands-table th{text-align:center;padding:0px}#AttackView table.commands-table td{padding:1px 0;min-height:initial;border:none;text-align:center}#AttackView table.commands-table tr.attack.snob td{background:#bb8658}#AttackView table.commands-table tr.support td,#AttackView table.commands-table tr.relocate td{background:#9c9368}#AttackView table.commands-table .empty td{height:32px}#AttackView .village .coords{font-size:11px;color:#71471a}#AttackView .village .coords:hover{color:#ffde00;text-shadow:0 1px 0 #000}#AttackView .village .name:hover{color:#fff;text-shadow:0 1px 0 #000}#AttackView .village.selected .name{font-weight:bold}#AttackView .character .name:hover{color:#fff;text-shadow:1px 1px 0 #000}#AttackView .progress-wrapper{height:20px;margin-bottom:0}#AttackView .progress-wrapper .progress-text{position:absolute;width:100%;height:100%;text-align:center;z-index:10;padding:0 5px;line-height:20px;color:#f0ffc9;overflow:hidden}#AttackView .filters{height:95px;margin-bottom:10px}#AttackView .filters table{width:auto;float:left;margin:5px}#AttackView .filters .icon{width:38px;float:left;margin:0 6px}#AttackView .filters .icon.active:before{box-shadow:0 0 0 1px #000,-1px -1px 0 2px #ac9c44,0 0 0 3px #ac9c44,0 0 0 4px #000;border-radius:1px;content:"";position:absolute;width:38px;height:38px;left:-1px;top:-1px}#AttackView .filters td{padding:6px}#AttackView .icon-20x20-backtime{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAEMklEQVQ4y42US2xUdRTGf3funZn/PHqnnVdpKZZ2RCWBVESgoZogSAKKEEAlGhVNLMGg0QiJKxYudIdoTEyDj8SFGo2seDUGhEQqRHk/UimDpdAptHMr8+jM3Dv35QJbi9KEszzJ+eU753z5JKYuOQGBUpAa2SLiuPgBPBKGrZAPlSlmoQLYk4ekqUCmEHHL0pslRb7fsNwWF8L/DIz5Fanftey0oogBr65rk8HS3WC6jyY8ckfZdNtfWdX++tzGIDMabAJmArte4my/l/c//vaLoFc6jmP3iCqD41B5Mi0BId1Hk+V6ljfEQlvWL2xZoY/lKOTLGCY01tZhVLMkRJEtqzoeyUvSnN70SNZRXC1iUylDVZmszhQiDmbH9Lrgpta4mKPlCjy95D6Wrn8GAKFEEfEmdG2Qowd+4I0XFrUC7+w7eL5sCu8hdL3imaQuYFl6c9l021vjYk7Y72Xjq4/z1IaNCCVKMRckq+moiQDJ2bN48uV3GbnSx9b1ra1l0223LL05AYF/Vw4S80jyonnN6paq5YTe3LyU2rpaYrFpJGfPItlcTzI1H8R8cC38NTFiaojhSzeJJ8KNJ/4YOmP43GsTCmWLiGG5LTUBb2LuzGm3e3Ij3321m5Hey6A0AVAcPjmhQcSbuDyU5sF6e5phuS2yRWQC6Lj4x62h1vjJ3BwjlUoiYn52ffolmUtnuXj4ADu2b7/DFoN9RVQ1gAthx8U/+Sk4LiGAQtFAHzXIajpr16yiu/tX98euzyWAzrc6Abj8+1G0TIZ8uYx/xJpgjANlWfEKqjaZbIlixQQgdDHDyuULWLFisZTVdBJxQTIVA2uQ+qZ6KoU0nhqV09f+QoIxj4ThAWRVJWLZToNXUaarYR8Hdm+iZBic7N5LbmgI0xclERcAFLIVAHRtkFOHjwBwNHNryK9I/bZCXlFVIk6ZuSbukidmR1Z+/cliAHzRBjKjBTq37bz9gEAAgA+2vQjAjb4j9F6pUCga/Hzm5v6A5KRDFkXF1UnWRcRj256d/vam9zrJXT0GwGc7V+ONRwAwtTwAa9bs4ND+PTy8MMW5az7+vJ7lXKZ4IeiVjsuIgaylVxTHxf/S84+u3bh5Mbmrx/D6Y1hjGtaYBjduH9g0RonNSmH4o/T1j9JzeoBixSRbsi9ktNIuRXJ6vFVbA2ypVoiZNuay+qj62r6u1R0ee4i65Iw7rDEOnLegC4CSqwxf18b23C0cFMenF5wKJzLZfLDtuW/4pWt1Ry6XY8/ug8jRB6gN3GI0k6VtXcq9csvqtm2rTyjS+YDkpGXEgLdq/z++EhA2hYjbmMtMx7P8+4/Wbdj64U89/cP5Xlli2HGcUsAnjziulMGxbrheRu4lYH21QjSarvXQoraZbQC/nUoflzwMyx6hVz26MRVkysROQNhQ8XmqQr1XwH/rb2Du69Eebp25AAAAAElFTkSuQmCC")}#AttackView .icon-20x20-arrivetime{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAEW0lEQVQ4y4WUWWxUZRiGn7PMnNPOVtvODHQBSlulAUFBoQiEaBHBhCsSFaIhIe6JSyAkRkO8NpErY2KoYuINISkkRFAjEUyAUCQsBSu1BVpKZ2DmTNuZzsyZMz3L70Vbgkjqe/Ul//89//K9eSX+KyUKFcVKQopDxBNoALJE2VXJBUzyBpQA9xG9SA+DbF2vdRxrvqQqLWVHNAkITm8saKo0KBz3hqrqt32WlXkUWHoQZvlpQFbWmLZo//zj7W8ua7JRUoKSz+DOXYVrSZMfjnV/W+mTuvHcs/okIw9DFYAoBCw/DY6QX9yycemer9/p6KiQE7ilIj4vwNXBFIO3M1iFLKta4suNvLUwZzpZTxWZiEvJhMkHgYpf1+cKSazfsnHpnve2rVqYTg2xdvMrPL76JWKNNSxesYB1LyyDiQQ9fWkCmhxzkRuLZTcpVC1lOU4eEDNPDUzitJVc6eUDn6zuSAwl2PDGLqrnx9ECPob6kkxaPiLBEK1LniIaFVz/c4SAJsf6U2ZaEfZwxMOYuaVCJTWypKz68LXV7y6sigWf7thMdfMKkMOgryA2r5pYYwWBaA3FzBhFM8uiRXFOnumn/jGt0SjYl8t+MWzbFABkxSFSdkTTE3F3zkDyBnptw/2J5VMXpwq1gfT1AQ4eOIyi1AHw5II5hCp80bIjmhSHyEyP7Ak0AcFwuIKR/vy/PLVv7156T/1M4u8e9n/1HXqNRnNzjMS9AuGQBlMfF5zxKoA6U2hph5xp0nv+ErX1KVqfXctbH+yk65tOAOa1tolNm56TjIyFNVpmIl8GwBMEHnSzKkuUJUHh8vAYcihMIFQi3hAHZ4T65hq27dyKkbGI1uqS7a/mXO8F+gZGuDZ0j4nClFsU1adj2wrgyq5KTlOlwTOJ8STApVO/Y2VGAJgwSgBEa3VsfzXZZJKLvxyjWC7z8+G3CQf9+FS13nG9ueEwEUBRqmywEfrAvWLF4rqq5fmiwCvcIjuqYCTu8v5nnXQd7+bgoZ/48dduXF8F4ZpaNj0/j60bgly+YLTeNMyUYosxPUhONaBUpeq3K7G7T/Ym2pfWh5ZU1MzBX/0XV/64iVYe4+jR3QD4aqeGaWdylPNjABw9upv9X3R+9GVXwsjmrZQCiJDjOI4scjnTyZZc0ZhKJmM9PcNYlsu4CLJjez3jt65ij45jpZPYhVG8SRNFrcQc7eeZ9evIl9xI96Xh4yqAAaXoJCOW3zuRGjfNwbRob6wNbkkYxTizaDx9B0+pY93rnWdTYxPf+xQ9p0yvCRPciEtJqFpKEfZwyXaupArOYLbM+JK2lS3HDhyRbgwanO6eoPvEaWLxOixLY+WOrrP5onUI4Z2TdMeQZgtYySaGrM6VJVFfmnRjsiwHXEG8KR5p2/fpxjWv7jpyyCd7JxR8v03nY0Fidt2H+z1dcz1LFx7xlctb2gHO9wz1+CS1L2tZSabD4f+Asx7g+a0JbYJJg6lgAPgHUh4QWRIJr4EAAAAASUVORK5CYII=")}',onClose:function(){e.unregisterListeners()}}),new a("AttackView",{onClick:function(){e.registerListeners(),e.loadCommands(),h(),_.openWindow()},classHover:!1,classBlur:!1}),p=$(_.$window),m=p.find(".commands"),E=p.find(".empty"),v=p.find(".filters"),f={village:v.find(".village"),commandTypes:{ATTACK:v.find(".attack"),SUPPORT:v.find(".support"),RELOCATE:v.find(".relocate")},incomingUnits:{light_cavalry:v.find(".light_cavalry"),heavy_cavalry:v.find(".heavy_cavalry"),axe:v.find(".axe"),sword:v.find(".sword"),ram:v.find(".ram"),snob:v.find(".snob"),trebuchet:v.find(".trebuchet")}},T=p.find(".sorting th[data-sort]"),f.village.on("click",function(){e.toggleFilter(e.FILTER_TYPES.VILLAGE)}),v.find(".commandTypes").on("click",function(){e.toggleFilter(e.FILTER_TYPES.COMMAND_TYPES,this.dataset.filter)}),v.find(".incomingUnits").on("click",function(){e.toggleFilter(e.FILTER_TYPES.INCOMING_UNITS,this.dataset.filter)}),T.on("click",function(){e.toggleSorting(this.dataset.sort)}),setInterval(function(){_.isVisible("attacks")&&h()},1e3),l.bind("attackView/commandsLoaded",b),l.bind("attackView/commandCancelled",A),l.bind("attackView/commandIgnored",S),l.bind("attackView/villageRenamed",I),l.bind("attackView/filtersChanged",w),l.bind("attackView/sortingChanged",L),rootScope.$on(r.MAP_SELECTED_VILLAGE,R),w(),_)}}),define("two/autoCollector",["two/eventQueue","helper/time","Lockr"],function(e,t,a){var s=!1,c=!1,d=!0,u=0,g=function(){o.emit(l.RESOURCE_DEPOSIT_GET_INFO,{})},_=function(){if(!c)return!1;var e=n.getSelectedCharacter().getResourceDeposit();if(!e)return!1;if(e.getCurrentJob())return!1;var t,i=e.getCollectibleJobs();if(i)return t=i.shift(),void o.emit(l.RESOURCE_DEPOSIT_COLLECT,{job_id:t.id,village_id:n.getSelectedVillage().getId()});var a=e.getReadyJobs();return a?function(e){o.emit(l.RESOURCE_DEPOSIT_START_JOB,{job_id:e.id})}(p(a)):void 0},p=function(e){return e.sort(function(e,t){return e.duration-t.duration})[0]},m={};return m.init=function(){s=!0,i.$on(r.RESOURCE_DEPOSIT_JOB_COLLECTIBLE,function(){if(!d||!c)return!1;d=!1,setTimeout(function(){d=!0,_()},1500)}),i.$on(r.RESOURCE_DEPOSIT_JOBS_REROLLED,_),i.$on(r.RESOURCE_DEPOSIT_JOB_COLLECTED,_),i.$on(r.RESOURCE_DEPOSIT_INFO,function(e,t){_(),function(e){var t=1e3*e.time_next_reset-Date.now()+1e3;clearTimeout(u),u=setTimeout(g,t)}(t)})},m.start=function(){e.trigger("Collector/started"),c=!0,_()},m.stop=function(){e.trigger("Collector/stopped"),c=!1},m.isRunning=function(){return c},m.isInitialized=function(){return s},m}),define("two/autoCollector/secondVillage",["two/autoCollector","two/eventQueue","helper/time","models/SecondVillageModel"],function(e,t,a,s){var c=!1,d=!1,u=injector.get("secondVillageService"),g=function(){var e;e=_,o.emit(l.SECOND_VILLAGE_GET_INFO,{},function(t){var i=new s(t);n.getSelectedCharacter().setSecondVillage(i),e()})},_=function(){var e=n.getSelectedCharacter().getSecondVillage();if(!d||!e||!e.isAvailable())return!1;var t=function(e){var t=Date.now();for(var i in e)if(e[i].time_started&&e[i].time_completed&&t<a.server2ClientTime(e[i].time_completed))return e[i];return!1}(e.data.jobs);if(t){var i=a.server2ClientTime(t.time_completed)-Date.now()+1e3;return setTimeout(g,i),!1}var r,s=function(e){var t=Date.now();for(var i in e)if(e[i].time_started&&e[i].time_completed&&t>=a.server2ClientTime(e[i].time_completed)&&!e[i].collected)return i;return!1}(e.data.jobs);if(s)return r=s,void o.emit(l.SECOND_VILLAGE_COLLECT_JOB_REWARD,{village_id:n.getSelectedVillage().getId(),job_id:r});var c=u.getCurrentDayJobs(e.data.jobs,e.data.day),_=u.getCollectedJobs(e.data.jobs),p=n.getSelectedVillage().getResources().getResources(),m=u.getAvailableJobs(c,_,p,[]);if(m){var E=function(e){for(var t in e)return t;return!1}(m);!function(e,t){o.emit(l.SECOND_VILLAGE_START_JOB,{village_id:n.getSelectedVillage().getId(),job_id:e},t)}(E,function(){var e=m[E];setTimeout(g,1e3*e.duration+1e3)})}},p={init:function(){if(!u.isFeatureActive())return!1;c=!0,i.$on(r.SECOND_VILLAGE_VILLAGE_CREATED,g),i.$on(r.SECOND_VILLAGE_JOB_COLLECTED,g),i.$on(r.SECOND_VILLAGE_VILLAGE_CREATED,g)},start:function(){if(!c)return!1;t.trigger("Collector/secondVillage/started"),d=!0,g()},stop:function(){if(!c)return!1;t.trigger("Collector/secondVillage/stopped"),d=!1},isRunning:function(){return d},isInitialized:function(){return c}};e.secondVillage=p}),require(["two/ready","two/autoCollector","Lockr","helper/i18n","two/eventQueue","two/autoCollector/secondVillage","two/autoCollector/ui"],function(e,t,a,n,o){if(t.isInitialized())return!1;e(function(){var l,r,s;l={en_us:{collector:{title:"AutoCollector",description:"Automatic Resource Deposit/Second Village collector.",activated:"Automatic Collector activated",deactivated:"Automatic Collector deactivated"}},pl_pl:{collector:{title:"Kolekcjoner",description:"Automatyczny kolekcjoner depozytu/drugiej wioski.",activated:"Kolekcjoner aktywowany",deactivated:"Kolekcjoner deaktywowany"}},pt_br:{collector:{title:"AutoCollector",description:"Coletor automático para Depósito de Recursos/Segunda Aldeia.",activated:"Coletor Automático ativado",deactivated:"Coletor Automático desativado"}}},r=i.loc.ale,s=r in l?l[r]:l.en_us,n.setJSON(s),t.init(),t.secondVillage.init(),t.interface(),e(function(){a.get("collector-active",!1,!0)&&(t.start(),t.secondVillage.start()),o.bind("Collector/started",function(){a.set("collector-active",!0)}),o.bind("Collector/stopped",function(){a.set("collector-active",!1)})},["initial_village"])})}),define("two/autoCollector/ui",["two/autoCollector","two/FrontButton","two/utils","two/eventQueue"],function(e,t,a,n){var o;e.interface=function(){e.interface=((o=new t("Collector",{classHover:!1,classBlur:!1,tooltip:_("i18n")("description",i.loc.ale,"collector")})).click(function(){e.isRunning()?(e.stop(),e.secondVillage.stop(),a.emitNotif("success",_("i18n")("deactivated",i.loc.ale,"collector"))):(e.start(),e.secondVillage.start(),a.emitNotif("success",_("i18n")("activated",i.loc.ale,"collector")))}),n.bind("Collector/started",function(){o.$elem.classList.remove("btn-green"),o.$elem.classList.add("btn-red")}),n.bind("Collector/stopped",function(){o.$elem.classList.remove("btn-red"),o.$elem.classList.add("btn-green")}),e.isRunning()&&n.trigger("Collector/started"),o)}}),define("two/builder",["two/builder/settings","two/builder/settingsMap","two/builder/errorCodes","two/utils","queues/EventQueue","two/ready","Lockr","conf/upgradeabilityStates","conf/buildingTypes","conf/locationTypes","two/builder/events"],function(e,t,a,s,c,d,g,_,p,m){var E,f,v,T,h,b,A=injector.get("buildingService"),S=!1,I=!1,R={},O={},w="builder_queue_log",L="builder_queue_settings",C=function(){var t,i,a;(O[e.GROUP_VILLAGES]?T.getGroupVillageIds(O[e.GROUP_VILLAGES]):x()).forEach(function(e){return t=h.getVillage(e),i=t.checkReadyState(),(a=t.buildingQueue).getAmountJobs()!==a.getUnlockedSlots()&&(!(!i.buildingQueue||!i.buildings)&&(t.isInitialized()||u.initializeVillage(t),void N(t)))})},x=function(){var e,t=[],i=h.getVillages();for(e in i)t.push(e);return t},N=function(t){var i,a,n=angular.copy(t.buildingData.getBuildingLevels()),o=t.buildingQueue.getQueue(),l=angular.copy(R);if(o.forEach(function(e){n[e.building]++}),M(n))return!1;O[e.BUILDING_SEQUENCES][O[e.ACTIVE_SEQUENCE]].some(function(e){if(++l[e]>n[e])return A.compute(t),y(t,e,function(e,n){e&&(i=Date.now(),a=[{x:t.getX(),y:t.getY(),name:t.getName(),id:t.getId()},n.job.building,n.job.level,i],c.trigger(r.BUILDER_QUEUE_JOB_STARTED,a),b.unshift(a),g.set(w,b))}),!0})},y=function(e,t,i){e.getBuildingData().getDataForBuilding(t).upgradeability===_.POSSIBLE?o.emit(l.VILLAGE_UPGRADE_BUILDING,{building:t,village_id:e.getId(),location:m.MASS_SCREEN,premium:!1},function(e,t){i(!0,e)}):i(!1)},M=function(e){for(var t in e)if(e[t]<v[t])return!1;return!0},D=function(t){var i=O[e.BUILDING_SEQUENCES][t],a=angular.copy(R);return i.forEach(function(e){a[e]++}),a},G={init:function(){var a,o,l,s;for(a in S=!0,E=g.get(L,{},!0),b=g.get(w,[],!0),h=n.getSelectedCharacter(),T=n.getGroupList(),t)o=t[a].default,O[a]=E.hasOwnProperty(a)?E[a]:o;for(l in p)R[p[l]]=0;v=D(O[e.ACTIVE_SEQUENCE]),i.$on(r.BUILDING_LEVEL_CHANGED,function(e,t){if(!I)return!1;setTimeout(function(){s=h.getVillage(t.village_id),N(s)},1e3)})},start:function(){I=!0,f=setInterval(C,6e4),d(C,["all_villages_ready"]),c.trigger(r.BUILDER_QUEUE_START)},stop:function(){I=!1,clearInterval(f),c.trigger(r.BUILDER_QUEUE_STOP)},isRunning:function(){return I},isInitialized:function(){return S},updateSettings:function(i){var a,n;for(n in i){if(!t[n])return c.trigger(r.BUILDER_QUEUE_UNKNOWN_SETTING,[n]),!1;a=i[n],angular.equals(O[n],a)||(O[n]=a)}return v=D(i[e.ACTIVE_SEQUENCE]),g.set(L,O),c.trigger(r.BUILDER_QUEUE_SETTINGS_CHANGE),!0},getSettings:function(){return O},getLogs:function(){return b},clearLogs:function(){b=[],g.set(w,b),c.trigger(r.BUILDER_QUEUE_CLEAR_LOGS)},addBuildingSequence:function(t,i){return t in O[e.BUILDING_SEQUENCES]?a.SEQUENCE_EXISTS:angular.isArray(i)?(O[e.BUILDING_SEQUENCES][t]=i,g.set(L,O),c.trigger(r.BUILDER_QUEUE_BUILDING_SEQUENCES_ADDED,t),!0):a.SEQUENCE_INVALID}};return G.updateBuildingSequence=function(t,i){return t in O[e.BUILDING_SEQUENCES]?angular.isArray(i)&&function(e){e=angular.copy(R);var t,i,a=n.getGameData().getBuildings();for(i=0;i<e.length;i++)if(++e[t=e[i]]>a[t].max_level)return!1;return!0}(i)?(O[e.BUILDING_SEQUENCES][t]=i,g.set(L,O),c.trigger(r.BUILDER_QUEUE_BUILDING_SEQUENCES_UPDATED,t),!0):a.SEQUENCE_INVALID:a.SEQUENCE_NO_EXISTS},G.removeSequence=function(t){if(!(t in O[e.BUILDING_SEQUENCES]))return a.SEQUENCE_NO_EXISTS;delete O[e.BUILDING_SEQUENCES][t],g.set(L,O),c.trigger(r.BUILDER_QUEUE_BUILDING_SEQUENCES_REMOVED,t)},G}),define("two/builder/defaultOrders",["conf/buildingTypes"],function(e){var t={};return t.Essential=[e.HEADQUARTER,e.FARM,e.WAREHOUSE,e.RALLY_POINT,e.BARRACKS,e.TIMBER_CAMP,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.HEADQUARTER,e.RALLY_POINT,e.FARM,e.WAREHOUSE,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.WAREHOUSE,e.HEADQUARTER,e.STATUE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.HEADQUARTER,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.HOSPITAL,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.HEADQUARTER,e.WALL,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.FARM,e.FARM,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.WAREHOUSE,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.HEADQUARTER,e.MARKET,e.BARRACKS,e.WALL,e.WALL,e.FARM,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM,e.WALL,e.WALL,e.WALL,e.MARKET,e.MARKET,e.MARKET,e.BARRACKS,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.TAVERN,e.TAVERN,e.TAVERN,e.RALLY_POINT,e.BARRACKS,e.BARRACKS,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.BARRACKS,e.BARRACKS,e.STATUE,e.STATUE,e.WALL,e.WALL,e.HEADQUARTER,e.HEADQUARTER,e.WAREHOUSE,e.FARM,e.FARM,e.IRON_MINE,e.IRON_MINE,e.IRON_MINE,e.WAREHOUSE,e.BARRACKS,e.BARRACKS,e.WAREHOUSE,e.FARM,e.WALL,e.WALL,e.TAVERN,e.TAVERN,e.TAVERN,e.MARKET,e.MARKET,e.MARKET,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.IRON_MINE,e.IRON_MINE,e.IRON_MINE,e.RALLY_POINT,e.BARRACKS,e.BARRACKS,e.FARM,e.FARM,e.FARM,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.HEADQUARTER,e.HEADQUARTER,e.STATUE,e.STATUE,e.FARM,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.FARM,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.ACADEMY,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.WAREHOUSE,e.MARKET,e.MARKET,e.MARKET,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.TIMBER_CAMP,e.WALL,e.WALL,e.MARKET,e.MARKET,e.MARKET,e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.CLAY_PIT,e.TAVERN,e.TAVERN,e.TAVERN,e.WALL,e.WALL,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.BARRACKS,e.BARRACKS,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.TAVERN,e.TAVERN,e.TAVERN,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.BARRACKS,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.WALL,e.WALL,e.WALL,e.WALL,e.TAVERN,e.TAVERN,e.RALLY_POINT,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.CLAY_PIT,e.IRON_MINE,e.WALL,e.WALL],t["Full Village"]=[e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.MARKET,e.MARKET,e.MARKET,e.MARKET,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.PRECEPTORY,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.MARKET,e.MARKET,e.MARKET,e.MARKET,e.PRECEPTORY,e.PRECEPTORY,e.MARKET,e.MARKET,e.MARKET,e.MARKET,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY],t["War Build"]=[e.HEADQUARTER,e.FARM,e.WAREHOUSE,e.RALLY_POINT,e.BARRACKS,e.TIMBER_CAMP,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.HEADQUARTER,e.RALLY_POINT,e.FARM,e.WAREHOUSE,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.WAREHOUSE,e.HEADQUARTER,e.STATUE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.HEADQUARTER,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.HOSPITAL,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.HEADQUARTER,e.WALL,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.FARM,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.HEADQUARTER,e.MARKET,e.BARRACKS,e.WALL,e.WALL,e.FARM,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM,e.WALL,e.WALL,e.WALL,e.MARKET,e.MARKET,e.MARKET,e.BARRACKS,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.TAVERN,e.TAVERN,e.TAVERN,e.RALLY_POINT,e.BARRACKS,e.BARRACKS,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.BARRACKS,e.BARRACKS,e.STATUE,e.STATUE,e.WALL,e.WALL,e.HEADQUARTER,e.HEADQUARTER,e.WAREHOUSE,e.FARM,e.FARM,e.IRON_MINE,e.IRON_MINE,e.IRON_MINE,e.WAREHOUSE,e.BARRACKS,e.BARRACKS,e.WAREHOUSE,e.FARM,e.WALL,e.WALL,e.TAVERN,e.TAVERN,e.TAVERN,e.MARKET,e.MARKET,e.MARKET,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.IRON_MINE,e.IRON_MINE,e.IRON_MINE,e.RALLY_POINT,e.BARRACKS,e.BARRACKS,e.FARM,e.FARM,e.FARM,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.HEADQUARTER,e.HEADQUARTER,e.STATUE,e.STATUE,e.FARM,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.FARM,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.ACADEMY,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.PRECEPTORY,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.WAREHOUSE,e.MARKET,e.MARKET,e.MARKET,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.TIMBER_CAMP,e.WALL,e.WALL,e.MARKET,e.MARKET,e.MARKET,e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.CLAY_PIT,e.TAVERN,e.TAVERN,e.TAVERN,e.WALL,e.WALL,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.BARRACKS,e.BARRACKS,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.TAVERN,e.TAVERN,e.TAVERN,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.CLAY_PIT,e.CLAY_PIT,e.BARRACKS,e.BARRACKS,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.WALL,e.WALL,e.WALL,e.WALL,e.TAVERN,e.TAVERN,e.RALLY_POINT,e.WALL,e.WALL],Array.prototype.unshift.apply(t["Full Village"],t.Essential),t["Essential Without Wall"]=t.Essential.filter(function(t){return t!==e.WALL}),t["Full Wall"]=[e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL],t}),define("two/builder/errorCodes",[],function(){return{SEQUENCE_NO_EXISTS:"sequence_no_exists",SEQUENCE_EXISTS:"sequence_exists",SEQUENCE_INVALID:"sequence_invalid"}}),define("two/builder/events",[],function(){angular.extend(r,{BUILDER_QUEUE_JOB_STARTED:"Builder/jobStarted",BUILDER_QUEUE_START:"Builder/start",BUILDER_QUEUE_STOP:"Builder/stop",BUILDER_QUEUE_UNKNOWN_SETTING:"Builder/settings/unknownSetting",BUILDER_QUEUE_CLEAR_LOGS:"Builder/clearLogs",BUILDER_QUEUE_BUILDING_SEQUENCES_UPDATED:"Builder/buildingOrders/updated",BUILDER_QUEUE_BUILDING_SEQUENCES_ADDED:"Builder/buildingOrders/added",BUILDER_QUEUE_BUILDING_SEQUENCES_REMOVED:"Builder/buildingOrders/removed",BUILDER_QUEUE_SETTINGS_CHANGE:"Builder/settings/change"})}),define("two/builder/settingsMap",["two/builder/defaultOrders","two/builder/settings"],function(e,t){return{[t.GROUP_VILLAGES]:{default:"",inputType:"select"},[t.ACTIVE_SEQUENCE]:{default:"Essential",inputType:"select"},[t.BUILDING_SEQUENCES]:{default:e,inputType:"buildingOrder"}}}),define("two/builder/settings",[],function(){return{GROUP_VILLAGES:"group_villages",ACTIVE_SEQUENCE:"building_sequence",BUILDING_SEQUENCES:"building_orders"}}),require(["helper/i18n","two/ready","two/builder","two/builder/ui","two/builder/events"],function(e,t,a,n){if(a.isInitialized())return!1;t(function(){var t,o,l;t={en_us:{builder_queue:{started:"BuilderQueue started",stopped:"BuilderQueue stopped",settings:"Settings",settings_village_groups:"Build only on villages with the group",settings_building_sequence:"Building sequence",settings_building_sequence_final:"Buildings final levels",settings_saved:"Settings saved!",logs_no_builds:"No builds started",logs_clear:"Clear logs",sequences:"Sequences",sequences_move_up:"Move up",sequences_move_down:"Move down",sequences_add_building:"Add building",sequences_select_edit:"Select a sequence to edit",sequences_edit_sequence:"Edit sequence",sequence_updated:"Sequence %d updated.",sequence_added:"Building sequence %d added",select_group:"Select a group",add_building_success:"%d has added at position %d",add_building_limit_exceeded:"%d reached maximum level (%d)",position:"Position",remove_building:"Remove building from list",clone:"Clone",tooltip_clone:"Crate a new sequence from the selected sequence",tooltip_remove_sequence:"Remove selected sequence",name_sequence_min_lenght:"The sequence name must have at least 3 character.",sequence_created:"New sequence %d created.",sequence_removed:"Sequence %d removed.",error_sequence_exists:"This sequence already exists.",error_sequence_no_exists:"This sequence not exists.",error_sequence_invalid:"Some sequence's value is invalid."},builder_queue_add_building_modal:{title:"Add new building"},builder_queue_name_sequence_modal:{title:"Sequence name"},builder_queue_remove_sequence_modal:{title:"Remove sequence",text:"Are you sure to remove this sequence? If this sequence is the active one, another sequence will be selected and the BuilderQueue stopped."}},pl_pl:{builder_queue:{started:"BuilderQueue uruchomiony",stopped:"BuilderQueue zatrzymany",settings:"Ustawienia",settings_village_groups:"Buduj w wioskach z grupy",settings_building_sequence:"Szablon kolejki budowy",settings_building_sequence_final:"Buildings final levels",settings_saved:"Ustawienia zapisane!",logs_no_builds:"Nie rozpoczęto żadnej rozbudowy",logs_clear:"Wyczyść logi",sequences:"Sequences",sequences_move_up:"Move up",sequences_move_down:"Move down",sequences_add_building:"Add building",sequences_select_edit:"Select a sequence to edit",sequences_edit_sequence:"Edit sequence",sequence_updated:"Sequence %d updated.",sequence_added:"Building sequence %d added",select_group:"Select a group",add_building_success:"%d has added at position %d",add_building_limit_exceeded:"%d reached maximum level (%d)",position:"Position",remove_building:"Remove building from list",clone:"Clone",tooltip_clone:"Crate a new sequence from the selected sequence",tooltip_remove_sequence:"Remove selected sequence",name_sequence_min_lenght:"The sequence name must have at least 3 character.",sequence_created:"New sequence %d created.",sequence_removed:"Sequence %d removed.",error_sequence_exists:"This sequence already exists.",error_sequence_no_exists:"This sequence not exists.",error_sequence_invalid:"Some sequence's value is invalid."},builder_queue_add_building_modal:{title:"Add new building"},builder_queue_name_sequence_modal:{title:"Sequence name"},builder_queue_remove_sequence_modal:{title:"Remove sequence",text:"Are you sure to remove this sequence? If this sequence is the active one, another sequence will be selected and the BuilderQueue stopped."}},pt_br:{builder_queue:{started:"BuilderQueue iniciado",stopped:"BuilderQueue parado",settings:"Configurações",settings_village_groups:"Construir apenas em aldeias do grupo",settings_building_sequence:"Sequência de construções",settings_building_sequence_final:"Nível final das construções",settings_saved:"Configurações salvas!",logs_no_builds:"Nenhuma construção iniciada",logs_clear:"Limpar registros",sequences:"Sequências",sequences_move_up:"Mover acima",sequences_move_down:"Mover abaixo",sequences_add_building:"Adicionar edifício",sequences_select_edit:"Selecione uma sequência para editar",sequences_edit_sequence:"Editar sequência",sequence_updated:"Sequência %d atualizada.",sequence_added:"Sequência %d adicionada",select_group:"Selecione um grupo",add_building_success:"%d foi adicionado à posição %d",add_building_limit_exceeded:"%d chegou ao nível máximo (%d)",position:"Posição",remove_building:"Remover edifício da lista",clone:"Clonar",tooltip_clone:"Criar uma nova sequência a partir da sequência selecionada",tooltip_remove_sequence:"Remover sequência selecionada",name_sequence_min_lenght:"O nome da sequência deve ter pelo menos 3 caracteres.",sequence_created:"Nova sequência %d criada.",sequence_removed:"Sequência %d removida.",error_sequence_exists:"Esta sequência já existe.",error_sequence_no_exists:"Esta sequência não existe.",error_sequence_invalid:"Algum valor da sequência é inválido."},builder_queue_add_building_modal:{title:"Adicionar novo edifício"},builder_queue_name_sequence_modal:{title:"Nomear sequência"},builder_queue_remove_sequence_modal:{title:"Remover sequência",text:"Tem certeza que deseja remover esta sequência? Se esta sequência estiver ativa, outra será selecionada e o BuilderQueue será parado."}}},o=i.loc.ale,l=o in t?t[o]:t.en_us,e.setJSON(l),a.init(),n()})}),define("two/builder/ui",["two/builder","two/ui2","two/FrontButton","queues/EventQueue","two/utils","conf/buildingTypes","helper/time","two/ready","two/builder/settings","two/builder/settingsMap","two/builder/errorCodes","two/EventScope"],function(t,a,o,l,s,d,u,g,m,E,f,v){var T,h,b,A="builder_queue",S=n.getGroupList(),I={},R=!1,O={modal:{}},w={},L={SETTINGS:"settings",SEQUENCES:"sequences",LOGS:"logs"},C=function(){return{name:_("i18n")("disabled",i.loc.ale,"common"),value:!1}},x=function(e,t,i){return i?parseInt(Math.round(e*Math.pow(t,i-1)),10):0},N=function(e,t,i){if(i>=e.length)for(var a=i-e.length+1;a--;)e.push(void 0);e.splice(i,0,e.splice(t,1)[0])};w.generateBuildingSequence=function(){var e,t,i,a,o=h.settings[m.ACTIVE_SEQUENCE].value,l=h.settings[m.BUILDING_SEQUENCES][o],r=n.getGameData().getBuildings(),s={};for(e in d)s[d[e]]=0;w.buildingSequence=l.map(function(e){return t=++s[e],a=r[e].individual_level_costs[t],i="not-reached",!function(e,t){return n.getSelectedVillage().getBuildingData().getBuildingLevel(e)>=t}(e,t)?function(e,t){var i=!1;return n.getSelectedVillage().getBuildingQueue().getQueue().some(function(a){if(a.building===e&&a.level===t)return i=!0}),i}(e,t)&&(i="progress"):i="reached",{level:t,price:r[e].individual_level_costs[t],building:e,duration:u.readableSeconds(a.build_time),levelPoints:I[e][t-1],state:i}})},w.generateBuildingSequenceFinal=function(e){var t,i=h.settings[m.ACTIVE_SEQUENCE].value,a=h.settings[m.BUILDING_SEQUENCES][e||i],n={},o=[];for(t in b)n[t]={level:0,order:b[t].order};for(t in a.forEach(function(e){n[e].level++}),n)0!==n[t].level&&o.push({building:t,level:n[t].level,order:n[t].order});w.buildingSequenceFinal=o},w.updateVisibleBuildingSequence=function(){var e=h.pagination.buildingSequence.offset,t=h.pagination.buildingSequence.limit;w.visibleBuildingSequence=w.buildingSequence.slice(e,e+t),h.pagination.buildingSequence.count=w.buildingSequence.length},w.generateBuildingsLevelPoints=function(){var e,t,i,a,o,l=n.getGameData();for(e in l.data.buildings)for(t=l.getBuildingDataForBuilding(e),i=0,I[e]=[],o=1;o<=t.max_level;o++)i+=a=x(t.points,t.points_factor,o)-i,I[e].push(a)},O.moveUp=function(){var e,t,i=angular.copy(O.buildingSequence);for(e=0;e<i.length;e++)(t=i[e]).checked&&0!==e&&(i[e-1].checked||(i[e-1].building===t.building&&(i[e-1].level++,t.level--),N(i,e,e-1)));O.buildingSequence=i,O.updateVisibleBuildingSequence()},O.moveDown=function(){var e,t,i=angular.copy(O.buildingSequence);for(e=i.length-1;e>=0;e--)(t=i[e]).checked&&e!==i.length-1&&(i[e+1].checked||(i[e+1].building===t.building&&(i[e+1].level--,t.level++),N(i,e,e+1)));O.buildingSequence=i,O.updateVisibleBuildingSequence()},O.addBuilding=function(e,t){var i=t-1,a=O.buildingSequence.slice();return a.splice(i,0,{level:null,building:e,checked:!1}),!!(a=O.updateLevels(a,e))&&(O.buildingSequence=a,O.updateVisibleBuildingSequence(),!0)},O.removeBuilding=function(e){var t=O.buildingSequence[e].building;O.buildingSequence.splice(e,1),O.buildingSequence=O.updateLevels(O.buildingSequence,t),O.updateVisibleBuildingSequence()},O.updateLevels=function(e,t){var i,a,n=0,o=[],l=!1;for(i=0;i<e.length;i++)if((a=e[i]).building===t){if(++n>b[t].max_level){l=!0;break}o.push({level:n,building:t,checked:!1})}else o.push(a);return!l&&o},O.generateBuildingSequence=function(){var e,t=O.selectedSequence.value,i=h.settings[m.BUILDING_SEQUENCES][t],a={};for(e in d)a[d[e]]=0;O.buildingSequence=i.map(function(e){return{level:++a[e],building:e,checked:!1}})},O.updateVisibleBuildingSequence=function(){var e=h.pagination.buildingSequenceEditor.offset,t=h.pagination.buildingSequenceEditor.limit;O.visibleBuildingSequence=O.buildingSequence.slice(e,e+t),h.pagination.buildingSequenceEditor.count=O.buildingSequence.length},O.updateBuildingSequence=function(){var e=O.selectedSequence.value,a=O.buildingSequence.map(function(e){return e.building});switch(t.updateBuildingSequence(e,a)){case f.SEQUENCE_NO_EXISTS:s.emitNotif("error",_("i18n")("error_sequence_no_exits",i.loc.ale,A));break;case f.SEQUENCE_INVALID:s.emitNotif("error",_("i18n")("error_sequence_invalid",i.loc.ale,A))}},O.modal.removeSequence=function(){var e=i.$new(),a="builder_queue_remove_sequence_modal";e.title=_("i18n")("title",i.loc.ale,a),e.text=_("i18n")("text",i.loc.ale,a),e.submitText=_("i18n")("remove",i.loc.ale,"common"),e.cancelText=_("i18n")("cancel",i.loc.ale,"common"),e.submit=function(){e.closeWindow(),t.removeSequence(O.selectedSequence.value)},e.cancel=function(){e.closeWindow()},c.getModal("modal_attention",e)},O.modal.addBuilding=function(){var e,t=i.$new();for(e in t.buildings=[],t.position=1,t.indexLimit=O.buildingSequence.length+1,t.selectedBuilding={name:_("i18n")(d.HEADQUARTER,i.loc.ale,"building_names"),value:d.HEADQUARTER},b)t.buildings.push({name:_("i18n")(e,i.loc.ale,"building_names"),value:e});t.add=function(){var e=t.selectedBuilding.value,a=t.position,n=_("i18n")(e,i.loc.ale,"building_names"),o=b[e].max_level;O.addBuilding(e,a)?(t.closeWindow(),s.emitNotif("success",_("i18n")("add_building_success",i.loc.ale,A,n,a))):s.emitNotif("error",_("i18n")("add_building_limit_exceeded",i.loc.ale,A,n,o))},c.getModal("!twoverflow_builder_queue_add_building_modal",t)},O.modal.nameSequence=function(){var e=i.$new(),a=O.selectedSequence.name,n=h.settings[m.BUILDING_SEQUENCES][a];e.name=a,e.submit=function(){if(e.name.length<3)return s.emitNotif("error",_("i18n")("name_sequence_min_lenght",i.loc.ale,A)),!1;(function(e,a){switch(t.addBuildingSequence(e,a)){case f.SEQUENCE_EXISTS:return s.emitNotif("error",_("i18n")("error_sequence_exists",i.loc.ale,A)),!1;case f.SEQUENCE_INVALID:return s.emitNotif("error",_("i18n")("error_sequence_invalid",i.loc.ale,A)),!1}return!0})(e.name,n)&&e.closeWindow()},c.getModal("!twoverflow_builder_queue_name_sequence_modal",e)};var y=function(e){h.selectedTab=e},M=function(){var e,i=angular.copy(h.settings);for(e in E)"select"===E[e].inputType&&(i[e]=i[e].value);t.updateSettings(i)},D=function(){t.isRunning()?t.stop():t.start()},G=function(){t.clearLogs()},P={updateGroups:function(){h.groups=s.obj2selectOptions(S.getGroups(),!0),h.groups.unshift(C())},updateSequences:function(){var e,t=[],i=h.settings[m.BUILDING_SEQUENCES];for(e in i)t.push({name:e,value:e});h.sequences=t},generateBuildingSequences:function(){w.generateBuildingSequence(),w.generateBuildingSequenceFinal(),w.updateVisibleBuildingSequence()},generateBuildingSequencesEditor:function(){O.generateBuildingSequence(),O.updateVisibleBuildingSequence()},updateLogs:function(){h.logs=t.getLogs()},buildingSequenceUpdate:function(e,a){var n=t.getSettings();h.settings[m.BUILDING_SEQUENCES][a]=n[m.BUILDING_SEQUENCES][a],h.settings[m.ACTIVE_SEQUENCE].value===a&&(w.generateBuildingSequence(),w.generateBuildingSequenceFinal(),w.updateVisibleBuildingSequence()),s.emitNotif("success",_("i18n")("sequence_updated",i.loc.ale,A,a))},buildingSequenceAdd:function(e,a){var n=t.getSettings();h.settings[m.BUILDING_SEQUENCES][a]=n[m.BUILDING_SEQUENCES][a],P.updateSequences(),s.emitNotif("success",_("i18n")("sequence_created",i.loc.ale,A,a))},buildingSequenceRemoved:function(e,t){var a;delete h.settings[m.BUILDING_SEQUENCES][t],a=function(e){for(var t in e)if(e.hasOwnProperty(t))return t;return!1}(h.settings[m.BUILDING_SEQUENCES]),O.selectedSequence={name:a,value:a},P.updateSequences(),O.generateBuildingSequence(),h.settings[m.ACTIVE_SEQUENCE].value===t&&(h.settings[m.ACTIVE_SEQUENCE]={name:a,value:a},w.generateBuildingsLevelPoints(),w.generateBuildingSequence(),w.generateBuildingSequenceFinal()),s.emitNotif("success",_("i18n")("sequence_removed",i.loc.ale,A,t))},saveSettings:function(){s.emitNotif("success",_("i18n")("settings_saved",i.loc.ale,A))},started:function(){h.running=!0},stopped:function(){h.running=!1}},k=function(){var a,n,o,l;(h=e.$scope=i.$new()).textObject=A,h.textObjectCommon="common",h.selectedTab=L.SETTINGS,h.TAB_TYPES=L,h.SETTINGS=m,h.running=R,h.settings=(a=t.getSettings(),n=angular.copy(a),o=S.getGroups(),l=o[n[m.GROUP_VILLAGES]],n[m.GROUP_VILLAGES]=l?{name:o[n[m.GROUP_VILLAGES]].name,value:n[m.GROUP_VILLAGES]}:C(),n[m.ACTIVE_SEQUENCE]={name:n[m.ACTIVE_SEQUENCE],value:n[m.ACTIVE_SEQUENCE]},n),h.logs=t.getLogs(),h.pagination={},h.editorView=O,h.editorView.buildingSequence={},h.editorView.visibleBuildingSequence={},h.editorView.selectedSequence=angular.copy(h.settings[m.ACTIVE_SEQUENCE]),h.settingsView=w,h.settingsView.buildingSequence={},h.settingsView.buildingSequenceFinal={},h.selectTab=y,h.switchBuilder=D,h.clearLogs=G,h.saveSettings=M,P.updateGroups(),P.updateSequences(),w.generateBuildingsLevelPoints(),w.generateBuildingSequence(),w.generateBuildingSequenceFinal(),O.generateBuildingSequence(),h.pagination.buildingSequence={count:w.buildingSequence.length,offset:0,loader:w.updateVisibleBuildingSequence,limit:p.getPaginationLimit()},h.pagination.buildingSequenceEditor={count:O.buildingSequence.length,offset:0,loader:O.updateVisibleBuildingSequence,limit:p.getPaginationLimit()},w.updateVisibleBuildingSequence(),O.updateVisibleBuildingSequence(),h.$watch("settings[SETTINGS.ACTIVE_SEQUENCE].value",P.generateBuildingSequences),h.$watch("editorView.selectedSequence.value",P.generateBuildingSequencesEditor),(T=new v("twoverflow_builder_queue_window")).register(r.GROUPS_UPDATED,P.updateGroups,!0),T.register(r.GROUPS_CREATED,P.updateGroups,!0),T.register(r.GROUPS_DESTROYED,P.updateGroups,!0),T.register(r.VILLAGE_SELECTED_CHANGED,P.generateBuildingSequences,!0),T.register(r.BUILDING_UPGRADING,P.generateBuildingSequences,!0),T.register(r.BUILDING_LEVEL_CHANGED,P.generateBuildingSequences,!0),T.register(r.BUILDING_TEARING_DOWN,P.generateBuildingSequences,!0),T.register(r.VILLAGE_BUILDING_QUEUE_CHANGED,P.generateBuildingSequences,!0),T.register(r.BUILDER_QUEUE_JOB_STARTED,P.updateLogs),T.register(r.BUILDER_QUEUE_CLEAR_LOGS,P.updateLogs),T.register(r.BUILDER_QUEUE_BUILDING_SEQUENCES_UPDATED,P.buildingSequenceUpdate),T.register(r.BUILDER_QUEUE_BUILDING_SEQUENCES_ADDED,P.buildingSequenceAdd),T.register(r.BUILDER_QUEUE_BUILDING_SEQUENCES_REMOVED,P.buildingSequenceRemoved),T.register(r.BUILDER_QUEUE_SETTINGS_CHANGE,P.saveSettings),T.register(r.BUILDER_QUEUE_START,P.started),T.register(r.BUILDER_QUEUE_STOP,P.stopped),c.getScreenWithInjectedScope("!twoverflow_builder_queue_window",h)};return function(){b=n.getGameData().getBuildings();var e=new o("Builder",{classHover:!1,classBlur:!1,onClick:k});l.register(r.BUILDER_QUEUE_START,function(){R=!0,e.$elem.classList.remove("btn-green"),e.$elem.classList.add("btn-red"),s.emitNotif("success",_("i18n")("started",i.loc.ale,A))}),l.register(r.BUILDER_QUEUE_STOP,function(){R=!1,e.$elem.classList.remove("btn-red"),e.$elem.classList.add("btn-green"),s.emitNotif("success",_("i18n")("stopped",i.loc.ale,A))}),a.addTemplate("twoverflow_builder_queue_window",'<div id="two-builder-queue" class="win-content two-window"><header class="win-head"><h2>BuilderQueue</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main small-select" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" ng-click="selectTab(TAB_TYPES.SETTINGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SETTINGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SETTINGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SETTINGS}">{{ TAB_TYPES.SETTINGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.SEQUENCES)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SEQUENCES}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SEQUENCES}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SEQUENCES}">{{ TAB_TYPES.SEQUENCES | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.LOGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.LOGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.LOGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.LOGS}">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div></div></div><div class="box-paper footer"><div class="scroll-wrap"><div ng-show="selectedTab === TAB_TYPES.SETTINGS"><h5 class="twx-section">{{ \'settings\' | i18n:loc.ale:textObject }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix">{{ \'settings_village_groups\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groups" selected="settings[SETTINGS.GROUP_VILLAGES]" drop-down="true"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'settings_building_sequence\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="sequences" selected="settings[SETTINGS.ACTIVE_SEQUENCE]" drop-down="true"></div></td></tr></tbody></table><h5 class="twx-section">{{ \'settings_building_sequence\' | i18n:loc.ale:textObject }}</h5><div class="page-wrap" pagination="pagination.buildingSequence"></div><table class="tbl-border-light header-center building-sequence"><colgroup><col width="5%"><col width="30%"><col width="7%"><col width="13%"><col width="8%"><col></colgroup><tr><th tooltip="" tooltip-content="{{ \'position\' | i18n:loc.ale:textObject }}">#</th><th>{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'duration\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'points\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'costs\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr ng-repeat="item in settingsView.visibleBuildingSequence track by $index" class="{{ item.state }}"><td>{{ pagination.buildingSequence.offset + $index + 1 }}</td><td><span class="building-icon icon-20x20-building-{{ item.building }}"></span> {{ item.building | i18n:loc.ale:\'building_names\' }}</td><td>{{ item.level }}</td><td>{{ item.duration }}</td><td class="green">+{{ item.levelPoints }}</td><td><span class="icon-26x26-resource-wood"></span> {{ item.price.wood }} <span class="icon-26x26-resource-clay"></span> {{ item.price.clay }} <span class="icon-26x26-resource-iron"></span> {{ item.price.iron }}</td></tr></table><div class="page-wrap" pagination="pagination.buildingSequence"></div><h5 class="twx-section">{{ \'settings_building_sequence_final\' | i18n:loc.ale:textObject }}</h5><table class="tbl-border-light tbl-striped header-center building-sequence-final"><colgroup><col width="5%"><col width="70%"><col></colgroup><tr><th colspan="2">{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr ng-repeat="item in settingsView.buildingSequenceFinal | orderBy:\'order\'"><td><span class="building-icon icon-20x20-building-{{ item.building }}"></span></td><td>{{ item.building | i18n:loc.ale:\'building_names\' }}</td><td>{{ item.level }}</td></tr></table></div><div ng-show="selectedTab === TAB_TYPES.SEQUENCES"><h5 class="twx-section">{{ \'sequences_edit_sequence\' | i18n:loc.ale:textObject }}</h5><table class="tbl-border-light tbl-striped editor-select-sequence"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix">{{ \'sequences_select_edit\' | i18n:loc.ale:textObject }}</span></td><td><div class="select-sequence-editor" select="" list="sequences" selected="editorView.selectedSequence" drop-down="true"></div><a class="btn btn-orange clone-sequence" ng-click="editorView.modal.nameSequence()" tooltip="" tooltip-content="{{ \'tooltip_clone\' | i18n:loc.ale:textObject }}">{{ \'clone\' | i18n:loc.ale:textObject }}</a> <a href="#" class="btn-red remove-sequence icon-20x20-close" ng-click="editorView.modal.removeSequence()" tooltip="" tooltip-content="{{ \'tooltip_remove_sequence\' | i18n:loc.ale:textObject }}"></a></td></tr></tbody></table><div class="page-wrap" pagination="pagination.buildingSequenceEditor"></div><table class="tbl-border-light tbl-striped header-center building-sequence-editor"><colgroup><col width="5%"><col width="5%"><col><col width="7%"><col width="10%"></colgroup><tr><th></th><th tooltip="" tooltip-content="{{ \'position\' | i18n:loc.ale:textObject }}">#</th><th>{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'actions\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr ng-repeat="item in editorView.visibleBuildingSequence track by $index" ng-class="{\'selected\': item.checked}"><td><label class="size-26x26 btn-orange icon-26x26-checkbox" ng-class="{\'icon-26x26-checkbox-checked\': item.checked}"><input type="checkbox" ng-model="item.checked"></label></td><td>{{ pagination.buildingSequenceEditor.offset + $index + 1 }}</td><td><span class="building-icon icon-20x20-building-{{ item.building }}"></span> {{ item.building | i18n:loc.ale:\'building_names\' }}</td><td>{{ item.level }}</td><td><a href="#" class="size-20x20 btn-red icon-20x20-close" ng-click="editorView.removeBuilding(pagination.buildingSequenceEditor.offset + $index)" tooltip="" tooltip-content="{{ \'remove_building\' | i18n:loc.ale:textObject }}"></a></td></tr></table><div class="page-wrap" pagination="pagination.buildingSequenceEditor"></div></div><div ng-show="selectedTab === TAB_TYPES.LOGS"><table class="tbl-border-light tbl-striped header-center"><colgroup><col width="40%"><col width="30%"><col width="5%"><col width="25%"><col></colgroup><thead><tr><th>{{ \'village\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'started\' | i18n:loc.ale:textObjectCommon }}</th></tr></thead><tbody class="buildLog"><tr class="noBuilds"><td colspan="4">{{ \'logs_no_builds\' | i18n:loc.ale:textObject }}</td></tr></tbody></table></div></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li ng-show="selectedTab === TAB_TYPES.SETTINGS"><a href="#" class="btn-border btn-orange" ng-click="saveSettings()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.SETTINGS"><a href="#" ng-class="{false:\'btn-green\', true:\'btn-red\'}[running]" class="btn-border" ng-click="switchBuilder()"><span ng-show="running">{{ \'pause\' | i18n:loc.ale:textObjectCommon }}</span> <span ng-show="!running">{{ \'start\' | i18n:loc.ale:textObjectCommon }}</span></a></li><li ng-show="selectedTab === TAB_TYPES.LOGS"><a href="#" class="btn-border btn-orange" ng-click="clearLogs()">{{ \'clear_logs\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES"><a href="#" class="btn-border btn-orange" ng-click="editorView.moveUp()">{{ \'sequences_move_up\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES"><a href="#" class="btn-border btn-orange" ng-click="editorView.moveDown()">{{ \'sequences_move_down\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES"><a href="#" class="btn-border btn-green" ng-click="editorView.modal.addBuilding()">{{ \'sequences_add_building\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES"><a href="#" class="btn-border btn-red" ng-click="editorView.updateBuildingSequence()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li></ul></footer></div>'),a.addTemplate("twoverflow_builder_queue_add_building_modal",'<div id="add-building-modal" class="win-content" ng-init="textObject = \'builder_queue_add_building_modal\'"><header class="win-head"><h3>{{ \'title\' | i18n:loc.ale:textObject }}</h3><ul class="list-btn sprite"><li><a href="#" class="btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="box-paper"><div class="scroll-wrap unit-operate-slider"><table class="tbl-border-light tbl-striped header-center"><colgroup><col width="15%"><col><col width="15%"></colgroup><tr><td>{{ \'building\' | i18n:loc.ale:\'common\' }}</td><td colspan="2"><div select="" list="buildings" selected="selectedBuilding" drop-down="true"></div></td></tr><tr><td>{{ \'position\' | i18n:loc.ale:\'builder_queue\' }}</td><td><div range-slider="" min="1" max="indexLimit" value="position" enabled="true"></div></td><td><input type="text" class="input-border text-center" ng-model="position"></td></tr></table></div></div></div><footer class="win-foot sprite-fill"><ul class="list-btn list-center"><li><a href="#" class="btn-red btn-border btn-premium" ng-click="closeWindow()">{{ \'cancel\' | i18n:loc.ale:\'common\' }}</a></li><li><a href="#" class="btn-orange btn-border" ng-click="add()">{{ \'add\' | i18n:loc.ale:\'common\' }}</a></li></ul></footer></div>'),a.addTemplate("twoverflow_builder_queue_name_sequence_modal",'<div id="name-sequence-modal" class="win-content" ng-init="textObject = \'builder_queue_name_sequence_modal\'"><header class="win-head"><h3>{{ \'title\' | i18n:loc.ale:textObject }}</h3><ul class="list-btn sprite"><li><a href="#" class="btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="box-paper"><div class="scroll-wrap"><div class="box-border-light input-wrapper name_preset"><form ng-submit="submit()"><input type="text" focus="true" ng-model="name" minlength="3"></form></div></div></div></div><footer class="win-foot sprite-fill"><ul class="list-btn list-center"><li><a href="#" class="btn-red btn-border btn-premium" ng-click="closeWindow()">{{ \'cancel\' | i18n:loc.ale:\'common\' }}</a></li><li><a href="#" class="btn-orange btn-border" ng-click="submit()">{{ \'add\' | i18n:loc.ale:\'common\' }}</a></li></ul></footer></div>'),a.addStyle('#two-builder-queue tr.reached td{background-color:#b9af7e}#two-builder-queue tr.progress td{background-color:#af9d57}#two-builder-queue .building-sequence,#two-builder-queue .building-sequence-final,#two-builder-queue .building-sequence-editor{margin-bottom:10px}#two-builder-queue .building-sequence td,#two-builder-queue .building-sequence-final td,#two-builder-queue .building-sequence-editor td,#two-builder-queue .building-sequence th,#two-builder-queue .building-sequence-final th,#two-builder-queue .building-sequence-editor th{text-align:center}#two-builder-queue .building-sequence-editor .selected td{background-color:#b9af7e}#two-builder-queue .editor-select-sequence{margin-bottom:13px}#two-builder-queue a.btn{height:28px;line-height:28px;padding:0 10px}#two-builder-queue .clone-sequence{float:left;margin-right:10px}#two-builder-queue .select-sequence-editor{float:left;margin-top:1px;margin-right:10px}#two-builder-queue .remove-sequence{width:28px;height:28px}#add-building-modal td{text-align:center}#add-building-modal .select-wrapper{width:250px}#add-building-modal input[type="text"]{width:60px}')}}),define("two/queue",["two/utils","queues/EventQueue","helper/time","helper/math","struct/MapData","conf/conf","Lockr","two/queue/dateTypes","two/queue/eventCodes","two/queue/filterTypes"],function(t,i,a,s,c,u,g,_,p,m){var E,f,v="invalidOrigin",T="invalidTarget",h=[],b={},A=[],S=[],I=!1,R={[m.SELECTED_VILLAGE]:function(e){return e.origin.id===n.getSelectedVillage().getId()},[m.BARBARIAN_TARGET]:function(e){return!e.target.character_id},[m.ALLOWED_TYPES]:function(e,t){return t[m.ALLOWED_TYPES][e.type]},[m.ATTACK]:function(e){return"attack"!==e.type},[m.SUPPORT]:function(e){return"support"!==e.type},[m.RELOCATE]:function(e){return"relocate"!==e.type},[m.TEXT_MATCH]:function(e,t){var i=!0,a=t[m.TEXT_MATCH].toLowerCase().split(/\W/),n=[e.origin.name,e.origin.x+"|"+e.origin.y,e.origin.character_name||"",e.target.name,e.target.x+"|"+e.target.y,e.target.character_name||"",e.target.tribe_name||"",e.target.tribe_tag||""];return n=n.join("").toLowerCase(),a.some(function(e){if(e.length&&!n.includes(e))return i=!1,!0}),i}},O=function(e){return e<a.gameTime()+f},w=function(e){h.push(e)},L=function(e){b[e.id]=e},C=function(){g.set("queue-commands",h)},x=function(e){if(e.hasOwnProperty("countdown"))return!1;e.countdown=function(){return a.readableMilliseconds(Date.now()-e.sendTime)}},N={initialized:!1};return N.init=function(){f=t.getTimeOffset(),E=n.getSelectedCharacter(),N.initialized=!0,A=g.get("queue-sent",[],!0),S=g.get("queue-expired",[],!0),function(){var e=g.get("queue-commands",[],!0);if(e.length)for(var t=0;t<e.length;t++){var i=e[t];a.gameTime()>i.sendTime?N.expireCommand(i,p.TIME_LIMIT):(x(i),w(i),L(i))}}(),setInterval(function(){h.length&&h.some(function(e){if(!O(e.sendTime))return!0;I?N.sendCommand(e):N.expireCommand(e,p.TIME_LIMIT)})},100),e.addEventListener("beforeunload",function(e){I&&h.length&&(e.returnValue=!0)})},N.sendCommand=function(e){var t=function(e){var t=n.getVillages()[e.origin.id];if(!t)return p.NOT_OWN_VILLAGE;var i=t.unitInfo.units,a={};for(var o in e.units){var l=e.units[o];if("*"===l){if(0===(l=i[o].available))continue}else if(l<0){if((l=i[o].available-Math.abs(l))<0)return p.NOT_ENOUGH_UNITS}else if(l>0&&l>i[o].available)return p.NOT_ENOUGH_UNITS;a[o]=l}return angular.equals({},a)?p.NOT_ENOUGH_UNITS:a}(e);if("string"==typeof t)return N.expireCommand(e,t);e.units=t,o.emit(l.SEND_CUSTOM_ARMY,{start_village:e.origin.id,target_village:e.target.id,type:e.type,units:e.units,icon:0,officers:e.officers,catapult_target:e.catapultTarget}),function(e){A.push(e)}(e),g.set("queue-sent",A),N.removeCommand(e,p.COMMAND_SENT),i.trigger(r.COMMAND_QUEUE_SEND,e)},N.expireCommand=function(e,t){!function(e){S.push(e)}(e),g.set("queue-expired",S),N.removeCommand(e,t)},N.addCommand=function(e){if(!e.origin)return i.trigger(r.COMMAND_QUEUE_ADD_INVALID_ORIGIN,e);if(!e.target)return i.trigger(r.COMMAND_QUEUE_ADD_INVALID_TARGET,e);if(!t.isValidDateTime(e.date))return i.trigger(r.COMMAND_QUEUE_ADD_INVALID_DATE,e);if(!e.units||angular.equals(e.units,{}))return i.trigger(r.COMMAND_QUEUE_ADD_NO_UNITS,e);var a=new Promise(function(t,i){N.getVillageByCoords(e.origin.x,e.origin.y,function(e){e?t(e):i(v)})}),n=new Promise(function(t,i){N.getVillageByCoords(e.target.x,e.target.y,function(e){e?t(e):i(T)})}),o=Promise.all([a,n]);for(var l in e.officers)e.officers[l]?e.officers[l]=1:delete e.officers[l];o.then(function(a){e.origin=a[0],e.target=a[1],e.units=function(e){var t={};for(var i in e){var a=e[i];"*"!==a&&0===a||(t[i]=a)}return t}(e.units),e.date=t.fixDate(e.date),e.travelTime=N.getTravelTime(e.origin,e.target,e.units,e.type,e.officers);var n=t.getTimeFromString(e.date);if("arrive"===e.dateType?(e.sendTime=n-e.travelTime,e.arriveTime=n):(e.sendTime=n,e.arriveTime=n+e.travelTime),O(e.sendTime))return i.trigger(r.COMMAND_QUEUE_ADD_ALREADY_SENT,e);"attack"===e.type&&"supporter"in e.officers&&delete e.officers.supporter,"attack"===e.type&&e.units.catapult?e.catapultTarget=e.catapultTarget||"headquarter":e.catapultTarget=null,e.id=t.guid(),x(e),w(e),L(e),h=h.sort(function(e,t){return e.sendTime-t.sendTime}),C(),i.trigger(r.COMMAND_QUEUE_ADD,e)}),o.catch(function(t){switch(t){case v:i.trigger(r.COMMAND_QUEUE_ADD_INVALID_ORIGIN,e);break;case T:i.trigger(r.COMMAND_QUEUE_ADD_INVALID_TARGET,e)}})},N.removeCommand=function(e,t){var a=!1;delete b[e.id];for(var n=0;n<h.length;n++)if(h[n].id==e.id){h.splice(n,1),C(),a=!0;break}if(a){switch(t){case p.TIME_LIMIT:i.trigger(r.COMMAND_QUEUE_SEND_TIME_LIMIT,e);break;case p.NOT_OWN_VILLAGE:i.trigger(r.COMMAND_QUEUE_SEND_NOT_OWN_VILLAGE,e);break;case p.NOT_ENOUGH_UNITS:i.trigger(r.COMMAND_QUEUE_SEND_NO_UNITS_ENOUGH,e);break;case p.COMMAND_REMOVED:i.trigger(r.COMMAND_QUEUE_REMOVE,e)}return!0}return i.trigger(r.COMMAND_QUEUE_REMOVE_ERROR,e),!1},N.clearRegisters=function(){g.set("queue-expired",[]),g.set("queue-sent",[]),S=[],A=[]},N.start=function(e){I=!0,i.trigger(r.COMMAND_QUEUE_START,{disableNotif:!!e})},N.stop=function(){I=!1,i.trigger(r.COMMAND_QUEUE_STOP)},N.isRunning=function(){return I},N.getWaitingCommands=function(){return h},N.getWaitingCommandsObject=function(){return b},N.getSentCommands=function(){return A},N.getExpiredCommands=function(){return S},N.getTravelTime=function(e,t,i,a,n){var o=!1,l=null===t.character_id,r=t.character_id&&t.tribe_id&&t.tribe_id===E.getTribeId();"attack"===a?("supporter"in n&&delete n.supporter,l&&(o=!0)):"support"===a&&(r&&(o=!0),"supporter"in n&&(o=!0));var c={units:i,officers:angular.copy(n)},u=d.calculateTravelTime(c,{barbarian:l,ownTribe:r,officers:n,effects:o},a),g=s.actualDistance(e,t);return 1e3*d.getTravelTimeForDistance(c,u,g,a)},N.getVillageByCoords=function(e,t,i){c.loadTownDataAsync(e,t,1,1,i)},N.filterCommands=function(e,t,i){var a=R[e];return(i||h).filter(function(e){return a(e,t)})},N}),define("two/queue/dateTypes",[],function(){return{ARRIVE:"arrive",OUT:"out"}}),define("two/queue/eventCodes",[],function(){return{NOT_OWN_VILLAGE:"not_own_village",NOT_ENOUGH_UNITS:"not_enough_units",TIME_LIMIT:"time_limit",COMMAND_REMOVED:"command_removed",COMMAND_SENT:"command_sent"}}),define("two/queue/Events",[],function(){angular.extend(r,{COMMAND_QUEUE_SEND:"commandqueue_send",COMMAND_QUEUE_SEND_TIME_LIMIT:"commandqueue_send_time_limit",COMMAND_QUEUE_SEND_NOT_OWN_VILLAGE:"commandqueue_send_not_own_village",COMMAND_QUEUE_SEND_NO_UNITS_ENOUGH:"commandqueue_send_no_units_enough",COMMAND_QUEUE_ADD:"commandqueue_add",COMMAND_QUEUE_ADD_INVALID_ORIGIN:"commandqueue_add_invalid_origin",COMMAND_QUEUE_ADD_INVALID_TARGET:"commandqueue_add_invalid_target",COMMAND_QUEUE_ADD_INVALID_DATE:"commandqueue_add_invalid_date",COMMAND_QUEUE_ADD_NO_UNITS:"commandqueue_add_no_units",COMMAND_QUEUE_ADD_ALREADY_SENT:"commandqueue_add_already_sent",COMMAND_QUEUE_ADD_INVALID_ORIGIN:"commandqueue_add_invalid_origin",COMMAND_QUEUE_ADD_INVALID_TARGET:"commandqueue_add_invalid_target",COMMAND_QUEUE_REMOVE:"commandqueue_remove",COMMAND_QUEUE_REMOVE_ERROR:"commandqueue_remove_error",COMMAND_QUEUE_START:"commandqueue_start",COMMAND_QUEUE_STOP:"commandqueue_stop"})}),define("two/queue/filterTypes",[],function(){return{SELECTED_VILLAGE:"selected_village",BARBARIAN_TARGET:"barbarian_target",ALLOWED_TYPES:"allowed_types",ATTACK:"attack",SUPPORT:"support",RELOCATE:"relocate",TEXT_MATCH:"text_match"}}),require(["helper/i18n","two/ready","two/queue","two/queue/ui","two/queue/Events"],function(e,t,a,n){if(a.initialized)return!1;t(function(){var t,o,l;t={en_us:{queue:{title:"CommandQueue",attack:"Attack",support:"Support",relocate:"Transfer",sent:"sent",activated:"enabled",deactivated:"disabled",expired:"expired",removed:"removed",added:"added",general_clear:"Clear logs",general_next_command:"Next command",add_basics:"Basic information",add_origin:"Origin",add_selected:"Active village",add_target:"Target",add_map_selected:"Selected village on a map",add_arrive:"Command arrive at date",add_out:"Command leave at date",add_current_date:"Current date",add_current_date_plus:"Increase date in 100 milliseconds.",add_current_date_minus:"Reduce date in 100 milliseconds.",add_travel_times:"Unit travel time",add_date:"Date/time",add_no_village:"select a village...",add_village_search:"Village search...",add_clear:"Clear fields",add_insert_preset:"Insert preset",queue_waiting:"Waiting commands",queue_none_added:"No command added.",queue_sent:"Commands sent",queue_none_sent:"No command sent.",queue_expired:"Expired commands",queue_none_expired:"No command expired.",queue_remove:"Remove command form list",queue_filters:"Filter commands",filters_selected_village:"Show only commands from the selected village",filters_barbarian_target:"Show only commands with barbarian villages as target",filters_attack:"Show attacks",filters_support:"Show supports",filters_relocate:"Show transfers",filters_text_match:"Filter by text...",command_out:"Out",command_time_left:"Time remaining",command_arrive:"Arrival",error_no_units_enough:"No units enough to send the command!",error_not_own_village:"The origin village is not owned by you!",error_origin:"Invalid origin village!",error_target:"Invalid target village!",error_no_units:"No units specified!",error_invalid_date:"Invalid date",error_already_sent:"This %{type} should have left %{date}",error_no_map_selected_village:"No selected village on map.",error_remove_error:"Error removing command.",tab_add:"Add command",tab_waiting:"Queued commands",tab_logs:"Command logs"}},pl_pl:{queue:{title:"Generał",attack:"Atak",support:"Wsparcie",relocate:"przenieś",sent:"wysłany/e",activated:"włączony",deactivated:"wyłączony",expired:"przedawniony/e",removed:"usunięty/e",added:"dodany/e",general_clear:"Wyczyść logi",general_next_command:"Następny rozkaz",add_basics:"Podstawowe informacje",add_origin:"Źródło",add_selected:"Aktywna wioska",add_target:"Cel",add_map_selected:"Wybrana wioska na mapie",add_arrive:"Czas dotarcia na cel",add_out:"Czas wyjścia z  twojej wioski",add_current_date:"Obecny czas",add_current_date_plus:"Zwiększ czas o 100 milisekund.",add_current_date_minus:"Zmniejsz czas o 100 milisekund.",add_travel_times:"Czas podróży jendostek",add_date:"Czas/Data",add_no_village:"Wybierz wioskę...",add_village_search:"Znajdź wioskę...",add_clear:"wyczyść",add_insert_preset:"Insert preset",queue_waiting:"Rozkazy",queue_none_added:"Brak dodanych rozkazów.",queue_sent:"Rozkazy wysłane",queue_none_sent:"Brak wysłanych rozkazów.",queue_expired:"Przedawnione rozkazy",queue_none_expired:"Brak przedawnionych rozkazów.",queue_remove:"Usuń rozkaz z listy",queue_filters:"Filtruj rozkazy",filters_selected_village:"Pokaż tylko rozkazy z aktywnej wioski",filters_barbarian_target:"Pokaż tylko rozkazy na wioski barbarzyńskie",filters_attack:"Pokaż ataki",filters_support:"Pokaż wsparcia",filters_relocate:"Pokaż przeniesienia",filters_text_match:"Filtruj za pomocą tekstu...",command_out:"Czas wyjścia",command_time_left:"Pozostały czas",command_arrive:"Czas dotarcia",error_no_units_enough:"Brak wystarczającej liczby jednostek do wysłania rozkazu!",error_not_own_village:"Wioska źródłowa nie należy do ciebie!",error_origin:"Nieprawidłowa wioska źródłowa!",error_target:"Nieprawidłowa wioska cel!",error_no_units:"Nie wybrano jednostek!",error_invalid_date:"Nieprawidłowy Czas",error_already_sent:"Ten rozkaz %{type} powinien zostać wysłany %{date}",error_no_map_selected_village:"Nie zaznaczono wioski na mapie.",error_remove_error:"Błąd usuwania rozkazu.",tab_add:"Add command",tab_waiting:"Queued commands",tab_logs:"Command logs"}},pt_br:{queue:{title:"CommandQueue",attack:"Ataque",support:"Apoio",relocate:"Transferência",sent:"enviado",activated:"ativado",deactivated:"desativado",expired:"expirado",removed:"removido",added:"adicionado",general_clear:"Limpar registros",general_next_command:"Próximo comando",add_basics:"Informações básicas",add_origin:"Aldeia de origem",add_selected:"Selecionar aldeia ativa",add_target:"Aldea alvo",add_map_selected:"Selecionar aldeia selecionada no mapa",add_arrive:"Data de chegada",add_out:"Data de saída",add_current_date:"Data/hora",add_current_date_plus:"Aumentar data em 100 milisegunds.",add_current_date_minus:"Reduzir data em 100 milisegunds.",add_travel_times:"Tempos de viagem",add_date:"Data",add_no_village:"selecione uma aldeia...",add_village_search:"Procurar aldeia...",add_clear:"Limpar campos",add_insert_preset:"Inserir predefinição",queue_waiting:"Comandos em espera",queue_none_added:"Nenhum comando adicionado.",queue_sent:"Comandos enviados",queue_none_sent:"Nenhum comando enviado.",queue_expired:"Comandos expirados",queue_none_expired:"Nenhum comando expirado.",queue_remove:"Remover comando da lista",queue_filters:"Filtro de comandos",filters_selected_village:"Mostrar apenas comandos com origem da aldeia selecionada",filters_barbarian_target:"Mostrar apenas comandos com aldeias bárbaras como alvo",filters_attack:"Mostrar ataques",filters_support:"Mostrar apoios",filters_relocate:"Mostrar transferências",filters_text_match:"Filtrar por texto...",command_out:"Saída na data",command_time_left:"Tempo restante",command_arrive:"Chegada na data",error_no_units_enough:"Sem unidades o sulficientes para enviar o comando!",error_not_own_village:"A aldeia de origem não pertence a você!",error_origin:"Aldeia de origem inválida!",error_target:"Aldeia alvo inválida!",error_no_units:"Nenhuma unidade especificada!",error_invalid_date:"Data inválida",error_already_sent:"Esse %d deveria ter saído %d",error_no_map_selected_village:"Nenhuma aldeia selecionada no mapa.",error_remove_error:"Erro ao remover comando.",tab_add:"Adicionar comando",tab_waiting:"Comandos em espera",tab_logs:"Registro de comandos"}}},o=i.loc.ale,l=o in t?t[o]:t.en_us,e.setJSON(l),a.init(),n(),a.getWaitingCommands().length>0&&a.start(!0)})}),define("two/queue/ui",["two/queue","two/ui2","two/FrontButton","two/utils","queues/EventQueue","helper/time","helper/util","two/utils","two/EventScope","two/ui/autoComplete","two/queue/dateTypes","two/queue/eventCodes","two/queue/filterTypes"],function(t,a,o,l,d,u,g,l,p,m,E,f,v){var T,h,b,A,S,I,R,O=n.getGameData(),w=O.getOrderedUnitNames(),L=O.getOrderedOfficerNames(),C=n.getPresetList(),x=!1,N=["attack","support","relocate"],y={ADD:"add",WAITING:"waiting",LOGS:"logs"},M=y.ADD,D=[],G={},P={},k=["light_cavalry","heavy_cavalry","archer","sword","ram","snob","trebuchet"],U=[v.SELECTED_VILLAGE,v.BARBARIAN_TARGET,v.ALLOWED_TYPES,v.TEXT_MATCH],q=function(e,t){x=t.data},V=function(){x=!1},B=function(e){var t=new Date(e||u.gameTime()+l.getTimeOffset()),i=t.getMilliseconds(),a=u.zerofill(i-i%100,3),n=u.zerofill(t.getSeconds(),2),o=u.zerofill(t.getMinutes(),2);return u.zerofill(t.getHours(),2)+":"+o+":"+n+":"+a+" "+u.zerofill(t.getDate(),2)+"/"+u.zerofill(t.getMonth()+1,2)+"/"+t.getFullYear()},H=function(e,t){return l.isValidDateTime(e)?(e=l.fixDate(e),e=l.getTimeFromString(e),B(e+=t)):""},j=function(){if(h.isValidDate=l.isValidDateTime(A.date),!A.origin||!A.target)return!1;var e,i,a,n;N.forEach(function(o){h.travelTimes[o]={},k.forEach(function(r){a=t.getTravelTime(A.origin,A.target,{[r]:1},o,A.officers),h.selectedDateType.value===E.OUT?h.isValidDate?(e=l.fixDate(A.date),outTime=l.getTimeFromString(e),n=F(outTime)?"valid":"invalid"):n="neutral":h.selectedDateType.value===E.ARRIVE&&(h.isValidDate?(e=l.fixDate(A.date),i=l.getTimeFromString(e),n=F(i-a)?"valid":"invalid"):n="invalid"),h.travelTimes[o][r]={value:_("readableMillisecondsFilter")(a),valueType:n}})})},F=function(e){return!!h.isValidDate&&u.gameTime()+S<e},Y=function(){A.dateType=h.selectedDateType.value,j()},W=function(){var e=h.selectedInsertPreset.value;if(!e)return!1;var t=n.getPresetList().getPresets()[e];h.selectedInsertPreset={name:_("i18n")("add_insert_preset",i.loc.ale,"queue"),value:null},A.units=angular.copy(t.units),A.officers=angular.copy(t.officers),t.catapult_target&&(A.catapultTarget=t.catapult_target,h.catapultTarget={name:_("i18n")(t.catapult_target,i.loc.ale,"building_names"),value:t.catapult_target},h.showCatapultSelect=!0)},z=function(){h.waitingCommands=t.getWaitingCommands()},Q=function(){h.sentCommands=t.getSentCommands()},K=function(){h.expiredCommands=t.getExpiredCommands()},$=function(){var e=h.waitingCommands;U.forEach(function(i){h.activeFilters[i]&&(e=t.filterCommands(i,h.filtersData,e))}),h.visibleWaitingCommands=e},X=function(e){0===A.units[e]&&(A.units[e]="")},Z=function(e){""===A.units[e]&&(A.units[e]=0)},J=function(){h.showCatapultSelect=!!A.units.catapult},ee=function(e){h.selectedTab=e},te=function(){var e=n.getSelectedVillage().data;A.origin={id:e.villageId,x:e.x,y:e.y,name:e.name}},ie=function(){if(!x)return l.emitNotif("error",_("i18n")("error_no_map_selected_village",i.loc.ale,"queue"));t.getVillageByCoords(x.x,x.y,function(e){A.target={id:e.id,x:e.x,y:e.y,name:e.name}})},ae=function(){A.date=B()},ne=function(){if(!A.date)return!1;A.date=H(A.date,100)},oe=function(){if(!A.date)return!1;A.date=H(A.date,-100)},le=function(){A.units=angular.copy(G),A.officers=angular.copy(P),A.catapultTarget="wall",h.catapultTarget={name:_("i18n")("wall",i.loc.ale,"building_names"),value:"wall"},h.showCatapultSelect=!1},re=function(e){var t;switch(e){case"origin":t=document.querySelector("#two-commandqueue .village-origin");break;case"target":t=document.querySelector("#two-commandqueue .village-target");break;default:return!1}if(h.searchQuery[e].length<2)return m.hide();m.search(h.searchQuery[e],function(i){i.length&&m.show(i,t,"commandqueue_village_search",e)},["village"])},se=function(e){var i=angular.copy(A);i.type=e,t.addCommand(i)},ce=function(){t.clearRegisters(),Q(),K()},de=function(){t.isRunning()?t.stop():t.start()},ue=function(e,t,a){return a&&(e=a+"."+e),_("i18n")(e,i.loc.ale,"queue")+" "+_("i18n")(t,i.loc.ale,"queue")},ge=function(e,t){h.activeFilters[e]=!h.activeFilters[e],t&&(h.filtersData[v.ALLOWED_TYPES][e]=!h.filtersData[v.ALLOWED_TYPES][e]),$()},_e=function(){h.activeFilters[v.TEXT_MATCH]=h.filtersData[v.TEXT_MATCH].length>0,$()},pe=function(){h.presets=l.obj2selectOptions(C.getPresets())},me=function(e,t,i,a){if("commandqueue_village_search"!==t)return!1;A[a]={id:i.raw.id,x:i.raw.x,y:i.raw.y,name:i.raw.name},h.searchQuery[a]=""},Ee=function(e){l.emitNotif("error",_("i18n")("error_origin",i.loc.ale,"queue"))},fe=function(e){l.emitNotif("error",_("i18n")("error_target",i.loc.ale,"queue"))},ve=function(e){l.emitNotif("error",_("i18n")("error_invalid_date",i.loc.ale,"queue"))},Te=function(e){l.emitNotif("error",_("i18n")("error_no_units",i.loc.ale,"queue"))},he=function(e,t){var a=_("i18n")(t.type,i.loc.ale,"common"),n=l.formatDate(t.sendTime);l.emitNotif("error",_("i18n")("error_already_sent",i.loc.ale,"queue",a,n))},be=function(e,t){z(),$(),i.$broadcast(r.TOOLTIP_HIDE,"twoverflow-tooltip"),l.emitNotif("success",ue(t.type,"removed"))},Ae=function(e,t){l.emitNotif("error",_("i18n")("error_remove_error",i.loc.ale,"queue"))},Se=function(e,t){Q(),K(),z(),$(),l.emitNotif("error",ue(t.type,"expired"))},Ie=function(e,t){Q(),K(),z(),$(),l.emitNotif("error",_("i18n")("error_not_own_village",i.loc.ale,"queue"))},Re=function(e,t){Q(),K(),z(),$(),l.emitNotif("error",_("i18n")("error_no_units_enough",i.loc.ale,"queue"))},Oe=function(e,t){z(),$(),l.emitNotif("success",ue(t.type,"added"))},we=function(e,t){Q(),z(),$(),l.emitNotif("success",ue(t.type,"sent"))},Le=function(e,i){if(h.running=t.isRunning(),i.disableNotif)return!1;l.emitNotif("success",ue("title","activated"))},Ce=function(e){h.running=t.isRunning(),l.emitNotif("success",ue("title","deactivated"))},xe=function(){(h=e.$scope=i.$new()).textObject="queue",h.textObjectCommon="common",h.textObjectVillageInfo="screen_village_info",h.textObjectUnitNames="unit_names",h.textObjectMilitaryOperations="military_operations",h.selectedTab=M,h.inventory=n.getInventory(),h.presets=l.obj2selectOptions(C.getPresets()),h.travelTimes={},h.unitOrder=b,h.officers=O.getOrderedOfficerNames(),h.searchQuery={origin:"",target:""},h.isValidDate=!1,h.dateTypes=g.toActionList(E,function(e){return _("i18n")("add_"+e,i.loc.ale,"queue")}),h.selectedDateType={name:_("i18n")("add_out",i.loc.ale,"queue"),value:E.OUT},h.selectedInsertPreset={name:_("i18n")("add_insert_preset",i.loc.ale,"queue"),value:null},h.catapultTarget={name:_("i18n")("wall",i.loc.ale,"building_names"),value:"wall"},h.showCatapultSelect=!!A.units.catapult,h.attackableBuildings=D,h.commandData=A,h.activeFilters=I,h.filtersData=R,h.running=t.isRunning(),h.waitingCommands=t.getWaitingCommands(),h.visibleWaitingCommands=t.getWaitingCommands(),h.sentCommands=t.getSentCommands(),h.expiredCommands=t.getExpiredCommands(),h.EVENT_CODES=f,h.FILTER_TYPES=v,h.TAB_TYPES=y,h.onUnitInputFocus=X,h.onUnitInputBlur=Z,h.catapultTargetVisibility=J,h.selectTab=ee,h.addSelected=te,h.addMapSelected=ie,h.addCurrentDate=ae,h.incrementDate=ne,h.reduceDate=oe,h.cleanUnitInputs=le,h.searchVillage=re,h.addCommand=se,h.clearRegisters=ce,h.switchCommandQueue=de,h.removeCommand=t.removeCommand,h.openVillageInfo=s.openVillageInfo,h.toggleFilter=ge,h.$watch("commandData.origin",j),h.$watch("commandData.target",j),h.$watch("commandData.date",j),h.$watch("selectedDateType.value",Y),h.$watch("selectedInsertPreset.value",W),h.$watch("filtersData[FILTER_TYPES.TEXT_MATCH]",_e),(T=new p("twoverflow_queue_window")).register(r.ARMY_PRESET_UPDATE,pe,!0),T.register(r.ARMY_PRESET_DELETED,pe,!0),T.register(r.SELECT_SELECTED,me,!0),T.register(r.COMMAND_QUEUE_ADD_INVALID_ORIGIN,Ee),T.register(r.COMMAND_QUEUE_ADD_INVALID_TARGET,fe),T.register(r.COMMAND_QUEUE_ADD_INVALID_DATE,ve),T.register(r.COMMAND_QUEUE_ADD_NO_UNITS,Te),T.register(r.COMMAND_QUEUE_ADD_ALREADY_SENT,he),T.register(r.COMMAND_QUEUE_REMOVE,be),T.register(r.COMMAND_QUEUE_REMOVE_ERROR,Ae),T.register(r.COMMAND_QUEUE_SEND_TIME_LIMIT,Se),T.register(r.COMMAND_QUEUE_SEND_NOT_OWN_VILLAGE,Ie),T.register(r.COMMAND_QUEUE_SEND_NO_UNITS_ENOUGH,Re),T.register(r.COMMAND_QUEUE_ADD,Oe),T.register(r.COMMAND_QUEUE_SEND,we),T.register(r.COMMAND_QUEUE_START,Le),T.register(r.COMMAND_QUEUE_STOP,Ce),c.getScreenWithInjectedScope("!twoverflow_queue_window",h)};return function(){S=l.getTimeOffset();var e,t=O.getAttackableBuildings();for(e in t)D.push({name:_("i18n")(e,i.loc.ale,"building_names"),value:e});(b=angular.copy(w)).splice(b.indexOf("catapult"),1),w.forEach(function(e){G[e]=0}),L.forEach(function(e){P[e]=!1}),A={origin:!1,target:!1,date:"",dateType:E.OUT,units:angular.copy(G),officers:angular.copy(P),catapultTarget:"wall",type:null},I={[v.SELECTED_VILLAGE]:!1,[v.BARBARIAN_TARGET]:!1,[v.ALLOWED_TYPES]:!0,[v.ATTACK]:!0,[v.SUPPORT]:!0,[v.RELOCATE]:!0,[v.TEXT_MATCH]:!1},R={[v.ALLOWED_TYPES]:{[v.ATTACK]:!0,[v.SUPPORT]:!0,[v.RELOCATE]:!0},[v.TEXT_MATCH]:""},opener=new o("Commander",{classHover:!1,classBlur:!1,onClick:xe}),d.register(r.COMMAND_QUEUE_START,function(){opener.$elem.classList.remove("btn-green"),opener.$elem.classList.add("btn-red")}),d.register(r.COMMAND_QUEUE_STOP,function(){opener.$elem.classList.remove("btn-red"),opener.$elem.classList.add("btn-green")}),i.$on(r.SHOW_CONTEXT_MENU,q),i.$on(r.DESTROY_CONTEXT_MENU,V),a.addTemplate("twoverflow_queue_window",'<div id="two-commandqueue" class="win-content two-window"><header class="win-head"><h2>CommandQueue</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main small-select" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" ng-click="selectTab(TAB_TYPES.ADD)" ng-class="{true:\'tab-active\', false:\'\'}[selectedTab == TAB_TYPES.ADD]"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.ADD}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.ADD}">{{ \'tab_add\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.WAITING)" ng-class="{true:\'tab-active\', false:\'\'}[selectedTab == TAB_TYPES.WAITING]"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.WAITING}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.WAITING}">{{ \'tab_waiting\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.LOGS)" ng-class="{true:\'tab-active\', false:\'\'}[selectedTab == TAB_TYPES.LOGS]"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.LOGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.LOGS}">{{ \'tab_logs\' | i18n:loc.ale:textObject }}</a></div></div></div></div></div><div class="box-paper footer"><div class="scroll-wrap"><div class="add" ng-show="selectedTab === TAB_TYPES.ADD"><form class="addForm"><div><table class="tbl-border-light tbl-striped"><colgroup><col width="30%"><col width="5%"><col><col width="18%"></colgroup><tbody><tr><td><input type="text" ng-model="searchQuery.origin" class="textfield-border village-origin" placeholder="{{ \'add_village_search\' | i18n:loc.ale:textObject }}" tooltip="" tooltip-content="{{ \'add_origin\' | i18n:loc.ale:textObject }}" ng-keyup="searchVillage(\'origin\')"></td><td class="text-center"><span class="icon-26x26-rte-village"></span></td><td ng-if="!commandData.origin">{{ \'add_no_village\' | i18n:loc.ale:textObject }}</td><td ng-if="commandData.origin">{{ commandData.origin.name }} ({{ commandData.origin.x }}|{{ commandData.origin.y }})</td><td class="actions"><a class="btn btn-orange" ng-click="addSelected()" tooltip="" tooltip-content="{{ \'add_selected\' | i18n:loc.ale:textObject }}">{{ \'selected\' | i18n:loc.ale:textObjectCommon }}</a></td></tr><tr><td><input type="text" ng-model="searchQuery.target" class="textfield-border village-target" placeholder="{{ \'add_village_search\' | i18n:loc.ale:textObject }}" tooltip="" tooltip-content="{{ \'add_target\' | i18n:loc.ale:textObject }}" ng-keyup="searchVillage(\'target\')"></td><td class="text-center"><span class="icon-26x26-rte-village"></span></td><td ng-if="!commandData.target">{{ \'add_no_village\' | i18n:loc.ale:textObject }}</td><td ng-if="commandData.target">{{ commandData.target.name }} ({{ commandData.target.x }}|{{ commandData.target.y }})</td><td class="actions"><a class="btn btn-orange" ng-click="addMapSelected()" tooltip="" tooltip-content="{{ \'add_map_selected\' | i18n:loc.ale:textObject }}">{{ \'selected\' | i18n:loc.ale:textObjectCommon }}</a></td></tr><tr><td><input ng-model="commandData.date" type="text" class="textfield-border date" pattern="\\s*\\d{1,2}:\\d{1,2}:\\d{1,2}(:\\d{1,3})? \\d{1,2}\\/\\d{1,2}\\/\\d{4}\\s*" placeholder="{{ \'add_date\' | i18n:loc.ale:textObject }}" tooltip="" tooltip-content="hh:mm:ss:SSS dd/MM/yyyy"></td><td class="text-center"><span class="icon-26x26-time"></span></td><td><div select="" list="dateTypes" selected="selectedDateType"></div></td><td class="actions"><a class="btn btn-orange" ng-click="reduceDate()" tooltip="" tooltip-content="{{ \'add_current_date_minus\' | i18n:loc.ale:textObject }}">-</a><a class="btn btn-orange" ng-click="addCurrentDate()" tooltip="" tooltip-content="{{ \'add_current_date\' | i18n:loc.ale:textObject }}">{{ \'now\' | i18n:loc.ale:textObjectCommon }}</a><a class="btn btn-orange" ng-click="incrementDate()" tooltip="" tooltip-content="{{ \'add_current_date_plus\' | i18n:loc.ale:textObject }}">+</a></td></tr></tbody></table><table ng-show="commandData.origin && commandData.target" class="tbl-border-light tbl-units tbl-speed screen-village-info"><thead><tr><th colspan="7">{{ \'speed_title\' | i18n:loc.ale:textObjectVillageInfo }}</th></tr></thead><tbody><tr><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-knight" tooltip="" tooltip-content="{{ \'knight\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-light_cavalry" tooltip="" tooltip-content="{{ \'light_cavalry\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-mounted_archer" tooltip="" tooltip-content="{{ \'mounted_archer\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub-icon time-support" ng-class="{\'text-red\': travelTimes.support.light_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.light_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}"><div class="time-icon icon-20x20-support-check"></div>{{ travelTimes.support.light_cavalry.value }}</div><div class="box-time-sub-icon time-attack" ng-class="{\'text-red\': travelTimes.attack.light_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.attack.light_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}"><div class="time-icon icon-20x20-attack-check"></div>{{ travelTimes.attack.light_cavalry.value }}</div><div class="box-time-sub-icon time-relocate" ng-class="{\'text-red\': travelTimes.relocate.light_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.relocate.light_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}"><div class="time-icon icon-20x20-relocate"></div>{{ travelTimes.relocate.light_cavalry.value }}</div></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-heavy_cavalry" tooltip="" tooltip-content="{{ \'heavy_cavalry\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.heavy_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.heavy_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.heavy_cavalry.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.heavy_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.heavy_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.heavy_cavalry.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.heavy_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.heavy_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.heavy_cavalry.value }}</div></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-archer" tooltip="" tooltip-content="{{ \'archer\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-spear" tooltip="" tooltip-content="{{ \'spear\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-axe" tooltip="" tooltip-content="{{ \'axe\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-doppelsoldner" tooltip="" tooltip-content="{{ \'doppelsoldner\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.archer.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.archer.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.archer.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.archer.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.archer.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.archer.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.archer.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.archer.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.archer.value }}</div></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-sword" tooltip="" tooltip-content="{{ \'sword\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.sword.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.sword.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.sword.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.sword.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.sword.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.sword.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.sword.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.sword.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.sword.value }}</div></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-catapult" tooltip="" tooltip-content="{{ \'catapult\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-ram" tooltip="" tooltip-content="{{ \'ram\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.ram.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.ram.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.ram.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.ram.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.ram.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.ram.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.ram.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.ram.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.ram.value }}</div></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-snob" tooltip="" tooltip-content="{{ \'snob\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.snob.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.snob.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.snob.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.snob.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.snob.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.snob.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.snob.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.snob.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'cannot_relocate_snob\' | i18n:loc.ale:textObjectMilitaryOperations }}">-</div></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-trebuchet" tooltip="" tooltip-content="{{ \'trebuchet\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.trebuchet.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.trebuchet.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.trebuchet.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.trebuchet.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.trebuchet.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.trebuchet.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.trebuchet.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.trebuchet.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.trebuchet.value }}</div></div></td></tr></tbody></table></div><h5 class="twx-section">{{ \'units\' | i18n:loc.ale:textObjectCommon }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><tbody class="add-units"><tr><td colspan="4" class="actions"><ul class="list-btn list-center"><li><div select="" list="presets" selected="selectedInsertPreset" drop-down="true"></div></li><li><a class="clear-units btn btn-orange" ng-click="cleanUnitInputs()">{{ \'add_clear\' | i18n:loc.ale:textObject }}</a></li></ul></td></tr><tr ng-repeat="i in [] | range:(unitOrder.length / 4);"><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4]" tooltip="" tooltip-content="{{ unitOrder[i * 4] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4])" ng-blur="onUnitInputBlur(unitOrder[i * 4])"></td><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4 + 1]" tooltip="" tooltip-content="{{ unitOrder[i * 4 + 1] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4 + 1]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4 + 1]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4 + 1])" ng-blur="onUnitInputBlur(unitOrder[i * 4 + 1])"></td><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4 + 2]" tooltip="" tooltip-content="{{ unitOrder[i * 4 + 2] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4 + 2]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4 + 2]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4 + 2])" ng-blur="onUnitInputBlur(unitOrder[i * 4 + 2])"></td><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4 + 3]" tooltip="" tooltip-content="{{ unitOrder[i * 4 + 3] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4 + 3]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4 + 3]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4 + 3])" ng-blur="onUnitInputBlur(unitOrder[i * 4 + 3])"></td></tr><tr><td class="cell-space-left"><span class="icon-bg-black icon-34x34-unit-catapult" tooltip="" tooltip-content="{{ \'catapult\' | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units.catapult" maxlength="5" placeholder="{{ commandData.units.catapult }}" ng-keyup="catapultTargetVisibility()" ng-focus="onUnitInputFocus(\'catapult\')" ng-blur="onUnitInputBlur(\'catapult\')"></td><td class="cell-space-left" colspan="3"><div ng-visible="showCatapultSelect"><div class="unit-border box-slider"><div class="height-wrapper"><div select="" list="attackableBuildings" selected="catapultTarget"></div></div></div></div></td></tr></tbody></table><h5 class="twx-section">{{ \'officers\' | i18n:loc.ale:textObjectCommon }}</h5><table class="add-officers margin-top tbl-border-light tbl-officers"><tbody><tr><td class="cell-officers" ng-repeat="officer in officers"><table class="tbl-border-dark tbl-officer"><tbody><tr><td class="cell-space"><span class="icon-44x44-premium_officer_{{ officer }}"></span></td><td class="cell-officer-switch" rowspan="2"><div switch-slider="" enabled="true" value="commandData.officers[officer]" vertical="true" size="\'34x66\'"></div></td></tr><tr><td tooltip="" tooltip-content="{{ \'available_officers\' | i18n:loc.ale:\'modal_preset_edit\' }}"><div class="amount">{{ inventory.getItemAmountByType(\'premium_officer_\' + officer) | number }}</div></td></tr></tbody></table></td></tr></tbody></table></form></div><div class="waiting rich-text" ng-show="selectedTab === TAB_TYPES.WAITING"><div class="filters"><table class="tbl-border-light"><tbody><tr><td><div ng-class="{\'active\': activeFilters[FILTER_TYPES.SELECTED_VILLAGE]}" ng-click="toggleFilter(FILTER_TYPES.SELECTED_VILLAGE)" class="box-border-dark icon selectedVillage" tooltip="" tooltip-content="{{ \'filters_selected_village\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-village-info icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.BARBARIAN_TARGET]}" ng-click="toggleFilter(FILTER_TYPES.BARBARIAN_TARGET)" class="box-border-dark icon barbarianTarget" tooltip="" tooltip-content="{{ \'filters_barbarian_target\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-barbarian-village icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.ATTACK]}" ng-click="toggleFilter(FILTER_TYPES.ATTACK, true)" class="box-border-dark icon allowedTypes" tooltip="" tooltip-content="{{ \'filters_attack\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-attack icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.SUPPORT]}" ng-click="toggleFilter(FILTER_TYPES.SUPPORT, true)" class="box-border-dark icon allowedTypes" tooltip="" tooltip-content="{{ \'filters_support\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-support icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.RELOCATE]}" ng-click="toggleFilter(FILTER_TYPES.RELOCATE, true)" class="box-border-dark icon allowedTypes" tooltip="" tooltip-content="{{ \'filters_relocate\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-relocate icon-bg-black"></span></div><div class="text"><input ng-model="filtersData[FILTER_TYPES.TEXT_MATCH]" type="text" class="box-border-dark" placeholder="{{ \'filters_text_match\' | i18n:loc.ale:textObject }}"></div></td></tr></tbody></table></div><div class="queue"><h5 class="twx-section">{{ \'queue_waiting\' | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!visibleWaitingCommands.length">{{ \'queue_none_added\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light" ng-repeat="command in visibleWaitingCommands"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"><span ng-class="{true: \'icon-bg-red\', false:\'icon-bg-blue\'}[command.type === \'attack\']" class="icon-26x26-{{ command.type }}" tooltip="" tooltip-content="{{ command.type | i18n:loc.ale:textObjectCommon }}"></span> <span class="size-26x26 icon-bg-black icon-26x26-time-duration" tooltip="" tooltip-content="{{ \'command_time_left\' | i18n:loc.ale:textObject }}"></span> <span class="time-left">{{ command.countdown() }}</span> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="" tooltip-content="{{ \'command_out\' | i18n:loc.ale:textObject }}"></span> <span class="sent-time">{{ command.sendTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="" tooltip-content="{{ \'command_arrive\' | i18n:loc.ale:textObject }}"></span> <span class="arrive-time">{{ command.arriveTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <a href="#" class="remove-command size-20x20 btn-red icon-20x20-close" ng-click="removeCommand(command, EVENT_CODES.COMMAND_REMOVED)" tooltip="" tooltip-content="{{ \'queue_remove\' | i18n:loc.ale:textObject }}"></a></th></tr><tr><td>{{ \'villages\' | i18n:loc.ale:textObjectCommon }}</td><td><a class="origin"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.origin.id)">{{ command.origin.name }} ({{ command.origin.x }}|{{ command.origin.y }})</span></a> <span class="size-20x20 icon-26x26-{{ command.type }}"></span> <a class="target"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.target.id)">{{ command.target.name }} ({{ command.target.x }}|{{ command.target.y }})</span></a></td></tr><tr><td>{{ \'units\' | i18n:loc.ale:textObjectCommon }}</td><td class="units"><div class="unit" ng-repeat="(unit, amount) in command.units"><span class="icon-34x34-unit-{{ unit }} icon"></span> <span class="amount">{{ amount }}</span> <span ng-if="unit === \'catapult\' && command.type === \'attack\'">({{ command.catapultTarget | i18n:loc.ale:textObjectCommon }})</span></div><div class="officer" ng-repeat="(officer, enabled) in command.officers"><span class="icon-34x34-premium_officer_{{ officer }}"></span></div></td></tr></tbody></table></div></div><div class="logs rich-text" ng-show="selectedTab === TAB_TYPES.LOGS"><h5 class="twx-section">{{ \'queue_sent\' | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!sentCommands.length">{{ \'queue_none_sent\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light" ng-repeat="command in sentCommands track by $index"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"><span ng-class="{true: \'icon-bg-red\', false:\'icon-bg-blue\'}[command.type === \'attack\']" class="icon-26x26-{{ command.type }}" tooltip="" tooltip-content="{{ command.type | i18n:loc.ale:textObjectCommon }}"></span> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="" tooltip-content="{{ \'command_out\' | i18n:loc.ale:textObject }}"></span> <span class="sent-time">{{ command.sendTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="" tooltip-content="{{ \'command_arrive\' | i18n:loc.ale:textObject }}"></span> <span class="arrive-time">{{ command.arriveTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span></th></tr><tr><td>{{ \'villages\' | i18n:loc.ale:textObjectCommon }}</td><td><a class="origin"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.origin.id)">{{ command.origin.name }} ({{ command.origin.x }}|{{ command.origin.y }})</span></a> <span class="size-20x20 icon-26x26-{{ command.type }}"></span> <a class="target"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.target.id)">{{ command.target.name }} ({{ command.target.x }}|{{ command.target.y }})</span></a></td></tr><tr><td>{{ \'units\' | i18n:loc.ale:textObjectCommon }}</td><td class="units"><div class="unit" ng-repeat="(unit, amount) in command.units"><span class="icon-34x34-unit-{{ unit }} icon"></span> <span class="amount">{{ amount }}</span> <span ng-if="unit === \'catapult\' && command.type === \'attack\'">({{ command.catapultTarget | i18n:loc.ale:textObjectCommon }})</span></div><div class="officer" ng-repeat="(officer, enabled) in command.officers"><span class="icon-34x34-premium_officer_{{ officer }}"></span></div></td></tr></tbody></table><h5 class="twx-section">{{ \'queue_expired\' | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!expiredCommands.length">{{ \'queue_none_expired\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light" ng-repeat="command in expiredCommands track by $index"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"><span ng-class="{true: \'icon-bg-red\', false:\'icon-bg-blue\'}[command.type === \'attack\']" class="icon-26x26-{{ command.type }}" tooltip="" tooltip-content="{{ command.type | i18n:loc.ale:textObjectCommon }}"></span> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="" tooltip-content="{{ \'command_out\' | i18n:loc.ale:textObject }}"></span> <span class="sent-time">{{ command.sendTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="" tooltip-content="{{ \'command_arrive\' | i18n:loc.ale:textObject }}"></span> <span class="arrive-time">{{ command.arriveTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span></th></tr><tr><td>{{ \'villages\' | i18n:loc.ale:textObjectCommon }}</td><td><a class="origin"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.origin.id)">{{ command.origin.name }} ({{ command.origin.x }}|{{ command.origin.y }})</span></a> <span class="size-20x20 icon-26x26-{{ command.type }}"></span> <a class="target"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.target.id)">{{ command.target.name }} ({{ command.target.x }}|{{ command.target.y }})</span></a></td></tr><tr><td>{{ \'units\' | i18n:loc.ale:textObjectCommon }}</td><td class="units"><div class="unit" ng-repeat="(unit, amount) in command.units"><span class="icon-34x34-unit-{{ unit }} icon"></span> <span class="amount">{{ amount }}</span> <span ng-if="unit === \'catapult\' && command.type === \'attack\'">({{ command.catapultTarget | i18n:loc.ale:textObjectCommon }})</span></div><div class="officer" ng-repeat="(officer, enabled) in command.officers"><span class="icon-34x34-premium_officer_{{ officer }}"></span></div></td></tr></tbody></table></div></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li ng-show="selectedTab === TAB_TYPES.LOGS"><a class="btn-orange btn-border" ng-click="clearRegisters()">{{ \'general_clear\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.ADD"><a class="btn-orange btn-border add" ng-click="addCommand(\'attack\')"><span class="icon-26x26-attack-small"></span> {{ \'attack\' | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.ADD"><a class="btn-orange btn-border add" ng-click="addCommand(\'support\')"><span class="icon-26x26-support"></span> {{ \'support\' | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.ADD"><a class="btn-orange btn-border add" ng-click="addCommand(\'relocate\')"><span class="icon-26x26-relocate"></span> {{ \'relocate\' | i18n:loc.ale:textObjectCommon }}</a></li><li><a href="#" ng-class="{false:\'btn-green\', true:\'btn-red\'}[running]" class="btn-border" ng-click="switchCommandQueue()"><span ng-show="running">{{ \'deactivate\' | i18n:loc.ale:textObjectCommon }}</span> <span ng-show="!running">{{ \'activate\' | i18n:loc.ale:textObjectCommon }}</span></a></li></ul></footer></div>'),a.addStyle('#two-commandqueue input[type="text"]{width:200px}#two-commandqueue input.unit{width:80px;height:34px}#two-commandqueue form .padded{padding:2px 8px}#two-commandqueue a.select-handler{-webkit-box-shadow:none;box-shadow:none;height:22px;line-height:22px}#two-commandqueue a.select-button{height:22px}#two-commandqueue .custom-select{width:240px}#two-commandqueue .originVillage,#two-commandqueue .targetVillage{padding:0 7px}#two-commandqueue a.btn{height:28px;line-height:28px;padding:0 10px}#two-commandqueue .actions{text-align:center}#two-commandqueue .add-units td{text-align:center}#two-commandqueue .add-units .unit-icon{top:-1px}#two-commandqueue .add-units input{height:34px;line-height:26px;color:#fff3d0;font-size:14px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAABGdBTUEAALGPC/xhBQAAALRQTFRFr6+vmJiYoKCgrKysq6urpaWltLS0s7OzsLCwpKSkm5ubqKiojY2NlZWVk5OTqampbGxsWFhYUVFRhISEgYGBmpqaUFBQnp6eYmJidnZ2nZ2dY2NjW1tbZ2dnoaGhe3t7l5eXg4ODVVVVWVlZj4+PXFxcVlZWkpKSZmZmdXV1ZWVlc3NzjIyMXl5eVFRUeHh4hoaGYWFhXV1dbW1tampqb29veXl5fHx8gICAiYmJcnJyTk5Ooj6l1wAAADx0Uk5TGhkZGhoaGxoaGRkaGRkZGhkbHBgYGR0ZGhkZGhsZGRgZGRwbGRscGRoZGhkZGhwZGRobGRkZGRkZGRkeyXExWQAABOJJREFUSMeNVgdy4zgQxIW9TQ7KOVEUo5gz0f//1/WA0sple6+OLokQiUk9PQ2rvlzvT0vA6xDXU3R5hQmqddDVaIELsMl3KLUGoFHugUphjt25PWkE6KMAqPkO/Qh7HRadPmTNxKJpWuhSjLZAoSZmXYoPXh0w2R2z10rjBxpMNRfomhbNFUfUFbfUCh6TWmO4ZqNn6Jxekx6lte3h9IgYv9ZwzIZXfhQ/bejmsYkgOeVInoDGT6KGP9MMbsj7mtEKphKgVFKkJGUM+r/00zybNkPMFWYske+jY9hUblbrK4YosyPtrxl+5kNRWSb2B3+pceKT05SQRPZY8pVSGoWutgen2junRVKPZJ0v5Nu9HAk/CFPr+T1XTkXYFWSJXfTyLPcpcPXtBZIPONq/cFQ0Y0Lr1GF6f5doHdm2RLTbQMpMmCIf/HGm53OLFPiiEOsBKtgHccgKTVwn8l7kbt3iPvqniMX4jgWj4aqlX43xLwXVet5XTG1cYp/29m58q6ULSa7V0M3UQFyjd+AD+1W9WLBpDd9uej7emFbea/+Yw8faySElQQrBDksTpTOVIG/SE2HpPvZsplJWsblRLEGXATEW9YLUY1rPSdivBDmuK3exNiAysfPALfYZFWJrsA4Zt+fftEeRY0UsMDqfyNCKJpdrtI1r2k0vp9LMSwdO0u5SpjBeEYz5ebhWNbwT2g7OJXy1vjW+pEwyd1FTkAtbzzcbmX1yZlkR2pPiXZ/mDbPNWvHRsaKfLH8+FqiZbnodbOK9RGWlNMli8k+wsgbSNwS35QB6qxn53xhu2DFqUilisB9q2Zqw4nNI9tOB2z8GbkvEdNjPaD2j+9pwEC+YlWJvI7xN7xMC09eqhq/qwRvz3JWcFWmkjrWBWSiOysEmc4LmMb0iSsxR8+Z8pk3+oE39cdAmh1xSDXuAryRLZgpp9V62+8IOeBSICjs8LlbtKGN4E7XGoGASIJ+vronVa5mjagPHIFJA2b+BKkZC5I/78wOqmzYp1N8vzTkWIWz6YfsS3eh3w8pBkfKz6TSLxK9Qai5DUGTMZ8NNmrW8ldNudIJq+eJycwjv+xbeOJwPv1jjsSV/rCBaS/IBrafaUQ+5ksHwwl9y9X7kmvvIKWoBDFvbWySGyMU3XflxZRkNeRU63otWb0+P8H8BrRokbJivpWkk6m6LccSlrC2K0i6+4otx4dN3mbAVKt0wbaqBab4/MW8rgrS8JP06HU6UYSTYsQ5pYETpo87ZonORvbPlvYbXwmsMgoQGKr8PUQ5dDEO0EcXp2oOfSk+YpR/Eg4R46O0/Sf7jVnbqbXBrRkCPsZFOQTN8h+aqlcRw9FjJ/j8V7SXZ3hVNXYsOYcxzpfPNgFrvB9S6Dej2PqDqq0su+5ng0WMi527p/pA+OiW0fsYzDa6sPS9C1qxTtxVRMuySrwPD6qGPRKc4uIx4oceJ9FPjxWaqPPebzyXxU7W1jNqqOw+9z6X/k+Na3SBa0v+VjgoaULR30G1nxvZN1vsha2UaSrKy/PyCaHK5zAYnJzm9RSpSPDWbDVu0dkUujMmB/ly4w8EnDdXXoyX/VfhB3yKzMJ2BSaZO+A9GiNQMbll+6z1WGLWpEGMeEg85MESSep0IPFaHYZZ1QOW/xcjfxGhNjP0tRtbhFHOmhhjAv/p77JrCX3+ZAAAAAElFTkSuQmCC) top left #b89064;box-shadow:inset 0 0 0 1px #000,inset 0 0 0 2px #a2682c,inset 0 0 0 3px #000,inset -3px -3px 2px 0 #fff,inset 0 0 9px 5px rgba(99,54,0,0.5);text-align:center;width:80px}#two-commandqueue .add-officers .cell-officers{padding:7px 11px 5px 11px}#two-commandqueue .add-officers .amount{color:#fff;text-align:center}#two-commandqueue .command{margin-bottom:10px}#two-commandqueue .command .time-left{width:93px;display:inline-block;padding:0 0 0 3px}#two-commandqueue .command .sent-time,#two-commandqueue .command .arrive-time{width:160px;display:inline-block;padding:0 0 0 5px}#two-commandqueue .command td{padding:3px 6px}#two-commandqueue .officers td{width:111px;text-align:center}#two-commandqueue .officers label{margin-left:5px}#two-commandqueue .officers span{margin-left:2px}#two-commandqueue .units div.unit{float:left}#two-commandqueue .units div.unit span.icon{transform:scale(.7);width:25px;height:25px}#two-commandqueue .units div.unit span.amount{vertical-align:-2px;margin:0 5px 0 2px}#two-commandqueue .units div.officer{float:left;margin:0 2px}#two-commandqueue .units div.officer span{transform:scale(.7);width:25px;height:25px}#two-commandqueue .remove-command{float:right;margin-top:3px}#two-commandqueue .tbl-units td{text-align:center}#two-commandqueue .tbl-speed{margin-top:10px}#two-commandqueue .tbl-speed th{text-align:center}#two-commandqueue .tbl-speed td{font-size:12px}#two-commandqueue .tbl-speed .box-time-sub-icon{position:relative}#two-commandqueue .tbl-speed .box-time-sub-icon .time-icon{position:absolute;top:-3px;left:27px;transform:scale(.7)}#two-commandqueue .tbl-speed .box-time-sub-icon.time-relocate .time-icon{top:-6px;left:26px}#two-commandqueue .dateType{width:200px}#two-commandqueue .dateType .custom-select-handler{text-align:left}#two-commandqueue .filters .icon{width:38px;float:left;margin:0 6px}#two-commandqueue .filters .icon.active:before{box-shadow:0 0 0 1px #000,-1px -1px 0 2px #ac9c44,0 0 0 3px #ac9c44,0 0 0 4px #000;border-radius:1px;content:"";position:absolute;width:38px;height:38px;left:-1px;top:-1px}#two-commandqueue .filters .text{margin-left:262px}#two-commandqueue .filters .text input{height:36px;margin-top:1px;width:100%;text-align:left;padding:0 5px}#two-commandqueue .filters .text input::placeholder{color:white}#two-commandqueue .filters .text input:focus::placeholder{color:transparent}#two-commandqueue .filters td{padding:6px}#two-commandqueue .icon-34x34-barbarian-village:before{filter:grayscale(100%);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-220px -906px}#two-commandqueue .icon-20x20-time-arrival:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-529px -454px}#two-commandqueue .icon-20x20-attack:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px;width:26px;height:26px}#two-commandqueue .icon-20x20-support:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-462px -360px;width:26px;height:26px}#two-commandqueue .icon-20x20-relocate:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-1090px -130px;width:26px;height:26px}#two-commandqueue .icon-26x26-attack:before{background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px}')}}),define("two/farm",["two/farm/Village","two/farm/errorTypes","two/farm/settings","two/farm/settingsMap","two/farm/settingsUpdate","two/farm/logTypes","two/utils","helper/math","conf/conf","struct/MapData","helper/mapconvert","helper/time","conf/gameStates","Lockr","queues/EventQueue"],function(e,t,a,s,u,g,p,m,E,f,v,T,h,b,A){var S,I,R,O,w,L,C,x,N=!1,y=null,M={},D=[],G=!1,P=[],k=[],U=[],q=[],V={},B=[],H="farmoverflow_indexes",j="farmoverflow_logs",F="farmoverflow_last_attack",Y="farmoverflow_last_activity",W="farmoverflow_settings",z="no_units",Q="no_units_no_commands",K="attacking",$="paused",X="loading_targets",Z="analyse_targets",J="command_limit",ee="no_villages",te="step_cycle_end",ie="step_cycle_end_no_villages",ae="step_cycle_next",ne="full_storage",oe="units",le="commands",re="full_storage",se=$,ce=[],de=[],ue={},ge=!1,_e="",pe={},me=[function(e){return e.id<0},function(e){return e.character_id===I.getId()},function(e){return!!e.attack_protection},function(e){return e.character_id&&!q.includes(e.id)},function(e){return e.points<M[a.MIN_POINTS]||e.points>M[a.MAX_POINTS]},function(e){var t=m.actualDistance(O.position,e);return t<M[a.MIN_DISTANCE]||t>M[a.MAX_DISTANCE]}],Ee=function(){return angular.isArray(M[a.GROUP_INCLUDE])?angular.isArray(M[a.GROUP_ONLY])?(G=M[a.GROUP_IGNORE],P=M[a.GROUP_INCLUDE],void(k=M[a.GROUP_ONLY])):(console.error("groupOnly must be an Array"),!1):(console.error("groupInclude must be an Array"),!1)},fe=function(){var e,t=n.getGroupList();U=[],q=[],G&&("number"!=typeof G?console.error("groupIgnore must be a id number"):U=t.getGroupVillageIds(G)),P.length&&P.forEach(function(i){e=t.getGroupVillageIds(i),q=q.concat(e)})},ve=function(){var t,i,a=I.getVillageList().map(function(t){return new e(t)}).filter(function(e){return!U.includes(e.id)});k.length&&(t=n.getGroupList(),i=[],k.forEach(function(e){i=i.concat(t.getGroupVillageIds(e))}),a=a.filter(function(e){return i.includes(e.id)})),w=1===(ce=a).length,O=ce[0],y.running&&ge&&a.some(function(e){if(!V[e.id])return ge=!1,y.analyse(),!0}),A.trigger(r.FARM_VILLAGES_UPDATE)},Te=function(e){var t=function(t){D=[],M[a.PRESETS].length?(M[a.PRESETS].forEach(function(e){D.push({id:e,units:function(e){var t,i={};for(t in e)e[t]>0&&(i[t]=e[t]);return i}(t[e].units)})}),e&&e()):e&&e()};n.getPresetList().isLoaded()?t(n.getPresetList().getPresets()):o.emit(l.GET_PRESETS,{},function(e){var i,a;A.trigger(r.FARM_PRESETS_LOADED),t((i=e.presets,a={},i.forEach(function(e){a[e.id]=e}),a))})},he=function(){var e=[],t=function(e){Le(e.id,function(e){var t=e.ReportAttack,i=t.attVillageId,a=t.defVillageId;if(pe.hasOwnProperty(i)||(pe[i]=[]),pe[i].includes(a))return!1;pe[i].push(a),A.trigger(r.FARM_PRIORITY_TARGET_ADDED,{id:a,name:t.defVillageName,x:t.defVillageX,y:t.defVillageY})})};i.$on(r.REPORT_NEW,function(i,n){if(!y.running||"attack"!==n.type)return!1;var o;M[a.IGNORE_ON_LOSS]&&1!==n.result&&(o=Oe(n.target_village_id))&&Re(o),M[a.PRIORITY_TARGETS]&&"full"===n.haul&&(c.isTemplateOpen("report")?e.push(n):t(n))}),i.$on(r.WINDOW_CLOSED,function(i,a){"report"===a&&(e.forEach(function(e){t(e)}),e=[])})},be=function(e){if(!e)return!1;B.unshift(e),De(B),A.trigger(r.FARM_LOGS_UPDATED)},Ae=function(){C=T.gameTime(),b.set(F,C)},Se=function(e){var t=ce.indexOf(e);return-1!==t&&ce[t]},Ie=function(e){var t=Se(e);return!!t&&(O=t,!0)},Re=function(e){if(!G)return!1;o.emit(l.GROUPS_LINK_VILLAGE,{group_id:G,village_id:e.id},function(){A.trigger(r.FARM_IGNORED_VILLAGE,e)})},Oe=function(e){var t,i,a,n;for(t in ue)for(i=ue[t],a=0;a<i.length;a++)if((n=i[a]).id===e)return n;return!1},we=function(){V={}},Le=function(e,t){o.emit(l.REPORT_GET,{id:e},t)},Ce=function(e,t){o.emit(l.MESSAGE_REPLY,{message_id:e,message:t})},xe=function(){var e,t,n=_("i18n")("status",i.loc.ale,"common"),o=_("i18n")("selected_village",i.loc.ale,"farm"),l=_("i18n")("last_attack",i.loc.ale,"farm"),r=null,s=p.genVillageLabel(O),c=p.formatDate(C),d=O.id,u=[];return se===ae&&(e=T.gameTime()+60*M[a.STEP_CYCLE_INTERVAL],r=p.formatDate(e)),t=_("i18n")(se,i.loc.ale,"farm",r),u.push(`[b]${n}:[/b] ${t}[br]`),u.push(`[b]${o}:[/b] `),u.push(`[village=${d}]${s}[/village][br]`),u.push(`[b]${l}:[/b] ${c}`),u.join("")},Ne=function(e){se=e,A.trigger(r.FARM_STATUS_CHANGE,e)},ye=function(){return ce.filter(function(e){return!V[e.id]&&(!M[a.IGNORE_FULL_STORAGE]||!Ge(e)||(V[e.id]=re,!1))})},Me=function(e,t){V[e]=t||!0},De=function(e){e.length>M[a.LOGS_LIMIT]&&(e=e.slice(0,M[a.LOGS_LIMIT])),B=e,b.set(j,B)},Ge=function(e){var t,i,a,n=e||O;return!!n.original.isReady()&&(t=n.original.getResources(),i=t.getComputed(),a=t.getMaxStorage(),["wood","clay","iron"].every(function(e){return i[e].currentStock===a}))},Pe=function(){clearTimeout(y.timeoutId),y.running=!1},ke=function(){L=T.gameTime(),b.set(Y,L)},Ue=function(e){var t,i,n,o,l,s,c=O.id;if(!ue[c])return y.analyse(),!1;if(t=ue[c],M[a.PRIORITY_TARGETS]&&pe[c])for(;i=pe[c].shift();)if(!U.includes(i))for(n=0;n<t.length;n++)if(t[n].id===i)return S=t[n],!0;for(o=x[c],l=!1,e||(o=++x[c]);o<t.length;o++){if(s=t[o],!U.includes(s.id)){S=s,l=!0;break}A.trigger(r.FARM_IGNORED_TARGET,[s])}return l?x[c]=o:(S=t[0],x[c]=0),b.set(H,x),!0},qe=function(e){var t,i,a,n=O.position,o=O.id,l=E.MAP_CHUNK_SIZE,s=n.x-l,c=n.y-l,d=2*l,u=2*l;if(o in ue)return e();!function(e,t,i,a,n,o){var l,s,c,d;if(f.hasTownDataInChunk(e,t))return l=f.loadTownData(e,t,i,a,n),o(l);A.trigger(r.FARM_LOADING_TARGETS_START),s=v.scaledGridCoordinates(e,t,i,a,n),c=s.length,d=0,f.loadTownDataAsync(e,t,i,a,function(){++d===c&&(A.trigger(r.FARM_LOADING_TARGETS_END),l=f.loadTownData(e,t,i,a,n),o(l))})}(s,c,d,u,l,function(n){if(t=function(e){for(var t,i,a,n,o,l=e.length,r=[];l--;)for(i in t=e[l].data)for(n in a=t[i])o=a[n],r.push(o);return r}(n),i=t.filter(function(e){return me.every(function(t){return!t(e)})}),0===(a=function(e){var t,i,a=[],n=O.position;for(i=0;i<e.length;i++)t=e[i],a.push({x:t.x,y:t.y,distance:m.actualDistance(n,t),id:t.id,name:t.name,pid:t.character_id});return a}(i)).length)return Ve()?qe(e):A.trigger(r.FARM_NO_TARGETS),!1;ue[o]=a.sort(function(e,t){return e.distance-t.distance}),x.hasOwnProperty(o)?x[o]>ue[o].length&&(x[o]=0,b.set(H,x)):(x[o]=0,b.set(H,x)),e()})},Ve=function(){var e;return!w&&(M[a.STEP_CYCLE]?je.nextVillage():(e=de.shift())?ye().some(function(t){return t.id===e.id})?(O=e,A.trigger(r.FARM_NEXT_VILLAGE,O),ke(),!0):Ve():(de=ye()).length?Ve():(w?A.trigger(r.FARM_NO_UNITS):A.trigger(r.FARM_NO_VILLAGES),!1))},Be=function(e){if(!D.length)return Fe.pause(),A.trigger(r.FARM_NO_PRESET),!1;var t,i=O.id,a=n.getPresetList().getPresetsByVillageId(i),s=!1,c=[];if(D.forEach(function(e){a.hasOwnProperty(e.id)||(s=!0,c.push(e.id))}),s){for(t in a)c.push(t);!function(e,t){o.emit(l.ASSIGN_PRESETS,{village_id:O.id,preset_ids:e},t)}(c,e)}else e()},He=function(){var e=!1;function n(){return this.preventNextCommand=!1,this.timeoutId=null,this.running=!1,this}return n.prototype.analyse=function(){var e;if(this.running){if(!D.length)return Fe.pause(),void A.trigger(r.FARM_NO_PRESET);if(!O)return A.trigger(r.FARM_NO_VILLAGE_SELECTED);if(O.loaded())if(V.hasOwnProperty(O.id)||U.includes(O.id))Ve()?this.analyse():A.trigger(_e);else if(M[a.IGNORE_FULL_STORAGE]&&Ge())Ve()?this.analyse():this.handleError(t.FULL_STORAGE);else{if(!ue.hasOwnProperty(O.id))return qe(()=>{this.analyse()});var i,n,o;if(i=O.id,n=x[i],(o=ue[i]).length&&((void 0===n||n>o.length)&&(x[i]=n=0),o[n]))Ue(!0),Be(()=>O.countCommands()>=M[a.COMMANDS_PER_VILLAGE]?this.handleError(t.COMMAND_LIMIT):(e=this.getPreset()).error?this.handleError(e.error):(this.getPresetNext(e),void this.send(e)));else Ve()?this.analyse():A.trigger(r.FARM_NO_TARGETS)}else O.load(()=>{this.analyse()})}},n.prototype.handleError=function(e){_e=e||this.preventNextCommand,this.preventNextCommand=!1;var i,n=O.id;switch(_e){case t.TIME_LIMIT:Ue(),this.analyse();break;case t.NO_UNITS:A.trigger(r.FARM_NO_UNITS,[O]),Me(n,oe),Ve()?this.analyse():ge=!0;break;case t.COMMAND_LIMIT:if(Me(n,le),function(){var e,t;for(e=0;e<ce.length;e++)if(t=ce[e].id,!V.hasOwnProperty(t))return!1;return!0}()&&(i=r.FARM_COMMAND_LIMIT_MULTI,A.trigger(i,[O]),ge=!0,M[a.STEP_CYCLE]))return je.endStep();Ve(),this.analyse();break;case t.FULL_STORAGE:Me(n,re)}},n.prototype.getPreset=function(e){var i,a,n=!1,o=e||O.units,l=!1;return D.forEach(e=>{if(l)return!1;for(a in i=!0,e.units)o[a].in_town<e.units[a]&&(i=!1);i&&(this.checkPresetTime(e)?l=e:n=!0)}),l||{error:n?t.TIME_LIMIT:t.NO_UNITS}},n.prototype.getPresetNext=function(e){var t,i,a=angular.copy(O.units),n=e.units;for(t in n)a[t].in_town-=n[t];(i=this.getPreset(a)).error&&(this.preventNextCommand=i.error)},n.prototype.checkPresetTime=function(e){var t=60*M[a.MAX_TRAVEL_TIME],i=O.position,n=m.actualDistance(i,S),o=d.calculateTravelTime(e,{barbarian:!S.pid,officers:!1});return t>d.getTravelTimeForDistance(e,o,n,"attack")},n.prototype.send=function(t,i){var n,r,s,c=Date.now();return!(e&&c-e<100)&&(e=c,!!this.running&&(this.simulate(),n=this.onCommandError(()=>{r(),O.updateCommands(()=>{this.analyse()})}),r=this.onCommandSend(()=>{n(),Ue(),s=100+1e3*(s=p.randomSeconds(M[a.RANDOM_BASE])),this.timeoutId=setTimeout(()=>{if(this.preventNextCommand)return this.handleError();this.analyse()},s),ke()}),o.emit(l.SEND_PRESET,{start_village:O.id,target_village:S.id,army_preset_id:t.id,type:"attack"}),!0))},n.prototype.onCommandSend=function(e){var t,a=angular.copy(O.units),n=i.$on(r.VILLAGE_UNIT_INFO,function(i,o){return O.id===o.village_id&&(t=O.units,!angular.equals(a,t)&&(A.trigger(r.FARM_SEND_COMMAND,[O,S]),n(),void e()))});return n},n.prototype.onCommandError=function(e){var t=i.$on(r.MESSAGE_ERROR,function(i,a){return!(!a.cause||!a.code)&&("Command/sendPreset"===a.cause&&("Command/attackLimitExceeded"===a.code&&(A.trigger(r.FARM_SEND_COMMAND_ERROR,[a.code]),t(),void e())))});return t},n.prototype.simulate=function(e){o.emit(l.GET_ATTACKING_FACTOR,{target_id:S.id}),e&&e()},n}(),je=function(){var e=[],t=null,i={intervalEnabled:function(){return!!M[a.STEP_CYCLE_INTERVAL]},startContinuous:function(e){(y=new He).running=!0,A.trigger(r.FARM_START,e),ye().length?(de=ye(),y.analyse()):w?Ge()?A.trigger(r.FARM_FULL_STORAGE):A.trigger(r.FARM_NO_UNITS):A.trigger(r.FARM_NO_VILLAGES)},startStep:function(t){var a=ye();if((y=new He).running=!0,A.trigger(r.FARM_START,t),0===a.length)return A.trigger(r.FARM_STEP_CYCLE_NEXT_NO_VILLAGES),void(i.intervalEnabled()?i.setNextCycle():Fe.pause(t));t||A.trigger(r.FARM_STEP_CYCLE_RESTART),e=a,y.analyse()},endStep:function(){return i.intervalEnabled()?(A.trigger(r.FARM_STEP_CYCLE_NEXT),Pe(),i.setNextCycle()):(A.trigger(r.FARM_STEP_CYCLE_END),Fe.pause()),!1},setNextCycle:function(){t=setTimeout(function(){i.startStep()},60*M[a.STEP_CYCLE_INTERVAL])},nextVillage:function(){var t=e.shift();return t?ye().some(function(e){return e.id===t.id})?(O=t,A.trigger(r.FARM_NEXT_VILLAGE,t),!0):i.nextVillage():i.endStep()},getTimeoutId:function(){return t}};return i}(),Fe={};return Fe.init=function(){var e,t,c,d;N=!0,I=n.getSelectedCharacter(),R=n.getGameState(),B=b.get(j,[],!0),L=b.get(Y,T.gameTime(),!0),C=b.get(F,-1,!0),x=b.get(H,{},!0),y=new He,function(){var e,t=b.get(W,{},!0);for(e in s)M[e]=t.hasOwnProperty(e)?t[e]:s[e].default}(),Ee(),fe(),ve(),Te(),he(),i.$on(r.MESSAGE_SENT,function(e,t){var i=M[a.REMOTE_ID];if(1!==t.participants.length||t.title!==i)return!1;switch(t.message.content.trim().toLowerCase()){case"on":case"start":case"init":case"begin":Fe.restart(),Ce(t.message_id,xe()),A.trigger(r.FARM_REMOTE_COMMAND,["on"]);break;case"off":case"stop":case"pause":case"end":Fe.pause(),Ce(t.message_id,xe()),A.trigger(r.FARM_REMOTE_COMMAND,["off"]);break;case"status":case"current":Ce(t.message_id,xe()),A.trigger(r.FARM_REMOTE_COMMAND,["status"])}return!1}),e=function(){Ee(),fe(),A.trigger(r.FARM_GROUPS_CHANGED)},t=function(e,t){if(ve(),!P.length)return!1;P.includes(t.group_id)&&(ue={})},i.$on(r.GROUPS_UPDATED,e),i.$on(r.GROUPS_CREATED,e),i.$on(r.GROUPS_DESTROYED,e),i.$on(r.GROUPS_VILLAGE_LINKED,t),i.$on(r.GROUPS_VILLAGE_UNLINKED,t),c=function(){Te(),A.trigger(r.FARM_PRESETS_CHANGE),y.running&&(D.length?ge&&(we(),Fe.restart()):(A.trigger(r.FARM_NO_PRESET),Fe.pause()))},i.$on(r.ARMY_PRESET_UPDATE,c),i.$on(r.ARMY_PRESET_DELETED,c),d=function(e){if(delete V[e],ge){if(ge=!1,M[a.STEP_CYCLE])return!1;y.running&&(Ie(e),y.analyse())}},i.$on(r.VILLAGE_ARMY_CHANGED,function(e,t){var i=t.village_id,a=V[i]||!1;if("units"===a||"commands"===a)return d(i),!1}),i.$on(r.VILLAGE_RESOURCES_CHANGED,function(e,t){var i,a=t.villageId;(V[a]||!1)===re?d(a):(i=Se(a),Ge(i)&&Me(a,re))}),f.setRequestFn(function(e){o.emit(l.MAP_GETVILLAGES,e)}),i.$on(r.RECONNECT,function(){y.running&&setTimeout(function(){Fe.restart()},5e3)}),A.register(r.FARM_SEND_COMMAND,function(e,t){Ae(),Ne(K);var i=t[0],a=t[1];be({icon:"attack-small",origin:{id:i.id,coords:`${i.x}|${i.y}`},target:{id:a.id,coords:`${a.x}|${a.y}`},type:g.ATTACK,time:T.gameTime()})}),A.register(r.FARM_NEXT_VILLAGE,function(e,t){be({icon:"village",village:{id:t.id,coords:`${t.x}|${t.y}`},type:g.VILLAGE_SWITCH,time:T.gameTime()})}),A.register(r.FARM_PRIORITY_TARGET_ADDED,function(e,t){be({icon:"parallel-recruiting",type:g.PRIORITY_TARGET,village:{id:t.id,coords:`${t.x}|${t.y}`},time:T.gameTime()})}),A.register(r.FARM_IGNORED_VILLAGE,function(e,t){be({icon:"check-negative",type:g.IGNORED_VILLAGE,village:{id:t.id,coords:`${t.x}|${t.y}`},time:T.gameTime()})}),A.register(r.FARM_NO_PRESET,function(){Ne($),be({icon:"village",type:g.NO_PRESET,time:T.gameTime()})}),A.register(r.FARM_NO_UNITS,function(){Ne(z)}),A.register(r.FARM_NO_UNITS_NO_COMMANDS,function(){Ne(Q)}),A.register(r.FARM_START,function(){Ne(K)}),A.register(r.FARM_PAUSE,function(){Ne($)}),A.register(r.FARM_LOADING_TARGETS_START,function(){Ne(X)}),A.register(r.FARM_LOADING_TARGETS_END,function(){Ne(Z)}),A.register(r.FARM_COMMAND_LIMIT_SINGLE,function(){Ne(J)}),A.register(r.FARM_COMMAND_LIMIT_MULTI,function(){Ne(ee)}),A.register(r.FARM_STEP_CYCLE_END,function(){Ne(te)}),A.register(r.FARM_STEP_CYCLE_END_NO_VILLAGES,function(){Ne(ie)}),A.register(r.FARM_STEP_CYCLE_NEXT,function(){Ne(ae)}),A.register(r.FARM_FULL_STORAGE,function(){Ne(ne)}),setInterval(function(){if(y.running){var e=T.gameTime()-C,t=3e5;M[a.STEP_CYCLE]&&je.intervalEnabled()&&(t+=60*M[a.STEP_CYCLE_INTERVAL]+6e4),e>t&&(Fe.pause(),Fe.start())}},6e4),setInterval(function(){ue={}},3e5)},Fe.start=function(e){if(!D.length)return A.trigger(r.FARM_ERROR,[t.PRESET_FIRST,e]),t.PRESET_FIRST;if(!O)return A.trigger(r.FARM_ERROR,t.NO_SELECTED_VILLAGE,e),t.NO_SELECTED_VILLAGE;if(!R.getGameState(h.ALL_VILLAGES_READY)){var n=i.$on(r.GAME_STATE_ALL_VILLAGES_READY,function(){n(),Fe.start(e)});return!1}return function(){var e=T.gameTime(),t=60*M[a.STEP_CYCLE_INTERVAL];if(M[a.STEP_CYCLE]&&je.intervalEnabled()){if(e>L+t+6e4)return!0}else if(e>L+18e5)return!0;return!1}()&&(pe={},x={}),M[a.STEP_CYCLE]?je.startStep(e):je.startContinuous(e),ke(),!0},Fe.pause=function(e){return Pe(),A.trigger(r.FARM_PAUSE,e),clearTimeout(je.getTimeoutId()),!0},Fe.restart=function(e){Fe.pause(e),Fe.start(e)},Fe.switchState=function(e){y.running?Fe.pause(e):Fe.start(e)},Fe.updateSettings=function(e){var t,i,a,n,o={};for(n in e)t=s[n],i=e[n],t&&i!==M[n]&&(t.updates.forEach(function(e){o[e]=!0}),M[n]=i);if(b.set(W,M),o[u.GROUPS]&&(Ee(),fe()),o[u.VILLAGES]&&ve(),o[u.PRESET]&&(Te(),we()),o[u.TARGETS]&&(ue={}),o[u.LOGS]&&(De(B),A.trigger(r.FARM_RESET_LOGS)),o[u.FULL_STORAGE])for(a in V)V[a]===re&&delete V[a];if(o[u.WAITING_VILLAGES])for(a in V)V[a]===le&&delete V[a];return y.running&&Fe.restart(),A.trigger(r.FARM_SETTINGS_CHANGE,[o]),!0},Fe.isInitialized=function(){return N},Fe.isRunning=function(){return!!y.running},Fe.getLogs=function(){return B},Fe.clearLogs=function(){B=[],b.set(j,B),A.trigger(r.FARM_LOGS_RESETED)},Fe.getSelectedVillage=function(){return O},Fe.getLastAttack=function(){return C},Fe.getCurrentStatus=function(){return se},Fe.getSettings=function(){return M},Fe}),define("two/farm/errorTypes",[],function(){return{TIME_LIMIT:"time_limit",COMMAND_LIMIT:"command_limit",FULL_STORAGE:"full_storage",NO_UNITS:"no_units",PRESET_FIRST:"preset_first",NO_SELECTED_VILLAGE:"no_selected_village"}}),define("two/farm/Events",[],function(){angular.extend(r,{FARM_NO_PRESET:"farmoverflow_no_preset",FARM_NO_VILLAGE_SELECTED:"farmoverflow_no_village_selected",FARM_NO_TARGETS:"farmoverflow_no_targets",FARM_NO_UNITS:"farmoverflow_no_units",FARM_NO_UNITS_NO_COMMANDS:"farmoverflow_no_units_no_commands",FARM_COMMAND_LIMIT_SINGLE:"farmoverflow_command_limit_single",FARM_COMMAND_LIMIT_MULTI:"farmoverflow_command_limit_multi",FARM_FULL_STORAGE:"farmoverflow_full_storage",FARM_SEND_COMMAND:"farmoverflow_send_command",FARM_SEND_COMMAND_ERROR:"farmoverflow_send_command_error",FARM_VILLAGES_UPDATE:"farmoverflow_villages_update",FARM_PRESETS_LOADED:"farmoverflow_presets_loaded",FARM_PRIORITY_TARGET_ADDED:"farmoverflow_priority_target_added",FARM_REMOTE_COMMAND:"farmoverflow_remote_command",FARM_PRESETS_CHANGE:"farmoverflow_presets_change",FARM_GROUPS_CHANGED:"farmoverflow_groups_changed",FARM_LOGS_UPDATED:"farmoverflow_logs_updated",FARM_LOGS_RESETED:"farmoverflow_logs_reseted",FARM_IGNORED_VILLAGE:"farmoverflow_ignored_village",FARM_LOADING_TARGETS_START:"farmoverflow_loading_targets_start",FARM_LOADING_TARGETS_END:"farmoverflow_loading_targets_end",FARM_STATUS_CHANGE:"farmoverflow_status_change",FARM_START:"farmoverflow_start",FARM_PAUSE:"farmoverflow_pause",FARM_RESET_LOGS:"farmoverflow_reset_logs",FARM_SETTINGS_CHANGE:"farmoverflow_settings_change",FARM_IGNORED_TARGET:"farmoverflow_ignored_target",FARM_NEXT_VILLAGE:"farmoverflow_next_village",FARM_NO_VILLAGES:"farmoverflow_no_villages",FARM_STEP_CYCLE_RESTART:"farmoverflow_step_cycle_restart",FARM_STEP_CYCLE_START:"farmoverflow_step_cycle_start",FARM_STEP_CYCLE_END:"farmoverflow_step_cycle_end",FARM_STEP_CYCLE_NEXT:"farmoverflow_step_cycle_next",FARM_STEP_CYCLE_NEXT_NO_VILLAGES:"farmoverflow_step_cycle_next_no_villages",FARM_STEP_CYCLE_END_NO_VILLAGES:"farmoverflow_step_cycle_end_no_villages",FARM_ERROR:"farmoverflow_error"})}),define("two/farm/logTypes",[],function(){return{ATTACK:"attack",VILLAGE_SWITCH:"village_switch",NO_PRESET:"no_preset",PRIORITY_TARGET:"priority_target",IGNORED_VILLAGE:"ignored_village"}}),define("two/farm/settingsMap",["two/farm/settings","two/farm/settingsUpdate"],function(e,t){return{[e.PRESETS]:{default:[],updates:[t.PRESET]},[e.GROUP_IGNORE]:{default:!1,updates:[t.GROUPS]},[e.GROUP_INCLUDE]:{default:[],updates:[t.GROUPS,t.TARGETS]},[e.GROUP_ONLY]:{default:[],updates:[t.GROUPS,t.VILLAGES,t.TARGETS]},[e.RANDOM_BASE]:{default:3,updates:[]},[e.COMMANDS_PER_VILLAGE]:{default:48,updates:[t.WAITING_VILLAGES]},[e.PRIORITY_TARGETS]:{default:!0,updates:[]},[e.IGNORE_ON_LOSS]:{default:!0,updates:[]},[e.IGNORE_FULL_STORAGE]:{default:!0,updates:[t.FULL_STORAGE]},[e.STEP_CYCLE]:{default:!1,updates:[t.VILLAGES]},[e.STEP_CYCLE_NOTIFS]:{default:!1,updates:[]},[e.STEP_CYCLE_INTERVAL]:{default:0,updates:[]},[e.MAX_DISTANCE]:{default:10,updates:[t.TARGETS]},[e.MIN_DISTANCE]:{default:0,updates:[t.TARGETS]},[e.MIN_POINTS]:{default:0,updates:[t.TARGETS]},[e.MAX_POINTS]:{default:12500,updates:[t.TARGETS]},[e.MAX_TRAVEL_TIME]:{default:60,updates:[]},[e.LOGS_LIMIT]:{default:500,updates:[t.LOGS]},[e.EVENT_ATTACK]:{default:!0,updates:[t.LOGS]},[e.EVENT_VILLAGE_CHANGE]:{default:!0,updates:[t.LOGS]},[e.EVENT_PRIORITY_ADD]:{default:!0,updates:[t.LOGS]},[e.EVENT_IGNORED_VILLAGE]:{default:!0,updates:[t.LOGS]},[e.REMOTE_ID]:{default:"remote",updates:[]},[e.HOTKEY_SWITCH]:{default:"shift+z",updates:[]},[e.HOTKEY_WINDOW]:{default:"z",updates:[]}}}),define("two/farm/settingsUpdate",function(){return{PRESET:"preset",GROUPS:"groups",TARGETS:"targets",VILLAGES:"villages",WAITING_VILLAGES:"waiting_villages",FULL_STORAGE:"full_storage",LOGS:"logs"}}),define("two/farm/settings",[],function(){return{PRESETS:"presets",GROUP_IGNORE:"group_ignore",GROUP_INCLUDE:"group_include",GROUP_ONLY:"group_only",RANDOM_BASE:"random_base",COMMANDS_PER_VILLAGE:"commands_per_village",PRIORITY_TARGETS:"priority_targets",IGNORE_ON_LOSS:"ignore_on_loss",IGNORE_FULL_STORAGE:"ignore_full_storage",STEP_CYCLE:"step_cycle",STEP_CYCLE_NOTIFS:"step_cycle_notifs",STEP_CYCLE_INTERVAL:"step_cycle_interval",MAX_DISTANCE:"max_distance",MIN_DISTANCE:"min_distance",MIN_POINTS:"min_points",MAX_POINTS:"max_points",MAX_TRAVEL_TIME:"max_travel_time",LOGS_LIMIT:"logs_limit",EVENT_ATTACK:"event_attack",EVENT_VILLAGE_CHANGE:"event_village_change",EVENT_PRIORITY_ADD:"event_priority_add",EVENT_IGNORED_VILLAGE:"event_ignored_village",REMOTE_ID:"remote_id",HOTKEY_SWITCH:"hotkey_switch",HOTKEY_WINDOW:"hotkey_window"}}),define("two/farm/Village",["models/CommandListModel","models/CommandModel","conf/village"],function(e,t,i){function a(e){this.original=e,this.id=e.data.villageId,this.x=e.data.x,this.y=e.data.y,this.name=e.data.name,this.units=e.unitInfo.units,this.position=e.getPosition()}return a.prototype.countCommands=function(){return this.original.getCommandListModel().getOutgoingCommands(!0).length},a.prototype.updateCommands=function(i){var a=this;o.emit(l.GET_OWN_COMMANDS,{village_id:a.id},function(n){for(var o=new e([],a.id),l=0;l<n.commands.length;l++){var r=new t(n.commands[l]);o.add(r)}a.original.setCommandListModel(o),i()})},a.prototype.commandsLoaded=function(){return this.original.isReady(i.OWN_COMMANDS)},a.prototype.unitsLoaded=function(){return this.original.isReady(i.UNITS)},a.prototype.loaded=function(){return!!this.original.isReady()&&(!!this.original.isInitialized()&&(this.commandsLoaded()&&this.unitsLoaded()))},a.prototype.load=function(e){var t=this;return u.ensureVillageDataLoaded(this.id,function(){t.original.isInitialized()||u.initializeVillage(t.original),e()})},a}),require(["helper/i18n","two/ready","two/farm","two/farm/ui","two/farm/Events"],function(e,t,a,n){if(a.isInitialized())return!1;t(function(){var t,o,l;t={en_us:{farm:{attacking:"Attacking.",paused:"Paused.",command_limit:"Limit of 50 attacks reached, waiting return.",last_attack:"Last attack",village_switch:"Changing to village",no_preset:"No presets avaliable.",no_selected_village:"No villages avaliable.",no_units:"No units avaliable in village, waiting attacks return.",no_units_no_commands:"No villages has units or commands returning.",no_villages:"No villages avaliable, waiting attacks return.",preset_first:"Set a preset first!",selected_village:"Village selected",loading_targets:"Loading targets...",checking_targets:"Checking targets...",restarting_commands:"Restarting commands...",ignored_village:"added to the ignored list",priority_target:"added to priorities.",analyse_targets:"Analysing targets.",step_cycle_restart:"Restarting the cycle of commands..",step_cycle_end:"The list of villages ended, waiting for the next run.",step_cycle_end_no_villages:"No villages available to start the cycle.",step_cycle_next:"The list of villages is over, next cycle: %{time}.",step_cycle_next_no_villages:"No village available to start the cycle, next cycle: %{time}.",full_storage:"The storage of the village is full.",farm_paused:"FarmOverflow paused.",farm_started:"FarmOverflow started.",groups_presets:"Groups & presets",presets:"Attack with the presets",group_ignored:"Ignore villages from group",group_include:"Include villages from groups",group_only:"Attack only with villages from groups",random_base:"Random interval between attacks",commands_per_village:"Commands limit per village",priority_targets:"Prioritize targets with full loot","settings.ignoreOnLoss":"Ignore target that cause loss","settings.ignoreFullStorage":"Do not farm with villages with full storage",step_cycle_header:"Step Cycle Settings","settings.stepCycle":"Enable Step Cycle",step_cycle_interval:"Interval between cycles (minutes)",step_cycle_notifs:"Cycle notifications",target_filters:"Target Filters",min_distance:"Minimum distance",max_distance:"Maximum distance",min_points:"Minimum points",max_points:"Maximum points",max_travel_time:"Maximum travel time (minutes)",logs_limit:"Limit of logs",event_attack:"Log attacks",event_village_change:"Log village changes",event_priority_add:"Log priority targets",event_ignored_village:"Log ignored villages",remote:"Remote Control Message Subject",hotkey_switch:"Start/pause hotkey",hotkey_window:"Open window hotkey",settings_saved:"Settings saved!",misc:"Miscellaneous",attack:"attack",no_logs:"No logs registered",clear_logs:"Clear logs",reseted_logs:"Registered logs reseted."}},pl_pl:{farm:{attacking:"Atakuje.",paused:"Zatrzymany.",command_limit:"Limit 50 ataków osiągnięty, oczekiwanie na powrót wojsk.",last_attack:"Ostatni atak",village_switch:"Przejście do wioski",no_preset:"Brak dostępnych szablonów.",no_selected_village:"Brak dostępnych wiosek.",no_units:"Brak dostępnych jednostek w wiosce, oczekiwanie na powrót wojsk.",no_units_no_commands:"Brak jednostek w wioskach lub powracających wojsk.",no_villages:"Brak dostępnych wiosek, oczekiwanie na powrót wojsk.",preset_first:"Wybierz najpierw szablon!",selected_village:"Wybrana wioska",loading_targets:"Ładowanie celów...",checking_targets:"Sprawdzanie celów...",restarting_commands:"Restartowanie poleceń...",ignored_village:"added to the ignored list",priority_target:"dodany do priorytetowych.",analyse_targets:"Analizowanie celów.",step_cycle_restart:"Restartowanie cyklu poleceń...",step_cycle_end:"Lista wiosek zakończona, oczekiwanie na następny cykl.",step_cycle_end_no_villages:"Brak wiosek do rozpoczęcia cyklu.",step_cycle_next:"Lista wiosek się skończyła, następny cykl: %{time}.",step_cycle_next_no_villages:"Brak wioski do rozpoczęcia cyklu, następny cykl: %{time}.",full_storage:"Magazyn w wiosce jest pełny",farm_paused:"Farmer zatrzymany",farm_started:"Farmer uruchomiony",groups_presets:"Groups & presets",presets:"Szablony",group_ignored:"Pomijaj wioski z grupy",group_include:"Dodaj wioski z grupy",group_only:"Tylko wioski z grupy",random_base:"Domyślny odstęp (sek)",commands_per_village:"Limit poleceń",priority_targets:"Priorytyzuj cele","settings.ignoreOnLoss":"Pomijaj cele jeśli straty","settings.ignoreFullStorage":"Pomijaj wioski jeśli magazyn pełny",step_cycle_header:"Cykl Farmienia","settings.stepCycle":"Włącz Cykl farmienia",step_cycle_interval:"Odstęp między cyklami (minuty)",step_cycle_notifs:"Powiadomienia",target_filters:"Filtry celów",min_distance:"Minimalna odległość",max_distance:"Maksymalna odległość",min_points:"Minimalna liczba punktów",max_points:"Maksymalna liczba punktów",max_travel_time:"Maksymalny czas podróży (minuty)",logs_limit:"Limit logów",event_attack:"Logi ataków",event_village_change:"Logi zmiany wiosek",event_priority_add:"Logi celów priorytetowych",event_ignored_village:"Logi pominiętych wiosek",remote:"Sterowanie Zdalne za pomocą wiadomości PW",hotkey_switch:"Skrót Start/Pauza",hotkey_window:"Skrót okna Farmera",settings_saved:"Ustawienia zapisane!",misc:"Miscellaneous",attack:"atakuje",no_logs:"No logs registered",clear_logs:"Clear logs",reseted_logs:"Registered logs reseted."}},pt_br:{farm:{attacking:"Atacando.",paused:"Pausado.",command_limit:"Limite de 50 ataques atingido, aguardando retorno.",last_attack:"Último ataque",village_switch:"Alternando para a aldeia",no_preset:"Nenhuma predefinição disponível.",no_selected_village:"Nenhuma aldeia disponível.",no_units:"Sem unidades na aldeia, aguardando ataques retornarem.",no_units_no_commands:"Nenhuma aldeia tem tropas nem ataques retornando.",no_villages:"Nenhuma aldeia disponível, aguardando ataques retornarem.",preset_first:"Configure uma predefinição primeiro!",selected_village:"Aldeia selecionada",loading_targets:"Carregando alvos...",checking_targets:"Checando alvos...",restarting_commands:"Reiniciando comandos...",ignored_village:"adicionado a lista de ignorados.",priority_target:"adicionado as prioridades.",analyse_targets:"Analisando alvos.",step_cycle_restart:"Reiniciando o ciclo de comandos..",step_cycle_end:"A lista de aldeias acabou, esperando próxima execução.",step_cycle_end_no_villages:"Nenhuma aldeia disponível para iniciar o ciclo.",step_cycle_next:"A lista de aldeias acabou, próximo ciclo: %{time}.",step_cycle_next_no_villages:"Nenhuma aldeia disponível para iniciar o ciclo, próximo ciclo: %{time}.",full_storage:"O armazém da aldeia está cheio.",farm_paused:"FarmOverflow pausado.",farm_started:"FarmOverflow iniciado.",groups_presets:"Grupos & predefinições",presets:"Atacar com as predefinições",group_ignored:"Ignorar aldeias do grupo",group_include:"Include aldeias dos grupos",group_only:"Atacar apenas com aldeias dos grupos",random_base:"Intervalo aleatório entre ataques",commands_per_village:"Limite de comandos por aldeia",priority_targets:"Priorizar alvos com saques cheios",ignore_on_loss:"Ignorar alvos que causam perdas",ignore_full_storage:"Ignorar armazéns lotados",step_cycle_header:"Configurações de Ciclos",step_cycle:"Ativar Ciclo",step_cycle_interval:"Intervalo entre ciclos (minutos)",step_cycle_notifs:"Notificações de ciclos",target_filters:"Filtro de Alvos",min_distance:"Distância mínima",max_distance:"Distância máxima",min_points:"Pontuação mínima",max_points:"Pontuação máxima",max_travel_time:"Tempo máximo de viagem (minutos)",logs_limit:"Limite de registros",event_attack:"Registrar ataques",event_village_change:"Registrar troca de aldeias",event_priority_add:"Registrar alvos prioritarios",event_ignored_village:"Registrar alvos ignorados",remote:"Controle Remoto - Mensagem",hotkey_switch:"Atalho para inicar/pausar",hotkey_window:"Atalho para abrir janela",settings_saved:"Configurações salvas!",misc:"Diversos",attack:"ataca",no_logs:"Nenhum evento registrado",clear_logs:"Limpar eventos",reseted_logs:"Registro de eventos resetado."}}},o=i.loc.ale,l=o in t?t[o]:t.en_us,e.setJSON(l),a.init(),n()},["map"])}),define("two/farm/ui",["two/farm","two/farm/errorTypes","two/farm/logTypes","two/farm/settings","two/ui2","two/FrontButton","queues/EventQueue","struct/MapData","helper/time","two/farm/Events","two/utils","two/EventScope"],function(e,t,a,o,l,d,u,m,E,f,v,T){var h,b,A=[o.PRESETS,o.GROUP_IGNORE,o.GROUP_INCLUDE,o.GROUP_ONLY],S={SETTINGS:"settings",LOGS:"logs"},I=S.SETTINGS,R=n.getPresetList(),O=n.getGroupList(),w=function(e){b.selectedTab=e},L=function(){b.logs=[],b.visibleLogs=[],e.clearLogs()},C=function(){var t=angular.copy(b.settings);A.forEach(function(e){angular.isArray(t[e])?t[e].length&&t[e][0].value?t[e]=t[e].map(function(e){return e.value}):t[e]=[]:t[e]=!!t[e].value&&t[e].value}),e.updateSettings(t)},x=function(e){var t,i,a=angular.copy(e),n={},o={};return b.groups.forEach(function(e){n[e.value]={name:e.name,leftIcon:e.leftIcon}}),b.presets.forEach(function(e){o[e.value]=e.name}),A.forEach(function(e){i=a[e],"presets"===e?a[e]=i.map(function(e){return{name:o[e],value:e}}):angular.isArray(i)?a[e]=i.map(function(e){return{name:n[e].name,value:e,leftIcon:n[e].leftIcon}}):i&&(t=a[e],a[e]={name:n[t].name,value:t,leftIcon:n[t].leftIcon})}),function(e){A.forEach(function(t){angular.isArray(e[t])?e[t].length||(e[t]=[N()]):e[t]||(e[t]=N())})}(a),a},N=function(){return{name:_("i18n")("disabled",i.loc.ale,"common"),value:!1}},y=function(){e.switchState(!0)},M=function(){var e=function(e){if(b.villagesLabel[e.coords])return!1;var t=e.coords.split("|"),i=parseInt(t[0],10),a=parseInt(t[1],10);m.getTownAtAsync(i,a,function(t){b.villagesLabel[e.coords]=`${t.name} (${e.coords})`})};b.logs.forEach(function(t){t.origin&&e(t.origin),t.target&&e(t.target),t.village&&e(t.village)})},D=function(){var e=b.pagination.offset,t=b.pagination.limit;b.visibleLogs=b.logs.slice(e,e+t)},G=function(){b.presets=v.obj2selectOptions(R.getPresets())},P=function(){b.groups=v.obj2selectOptions(O.getGroups(),!0),b.groupsWithDisabled=angular.copy(b.groups),b.groupsWithDisabled.unshift(N())},k=function(e,t){b.running=!0,t&&v.emitNotif("success",_("i18n")("farm_started",i.loc.ale,"farm"))},U=function(e,t){b.running=!1,t&&v.emitNotif("success",_("i18n")("farm_paused",i.loc.ale,"farm"))},q=function(){b.selectedVillage=e.getSelectedVillage()},V=function(){b.lastAttack=e.getLastAttack()},B=function(e,t){b.currentStatus=t},H=function(){b.logs=angular.copy(e.getLogs()),M(),D()},j=function(){v.emitNotif("success",_("i18n")("reseted_logs",i.loc.ale,"farm"))},F=function(){e.getSettings()[o.STEP_CYCLE_NOTIFS]&&v.emitNotif("error",_("i18n")("step_cycle_end",i.loc.ale,"farm"))},Y=function(){v.emitNotif("error",_("i18n")("step_cycle_end_no_villages",i.loc.ale,"farm"))},W=function(){var t=e.getSettings();if(t[o.STEP_CYCLE_NOTIFS]){var a=E.gameTime()+60*t[o.STEP_CYCLE_INTERVAL];v.emitNotif("success",_("i18n")("step_cycle_next",i.loc.ale,"farm",v.formatDate(a)))}},z=function(e,a){var n=a[0];if(!a[1])return!1;switch(n){case t.PRESET_FIRST:v.emitNotif("error",_("i18n")("preset_first",i.loc.ale,"farm"));break;case t.NO_SELECTED_VILLAGE:v.emitNotif("error",_("i18n")("no_selected_village",i.loc.ale,"farm"))}},Q=function(){v.emitNotif("success",_("i18n")("settings_saved",i.loc.ale,"farm"))},K=function(){var t;(b=i.$new()).textObject="farm",b.textObjectCommon="common",b.SETTINGS=o,b.TAB_TYPES=S,b.LOG_TYPES=a,b.presets=[],b.groups=[],b.groupsWithDisabled=[],b.selectedTab=I,b.settings=(t={},A.forEach(function(e){t[e]="groupIgnore"===e?N():[N()]}),t),b.selectedVillage=e.getSelectedVillage(),b.lastAttack=e.getLastAttack(),b.running=e.isRunning(),b.currentStatus=e.getCurrentStatus(),b.logs=e.getLogs(),b.villagesLabel={},b.visibleLogs=[],b.pagination={count:b.logs.length,offset:0,loader:D,limit:p.getPaginationLimit()},G(),P(),q(),V(),D(),M(),b.selectTab=w,b.saveSettings=C,b.clearLogs=L,b.switchFarm=y,b.jumpToVillage=g.jumpToVillage,b.openVillageInfo=s.openVillageInfo,(h=new T("twoverflow_farm_window")).register(r.ARMY_PRESET_UPDATE,G,!0),h.register(r.ARMY_PRESET_DELETED,G,!0),h.register(r.GROUPS_UPDATED,P,!0),h.register(r.GROUPS_CREATED,P,!0),h.register(r.GROUPS_DESTROYED,P,!0),h.register(r.FARM_START,k),h.register(r.FARM_PAUSE,U),h.register(r.FARM_VILLAGES_UPDATE,q),h.register(r.FARM_NEXT_VILLAGE,q),h.register(r.FARM_SEND_COMMAND,V),h.register(r.FARM_STATUS_CHANGE,B),h.register(r.FARM_RESET_LOGS,H),h.register(r.FARM_LOGS_RESETED,j),h.register(r.FARM_LOGS_UPDATED,H),h.register(r.FARM_STEP_CYCLE_END,F),h.register(r.FARM_STEP_CYCLE_END_NO_VILLAGES,Y),h.register(r.FARM_STEP_CYCLE_NEXT,W),h.register(r.FARM_ERROR,z),h.register(r.FARM_SETTINGS_CHANGE,Q),c.getScreenWithInjectedScope("!twoverflow_farm_window",b),b.settings=x(e.getSettings())};return function(){var e=new d("Farmer",{classHover:!1,classBlur:!1,onClick:K});u.register(r.FARM_START,function(){e.$elem.classList.remove("btn-green"),e.$elem.classList.add("btn-red")}),u.register(r.FARM_PAUSE,function(){e.$elem.classList.remove("btn-red"),e.$elem.classList.add("btn-green")}),l.addTemplate("twoverflow_farm_window",'<div id="two-farmoverflow" class="win-content two-window"><header class="win-head"><h2>FarmOverflow</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-two-col"><div class="tab" ng-click="selectTab(TAB_TYPES.SETTINGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SETTINGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SETTINGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SETTINGS}">{{ TAB_TYPES.SETTINGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.LOGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.LOGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.LOGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.LOGS}">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div></div></div><div class="box-paper footer"><div class="scroll-wrap"><div class="settings" ng-show="selectedTab === TAB_TYPES.SETTINGS"><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"></colgroup><tr><th colspan="2">{{ \'groups_presets\' | i18n:loc.ale:textObject }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'presets\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="presets" selected="settings[SETTINGS.PRESETS]" drop-down="true"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'group_ignored\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groupsWithDisabled" selected="settings[SETTINGS.GROUP_IGNORE]" drop-down="true"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'group_include\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groups" selected="settings[SETTINGS.GROUP_INCLUDE]" drop-down="true"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'group_only\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groups" selected="settings[SETTINGS.GROUP_ONLY]" drop-down="true"></div></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ \'misc\' | i18n:loc.ale:textObject }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'random_base\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="30" value="settings[SETTINGS.RANDOM_BASE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.RANDOM_BASE]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'commands_per_village\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="50" value="settings[SETTINGS.COMMANDS_PER_VILLAGE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.COMMANDS_PER_VILLAGE]"></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'priority_targets\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.PRIORITY_TARGETS]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'ignore_on_loss\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="settings[SETTINGS.GROUP_IGNORE].value" border="true" value="settings[SETTINGS.IGNORE_ON_LOSS]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'ignore_full_storage\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.IGNORE_FULL_STORAGE]" vertical="false" size="\'56x28\'"></div></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ \'step_cycle_header\' | i18n:loc.ale:textObject }}</th></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'step_cycle\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.STEP_CYCLE]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'step_cycle_notifs\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="settings[SETTINGS.STEP_CYCLE]" border="true" value="settings[SETTINGS.STEP_CYCLE_NOTIFS]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'step_cycle_interval\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="120" value="settings[SETTINGS.STEP_CYCLE_INTERVAL]" enabled="settings[SETTINGS.STEP_CYCLE]"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.STEP_CYCLE_INTERVAL]" ng-disabled="!settings[SETTINGS.STEP_CYCLE]"></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ \'target_filters\' | i18n:loc.ale:textObject }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'min_distance\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="50" value="settings[SETTINGS.MIN_DISTANCE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MIN_DISTANCE]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'max_distance\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="50" value="settings[SETTINGS.MAX_DISTANCE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MAX_DISTANCE]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'min_points\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="13000" value="settings[SETTINGS.MIN_POINTS]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MIN_POINTS]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'max_points\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="13000" value="settings[SETTINGS.MAX_POINTS]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MAX_POINTS]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'max_travel_time\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="180" value="settings[SETTINGS.MAX_TRAVEL_TIME]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MAX_TRAVEL_TIME]"></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'logs_limit\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="1000" value="settings[SETTINGS.LOGS_LIMIT]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.LOGS_LIMIT]"></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_attack\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_ATTACK]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_village_change\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_VILLAGE_CHANGE]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_priority_add\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_PRIORITY_ADD]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_ignored_village\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_IGNORED_VILLAGE]" vertical="false" size="\'56x28\'"></div></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"></colgroup><tr><th colspan="2">{{ \'others\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'remote\' | i18n:loc.ale:textObject }}</span></td><td><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.REMOTE_ID]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'hotkey_switch\' | i18n:loc.ale:textObject }}</span></td><td><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.HOTKEY_SWITCH]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'hotkey_window\' | i18n:loc.ale:textObject }}</span></td><td><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.HOTKEY_WINDOW]"></td></tr></table></div><div class="logs rich-text" ng-show="selectedTab === TAB_TYPES.LOGS"><table class="status tbl-border-light"><colgroup><col width="135px"><col width="*"></colgroup><tbody><tr><td>{{ \'status\' | i18n:loc.ale:textObjectCommon }}</td><td><span>{{ currentStatus | i18n:loc.ale:textObject }}</span></td></tr><tr><td>{{ \'selected_village\' | i18n:loc.ale:textObject }}</td><td><span ng-show="selectedVillage" class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(selectedVillage.id)">{{ selectedVillage.name }} ({{ selectedVillage.x }}|{{ selectedVillage.y }})</span> <span ng-show="!selectedVillage">{{ \'none\' | i18n:loc.ale:textObjectCommon }}</span></td></tr><tr><td>{{ \'last_attack\' | i18n:loc.ale:textObject }}</td><td><span ng-show="lastAttack !== -1">{{ lastAttack | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span ng-show="lastAttack === -1">{{ \'none\' | i18n:loc.ale:textObjectCommon }}</span></td></tr></tbody></table><h5 class="twx-section">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</h5><div class="page-wrap" pagination="pagination"></div><p class="text-center" ng-show="!visibleLogs.length">{{ \'no_logs\' | i18n:loc.ale:textObject }}</p><table class="log-list tbl-border-light tbl-striped" ng-show="visibleLogs.length"><colgroup><col width="180px"><col width="30px"><col></colgroup><tr ng-repeat="log in visibleLogs"><td>{{ log.time | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</td><td><span class="icon-bg-black icon-26x26-{{ log.icon }}"></span></td><td ng-if="log.type === LOG_TYPES.ATTACK"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.origin.id)" tooltip="" tooltip-content="{{ villagesLabel[log.origin.coords] }}">{{ villagesLabel[log.origin.coords] }}</span> {{ \'attack\' | i18n:loc.ale:textObject }} <span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.target.id)" tooltip="" tooltip-content="{{ villagesLabel[log.target.coords] }}">{{ villagesLabel[log.target.coords] }}</span></td><td ng-if="log.type === LOG_TYPES.VILLAGE_SWITCH">{{ \'village_switch\' | i18n:loc.ale:textObject }} <span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.village.id)" tooltip="" tooltip-content="{{ villagesLabel[log.village.coords] }}">{{ villagesLabel[log.village.coords] }}</span></td><td ng-if="log.type === LOG_TYPES.NO_PRESET">{{ \'no_preset\' | i18n:loc.ale:textObject }}</td><td ng-if="log.type === LOG_TYPES.PRIORITY_TARGET"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.village.id)" tooltip="" tooltip-content="{{ villagesLabel[log.village.coords] }}">{{ villagesLabel[log.village.coords] }}</span> {{ \'priority_target\' | i18n:loc.ale:textObject }}</td><td ng-if="log.type === LOG_TYPES.IGNORED_VILLAGE"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.village.id)" tooltip="" tooltip-content="{{ villagesLabel[log.village.coords] }}">{{ villagesLabel[log.village.coords] }}</span> {{ \'ignored_village\' | i18n:loc.ale:textObject }}</td></tr></table><div class="page-wrap" pagination="pagination"></div></div></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li ng-show="selectedTab === TAB_TYPES.SETTINGS"><a href="#" class="btn-border btn-orange" ng-click="saveSettings()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.LOGS"><a href="#" class="btn-border btn-orange" ng-click="clearLogs()">{{ \'clear_logs\' | i18n:loc.ale:textObject }}</a></li><li><a href="#" ng-class="{false:\'btn-green\', true:\'btn-red\'}[running]" class="btn-border" ng-click="switchFarm()"><span ng-show="running">{{ \'pause\' | i18n:loc.ale:textObjectCommon }}</span> <span ng-show="!running">{{ \'start\' | i18n:loc.ale:textObjectCommon }}</span></a></li></ul></footer></div>'),l.addStyle("#two-farmoverflow .settings table{margin-bottom:15px}#two-farmoverflow .settings input.textfield-border{padding-top:6px;width:219px;height:34px}#two-farmoverflow .settings input.textfield-border.fit{width:100%}#two-farmoverflow .settings span.select-wrapper{width:219px}#two-farmoverflow .settings .range-container{width:350px}#two-farmoverflow .logs .status tr{height:25px}#two-farmoverflow .logs .status td{padding:0 6px}#two-farmoverflow .logs .log-list{margin-bottom:10px}#two-farmoverflow .logs .log-list td{text-align:center}#two-farmoverflow .logs .log-list td .village-link{max-width:200px;white-space:nowrap;text-overflow:ellipsis}")}}),define("two/minimap",["two/minimap/actionTypes","two/minimap/settings","two/minimap/settingsMap","two/utils","queues/EventQueue","two/ready","Lockr","struct/MapData","conf/conf","helper/time","helper/mapconvert","cdn","conf/colors","conf/colorGroups"],function(t,a,o,l,s,c,d,u,g,_,p,m,E,f){var v,T,h,b,A,S,I,R,O,w,L,C=!1,x={},N=5,y=1,M=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,D={village:{},character:{},tribe:{}},G={},P=null,k={},U={},q={},V="minimap_cache_villages",B="minimap_settings",H=injector.get("colorService"),j=!0,F=!1,Y={},W=function(e){var t=_e.getVillageBlock(),i=_e.getVillageAxisOffset(),a=Math.ceil(k.x+e.offsetX),n=Math.ceil(k.y+e.offsetY);return Math.floor(n/t%2)%2&&(a-=i),a-=a%t,n-=n%t,{x:Math.ceil((a-U.x/2)/t),y:Math.ceil((n-U.y/2)/t)}},z=function(e,t){return{x:e/g.TILESIZE.x,y:t/g.TILESIZE.y/g.TILESIZE.off}},Q=function(e,t){var i,n,o,l,r,s=R.getId(),c=R.getTribeId(),d=_e.getVillageBlock(),u=_e.getVillageSize(),g=_e.getVillageAxisOffset(),_=R.getVillagesColors();for(r=0;r<e.length;r++)if(!((i=e[r]).id<0)){if(t)l=t,n=i[0]*d,o=i[1]*d,i[1]%2&&(n+=g);else if(n=i.x*d,o=i.y*d,i.y%2&&(n+=g),q[a.SHOW_ONLY_CUSTOM_HIGHLIGHTS])if(i.character_id in x.character)l=x.character[i.character_id];else{if(!(i.tribe_id in x.tribe))continue;l=x.tribe[i.tribe_id]}else if(null===i.character_id){if(!q[a.SHOW_BARBARIANS])continue;l=_.barbarian}else l=i.character_id===s?i.id===w.getId()&&q[a.HIGHLIGHT_SELECTED]?_.selected:i.character_id in x.character?x.character[i.character_id]:q[a.HIGHLIGHT_OWN]?_.player:_.ugly:i.character_id in x.character?x.character[i.character_id]:i.tribe_id in x.tribe?x.tribe[i.tribe_id]:c&&c===i.tribe_id&&q[a.HIGHLIGHT_DIPLOMACY]?_.tribe:O&&q[a.HIGHLIGHT_DIPLOMACY]?O.isAlly(i.tribe_id)?_.ally:O.isEnemy(i.tribe_id)?_.enemy:O.isNAP(i.tribe_id)?_.friendly:_.ugly:_.ugly;b.fillStyle=l,b.fillRect(n,o,u,u)}},K=function(){var e,t,i,n=m.getPath(g.getMapPath()),o=_e.getVillageBlock(),r=Math.round(o/2);l.xhrGet(n,function(n){for(L=new DataView(n),t=1;t<999;t++)for(i=1;i<999;i++)(e=p.toTile(L,t,i)).key.b&&(e.key.c?(b.fillStyle=q[a.COLOR_CONTINENT],b.fillRect(t*o+r-1,i*o+r-1,3,1),b.fillRect(t*o+r,i*o+r-2,1,3)):(b.fillStyle=q[a.COLOR_PROVINCE],b.fillRect(t*o+r,i*o+r-1,1,1)))},"arraybuffer")},$=function(){Q(u.getTowns())},X=function(){var e,t,i,n,o,l=_e.getVillageBlock(),r=_e.getVillageSize(),s=_e.getVillageAxisOffset();for(e in G)for(i=0;i<G[e].length;i++)n=e*l,o=(t=G[e][i])*l,t%2&&(n+=s),b.fillStyle=q[a.COLOR_GHOST],b.fillRect(n,o,r,r)},Z=function(){if(C){var t={x:k.x-U.x/2,y:k.y-U.y/2};T.clearRect(0,0,v.width,v.height),S.clearRect(0,0,A.width,A.height),function(e){T.drawImage(h,-e.x,-e.y)}(t),q[a.SHOW_CROSS]&&function(e){var t=_e.getVillageBlock(),i=_e.getLineSize(),n=_e.getMapPosition(),o=(n[0]+n[2]-2)*t-e.x,l=(n[1]+n[3]-2)*t-e.y;S.fillStyle=q[a.COLOR_CROSS],S.fillRect(0|o,0,1,i),S.fillRect(0,0|l,i,1)}(t)}e.requestAnimationFrame(Z)},J=function(e,t,i){var a=25*e,n=(t||w.getX())-a/2,o=(i||w.getY())-a/2;u.loadTownDataAsync(n,o,a,a,function(){})},ee=function(e){var t,i;for(t=0;t<e.length;t++)(i=e[t]).id<0||(i.x in D.village||(D.village[i.x]={}),i.x in G||(G[i.x]=[]),D.village[i.x][i.y]=i.character_id||0,G[i.x].push(i.y),i.character_id&&(i.character_id in D.character?D.character[i.character_id].push([i.x,i.y]):D.character[i.character_id]=[[i.x,i.y]],i.tribe_id&&(i.tribe_id in D.tribe?D.tribe[i.tribe_id].push(i.character_id):D.tribe[i.tribe_id]=[i.character_id])));d.set(V,G)},te=function(){var e;if(!P)return!1;e=D.village[P.x][P.y],ae(e?D.character[e]:[[P.x,P.y]]),P=!1,s.trigger(r.MINIMAP_VILLAGE_BLUR)},ie=function(e){Q(e,q[a.COLOR_QUICK_HIGHLIGHT])},ae=function(e){var t,i=[];for(t=0;t<e.length;t++)i.push(u.getTownAt(e[t][0],e[t][1]));Q(i)},ne=function(e){e.preventDefault(),j=!0,F=!0,Y={x:k.x+e.pageX,y:k.y+e.pageY},P&&(s.trigger(r.MINIMAP_VILLAGE_CLICK,[P,e]),3===e.which&&function(e){var i=u.getTownAt(e.x,e.y),n=(q[a.RIGHT_CLICK_ACTION],{});if(!i)return!1;switch(q[a.RIGHT_CLICK_ACTION]){case t.HIGHLIGHT_PLAYER:if(!i.character_id)return!1;n.type="character",n.id=i.character_id;break;case t.HIGHLIGHT_TRIBE:if(!i.tribe_id)return!1;n.type="tribe",n.id=i.tribe_id}_e.addHighlight(n,"#"+E.palette.random().random())}(P))},oe=function(){F=!1,Y={},j||s.trigger(r.MINIMAP_STOP_MOVE)},le=function(e){var t,i,n;if(j=!1,F&&(k.x=Y.x-e.pageX,k.y=Y.y-e.pageY,s.trigger(r.MINIMAP_START_MOVE)),(t=W(e)).x in D.village&&t.y in D.village[t.x])return i=u.getTownAt(t.x,t.y),!(!q[a.SHOW_BARBARIANS]&&!i.character_id)&&(!(q[a.SHOW_ONLY_CUSTOM_HIGHLIGHTS]&&(n=!1,i.character_id in x.character?n=!0:i.tribe_id in x.tribe&&(n=!0),!n))&&function(e,t){var i;if(P){if(P.x===e.x&&P.y===e.y)return!1;te()}s.trigger(r.MINIMAP_VILLAGE_HOVER,{village:u.getTownAt(e.x,e.y),event:t}),P={x:e.x,y:e.y},i=D.village[e.x][e.y],ie(i?D.character[i]:[[e.x,e.y]])}(t,e));te()},re=function(){P&&te(),s.trigger(r.MINIMAP_MOUSE_LEAVE)},se=function(e){if(!j)return!1;var t=W(e);i.$broadcast(r.MAP_CENTER_ON_POSITION,t.x,t.y,!0),J(2,t.x,t.y)},ce=function(e){return e.preventDefault(),!1},de=function(e,t){Q(t.villages),ee(t.villages)},ue=function(){x.tribe=H.getCustomColorsByGroup(f.TRIBE_COLORS)||{},x.character=H.getCustomColorsByGroup(f.PLAYER_COLORS)||{},$()},ge=function(){var e={id:w.getId(),x:w.getX(),y:w.getY()};w=R.getSelectedVillage(),Q([{character_id:R.getId(),id:e.id,x:e.x,y:e.y},{character_id:R.getId(),id:w.getId(),x:w.getX(),y:w.getY()}])},_e={SETTINGS_MAP:o,ACTION_TYPES:t,setVillageSize:function(e){N=e},getVillageSize:function(){return N},setVillageMargin:function(e){y=e},getVillageMargin:function(){return y},getVillageBlock:function(){return N+y},getLineSize:function(){return 1e3*(N+y)},getVillageAxisOffset:function(){return Math.round(N/2)},addHighlight:function(e,t){var a;return e&&e.type&&e.id?M.test(t)?(x[e.type][e.id]=t,a="character"===e.type?f.PLAYER_COLORS:f.TRIBE_COLORS,H.setCustomColorsByGroup(a,x[e.type]),i.$broadcast(r.GROUPS_VILLAGES_CHANGED),$(),!0):(s.trigger(r.MINIMAP_HIGHLIGHT_ADD_ERROR_INVALID_COLOR),!1):(s.trigger(r.MINIMAP_HIGHLIGHT_ADD_ERROR_NO_ENTRY),!1)},removeHighlight:function(e,t){var a="character"===e?f.PLAYER_COLORS:f.TRIBE_COLORS;return!!x[e][t]&&(delete x[e][t],H.setCustomColorsByGroup(a,x[e]),i.$broadcast(r.GROUPS_VILLAGES_CHANGED),$(),!0)},getHighlight:function(e,t){return!!x[e].hasOwnProperty(t)&&x[e][t]},getHighlights:function(){return x},eachHighlight:function(e){for(var t in x)for(var i in x[t])e(t,i,x[t][i])},setViewport:function(e){(v=e).style.background=q[a.COLOR_BACKGROUND],T=v.getContext("2d")},setCross:function(e){S=(A=e).getContext("2d")},setCurrentPosition:function(e,t){var i=_e.getVillageBlock();k.x=e*i+50,k.y=t*i+(1e3-(document.body.clientHeight-238)/2)+50}};return _e.getMapPosition=function(){var t;return!(!I.width||!I.height)&&function(e,t){t=1/(t||1);var i=z(e[0]*t,e[1]*t),a=z(e[2]*t,e[3]*t);return[i.x-1,i.y-1,a.x+3||1,a.y+3||1]}([-(t=e.twx.game.map.engine.getView()).x,-t.y,I.width/2,I.height/2],t.z)},_e.updateSettings=function(e){var t,i,a,n=!1;for(i in e)a=o[i],t=e[i],a&&!angular.equals(q[i],t)&&(a.update&&(n=!0),q[i]=t);return d.set(B,q),n&&_e.update(),s.trigger(r.MINIMAP_SETTINGS_SAVE),!0},_e.resetSettings=function(){for(var e in o)q[e]=o[e].default;d.set(B,q),_e.update(),s.trigger(r.MINIMAP_SETTINGS_RESET)},_e.getSettings=function(){return q},_e.update=function(){_e.getVillageBlock();v.style.background=q[a.COLOR_BACKGROUND],b.clearRect(0,0,h.width,h.height),q[a.SHOW_DEMARCATIONS]&&K(),q[a.SHOW_GHOST_VILLAGES]&&X(),$()},_e.enableRendering=function(){C=!0},_e.disableRendering=function(){C=!1},_e.init=function(){var e,t,i;for(t in _e.initialized=!0,h=document.createElement("canvas"),b=h.getContext("2d"),e=d.get(B,{},!0),o)i=o[t].default,q[t]=e.hasOwnProperty(t)?e[t]:i;x.tribe=H.getCustomColorsByGroup(f.TRIBE_COLORS)||{},x.character=H.getCustomColorsByGroup(f.PLAYER_COLORS)||{}},_e.run=function(){var e;c(function(){I=document.getElementById("main-canvas"),R=n.getSelectedCharacter(),O=R.getTribeRelations(),G=d.get(V,{},!0),e=_e.getVillageBlock(),k.x=500*e,k.y=500*e,U.x=701,U.y=2e3,v.setAttribute("width",U.x),v.setAttribute("height",U.y),T.imageSmoothingEnabled=!1,h.setAttribute("width",1e3*e),h.setAttribute("height",1e3*e),h.imageSmoothingEnabled=!1,A.setAttribute("width",U.x),A.setAttribute("height",U.y),S.imageSmoothingEnabled=!1,w=R.getSelectedVillage(),k.x=w.getX()*e,k.y=w.getY()*e,q[a.SHOW_DEMARCATIONS]&&K(),q[a.SHOW_GHOST_VILLAGES]&&X(),$(),ee(u.getTowns()),J(2),Z(),A.addEventListener("mousedown",ne),A.addEventListener("mouseup",oe),A.addEventListener("mousemove",le),A.addEventListener("mouseleave",re),A.addEventListener("click",se),A.addEventListener("contextmenu",ce),i.$on(r.MAP_VILLAGE_DATA,de),i.$on(r.VILLAGE_SELECTED_CHANGED,ge),i.$on(r.TRIBE_RELATION_CHANGED,$),i.$on(r.GROUPS_VILLAGES_CHANGED,ue)},["initial_village","tribe_relations"])},_e}),define("two/minimap/actionTypes",[],function(){return{HIGHLIGHT_PLAYER:"highlight_player",HIGHLIGHT_TRIBE:"highlight_tribe"}}),define("two/minimap/Events",[],function(){angular.extend(r,{MINIMAP_SETTINGS_RESET:"minimap_settings_reset",MINIMAP_SETTINGS_SAVE:"minimap_settings_save",MINIMAP_HIGHLIGHT_ADD_ERROR_EXISTS:"minimap_highlight_add_error_exists",MINIMAP_HIGHLIGHT_ADD_ERROR_NO_ENTRY:"minimap_highlight_add_error_no_entry",MINIMAP_HIGHLIGHT_ADD_ERROR_INVALID_COLOR:"minimap_highlight_add_error_invalid_color",MINIMAP_VILLAGE_CLICK:"minimap_village_click",MINIMAP_VILLAGE_HOVER:"minimap_village_hover",MINIMAP_VILLAGE_BLUR:"minimap_village_blur",MINIMAP_MOUSE_LEAVE:"minimap_mouse_leave",MINIMAP_START_MOVE:"minimap_start_move",MINIMAP_STOP_MOVE:"minimap_stop_move"})}),define("two/minimap/settingsMap",["two/minimap/settings","two/minimap/actionTypes"],function(e,t){return{[e.RIGHT_CLICK_ACTION]:{default:t.HIGHLIGHT_PLAYER,inputType:"select",update:!1},[e.SHOW_CROSS]:{default:!0,inputType:"checkbox",update:!0},[e.SHOW_DEMARCATIONS]:{default:!0,inputType:"checkbox",update:!0},[e.SHOW_BARBARIANS]:{default:!1,inputType:"checkbox",update:!0},[e.SHOW_GHOST_VILLAGES]:{default:!1,inputType:"checkbox",update:!0},[e.SHOW_ONLY_CUSTOM_HIGHLIGHTS]:{default:!1,inputType:"checkbox",update:!0},[e.HIGHLIGHT_OWN]:{default:!0,inputType:"checkbox",update:!0},[e.HIGHLIGHT_SELECTED]:{default:!0,inputType:"checkbox",update:!0},[e.HIGHLIGHT_DIPLOMACY]:{default:!0,inputType:"checkbox",update:!0},[e.COLOR_SELECTED]:{default:"#ffffff",inputType:"color",update:!0},[e.COLOR_BARBARIAN]:{default:"#969696",inputType:"color",update:!0},[e.COLOR_PLAYER]:{default:"#f0c800",inputType:"color",update:!0},[e.COLOR_QUICK_HIGHLIGHT]:{default:"#ffffff",inputType:"color",update:!0},[e.COLOR_BACKGROUND]:{default:"#436213",inputType:"color",update:!0},[e.COLOR_PROVINCE]:{default:"#ffffff",inputType:"color",update:!0},[e.COLOR_CONTINENT]:{default:"#cccccc",inputType:"color",update:!0},[e.COLOR_CROSS]:{default:"#999999",inputType:"color",update:!0},[e.COLOR_TRIBE]:{default:"#0000DB",inputType:"color",update:!0},[e.COLOR_ALLY]:{default:"#00a0f4",inputType:"color",update:!0},[e.COLOR_ENEMY]:{default:"#ED1212",inputType:"color",update:!0},[e.COLOR_FRIENDLY]:{default:"#BF4DA4",inputType:"color",update:!0},[e.COLOR_UGLY]:{default:"#A96534",inputType:"color",update:!0},[e.COLOR_GHOST]:{default:"#3E551C",inputType:"color",update:!0}}}),define("two/minimap/settings",[],function(){return{RIGHT_CLICK_ACTION:"right_click_action",FLOATING_MINIMAP:"floating_minimap",SHOW_CROSS:"show_cross",SHOW_DEMARCATIONS:"show_demarcations",SHOW_BARBARIANS:"show_barbarians",SHOW_GHOST_VILLAGES:"show_ghost_villages",SHOW_ONLY_CUSTOM_HIGHLIGHTS:"show_only_custom_highlights",HIGHLIGHT_OWN:"highlight_own",HIGHLIGHT_SELECTED:"highlight_selected",HIGHLIGHT_DIPLOMACY:"highlight_diplomacy",COLOR_GHOST:"color_ghost",COLOR_QUICK_HIGHLIGHT:"color_quick_highlight",COLOR_BACKGROUND:"color_background",COLOR_PROVINCE:"color_province",COLOR_CONTINENT:"color_continent",COLOR_CROSS:"color_cross"}}),require(["helper/i18n","two/ready","two/minimap","two/minimap/ui","two/minimap/Events","two/minimap/actionTypes","two/minimap/settings","two/minimap/settingsMap"],function(e,t,a,n){if(a.initialized)return!1;t(function(){var t,o,l;t={en_us:{minimap:{minimap:"Minimap",highlights:"Highlights",add:"Add highlight",remove:"Remove highlight",placeholder_search:"Search player/tribe",highlight_add_success:"Highlight added",highlight_add_error:"Specify a highlight first",highlight_update_success:"Highlight updated",highlight_remove_success:"Highlight removed",highlight_villages:"Villages",highlight_players:"Players",highlight_tribes:"Tribes",highlight_add_error_exists:"Highlight already exists!",highlight_add_error_no_entry:"Select a player/tribe first!",highlight_add_error_invalid_color:"Invalid color!",village:"Village",player:"Player",tribe:"Tribe",color:"Color (Hex)",tooltip_pick_color:"Select a color",misc:"Miscellaneous settings",colors_misc:"Miscellaneous colors",colors_diplomacy:"Diplomacy colors",settings_saved:"Settings saved!",settings_right_click_action:"Village's right click action",highlight_village:"Highlight village",highlight_player:"Highlight player",highlight_tribe:"Highlight tribe",settings_show_floating_minimap:"Show floating minimap",settings_show_cross:"Show position cross",settings_show_demarcations:"Show province/continent demarcations",settings_show_barbarians:"Show barbarian villages",settings_show_ghost_villages:"Show non-loaded villages",settings_show_only_custom_highlights:"Show only custom highlights",settings_highlight_own:"Highlight own villages",settings_highlight_selected:"highlight selected village",settings_highlight_diplomacy:"Auto highlight tribe diplomacies",settings_colors_background:"Minimap background",settings_colors_province:"Province demarcation",settings_colors_continent:"Continent demarcation",settings_colors_quick_highlight:"Quick highlight",settings_colors_tribe:"Own tribe",settings_colors_player:"Own villages",settings_colors_selected:"Selected village",settings_colors_ghost:"Non-loaded villages",settings_colors_ally:"Ally",settings_colors_pna:"PNA",settings_colors_enemy:"Enemy",settings_colors_other:"Other",settings_colors_barbarian:"Barbarian",settings_colors_cross:"Position cross",settings_reset:"Settings reseted",tooltip_village:"Village",tooltip_village_points:"Village points",tooltip_player:"Player name",tooltip_player_points:"Player points",tooltip_tribe:"Tribe",tooltip_tribe_points:"Tribe points",tooltip_province:"Province name",no_highlights:"No highlights created",reset_confirm_title:"Reset settings",reset_confirm_text:"All settings gonna be reseted to the default settings.",reset_confirm_highlights_text:"Also, all highlights are going to be deleted."}},pl_pl:{minimap:{minimap:"Kartograf",highlights:"Podświetlenie",add:"Dodaj podświetlenie",remove:"Usuń podświetlenie",placeholder_search:"gracz/plemie",highlight_add_success:"Podświetlenie dodane",highlight_add_error:"Najpierw sprecyzuj podświetlenie",highlight_update_success:"Podświetlenie zaktualizowane",highlight_remove_success:"Podświetlenie usunięte",highlight_villages:"Wioski",highlight_players:"Gracze",highlight_tribes:"Plemiona",highlight_add_error_exists:"Podświetlenie już istnieje!",highlight_add_error_no_entry:"Najpierw wybierz gracza/plemię!",highlight_add_error_invalid_color:"Nieprawidłowy kolor!",village:"Wioska",player:"Gracz",tribe:"Plemię",color:"Kolor (Hex)",tooltip_pick_color:"Select a color",misc:"Miscellaneous settings",colors_misc:"Miscellaneous colors",colors_diplomacy:"Diplomacy colors",settings_saved:"Settings saved!",settings_right_click_action:"Village's right click action",highlight_village:"Highlight village",highlight_player:"Highlight player",highlight_tribe:"Highlight tribe",settings_show_floating_minimap:"Show floating minimap",settings_show_cross:"Show position cross",settings_show_demarcations:"Show province/continent demarcations",settings_show_barbarians:"Show barbarian villages",settings_show_ghost_villages:"Show non-loaded villages",settings_show_only_custom_highlights:"Show only custom highlights",settings_highlight_own:"Highlight own villages",settings_highlight_selected:"highlight selected village",settings_highlight_diplomacy:"Auto highlight tribe diplomacies",settings_colors_background:"Minimap background",settings_colors_province:"Province demarcation",settings_colors_continent:"Continent demarcation",settings_colors_quick_highlight:"Quick highlight",settings_colors_tribe:"Own tribe",settings_colors_player:"Own villages",settings_colors_selected:"Selected village",settings_colors_ghost:"Non-loaded villages",settings_colors_ally:"Ally",settings_colors_pna:"PNA",settings_colors_enemy:"Enemy",settings_colors_other:"Other",settings_colors_barbarian:"Barbarian",settings_colors_cross:"Position cross",settings_reset:"Settings reseted",tooltip_village:"Village",tooltip_village_points:"Village points",tooltip_player:"Player name",tooltip_player_points:"Player points",tooltip_tribe:"Tribe",tooltip_tribe_points:"Tribe points",tooltip_province:"Province name",no_highlights:"No highlights created",reset_confirm_title:"Reset settings",reset_confirm_text:"All settings gonna be reseted to the default settings.",reset_confirm_highlights_text:"Also, all highlights are going to be deleted."}},pt_br:{minimap:{minimap:"Minimapa",highlights:"Marcações",add:"Adicionar marcação",remove:"Remover marcação",placeholder_search:"Procurar jogador/tribo",highlight_add_success:"Marcação adicionada",highlight_add_error:"Especifique uma marcação primeiro",highlight_update_success:"Marcação atualizada",highlight_remove_success:"Marcação removida",highlight_villages:"Aldeias",highlight_players:"Jogadores",highlight_tribes:"Tribos",highlight_add_error_exists:"Marcação já existe!",highlight_add_error_no_entry:"Selecione uma jogador/tribo primeiro!",highlight_add_error_invalid_color:"Cor inválida!",village:"Aldeia",player:"Jogador",tribe:"Tribo",color:"Cor (Hex)",tooltip_pick_color:"Selecione uma cor",misc:"Configurações diversas",colors_misc:"Cores diversas",colors_diplomacy:"Cores da diplomacia",settings_saved:"Configurações salvas!",settings_right_click_action:"Ação de clique direito na aldeia",highlight_village:"Marcar aldeia",highlight_player:"Marcar jogador",highlight_tribe:"Marcar tribo",settings_show_floating_minimap:"Mostrar minimapa flutuante",settings_show_cross:"Mostrar marcação da posição atual",settings_show_demarcations:"Mostrar demarcações das provincias/continentes",settings_show_barbarians:"Mostrar aldeias bárbaras",settings_show_ghost_villages:"Mostrar aldeias não carregadas",settings_show_only_custom_highlights:"Mostrar apenas marcações manuais",settings_highlight_own:"Marcar próprias aldeias",settings_highlight_selected:"Marcar aldeia selecionada",settings_highlight_diplomacy:"Marcação automática baseado na diplomacia",settings_colors_background:"Fundo do minimapa",settings_colors_province:"Demarcação da provincia",settings_colors_continent:"Demarcação do continente",settings_colors_quick_highlight:"Marcação rápida",settings_colors_tribe:"Própria tribo",settings_colors_player:"Aldeias próprias",settings_colors_selected:"Aldeia selecionada",settings_colors_ghost:"Aldeias não carregadas",settings_colors_ally:"Aliados",settings_colors_pna:"PNA",settings_colors_enemy:"Inimigos",settings_colors_other:"Outros",settings_colors_barbarian:"Aldeias Bárbaras",settings_colors_cross:"Cruz da posição",settings_reset:"Configurações resetadas",tooltip_village:"Aldeia",tooltip_village_points:"Pontos da aldeia",tooltip_player:"Nome do jogador",tooltip_player_points:"Pontos do jogador",tooltip_tribe:"Nome da Tribo",tooltip_tribe_points:"Pontos da tribo",tooltip_province:"Nome da província",no_highlights:"Nenhuma marcação criada",reset_confirm_title:"Resetar configurações",reset_confirm_text:"Todas as configurações serão resetas para as configurações padrões.",reset_confirm_highlights_text:"Todas marcações também serão deletadas"}}},o=i.loc.ale,l=o in t?t[o]:t.en_us,e.setJSON(l),a.init(),n(),a.run()})}),define("two/minimap/ui",["two/minimap","two/minimap/actionTypes","two/minimap/settingsMap","two/minimap/settings","two/ui2","two/ui/autoComplete","two/FrontButton","two/utils","helper/util","queues/EventQueue","struct/MapData","cdn","two/EventScope","conf/colors"],function(t,n,d,u,g,p,m,E,f,v,T,h,b,A){var S,I,R,O,w,L,C,x,N,y={MINIMAP:"minimap",HIGHLIGHTS:"highlights",SETTINGS:"settings"},M=y.MINIMAP,D=[],G={},P={character:{},tribe:{}},k=function(e){S.selectedTab=e,e===y.MINIMAP?t.enableRendering():t.disableRendering()},U=function(){Object.keys(S.highlights.character).forEach(function(e){var t,i;e in P.character||(t={id:e},i=function(t){P.character[e]=t.character_name},o.emit(l.CHAR_GET_PROFILE,{character_id:t.id},i))}),Object.keys(S.highlights.tribe).forEach(function(e){var t,i;e in P.tribe||(t={id:e},i=function(t){P.tribe[e]=t.name},o.emit(l.TRIBE_GET_PROFILE,{tribe_id:t.id},i))})},q=function(e,t){N=setTimeout(function(){var e,i,a,n;C.appendChild(L),L.classList.remove("ng-hide"),w.tt.name=t.village.name,w.tt.x=t.village.x,w.tt.y=t.village.y,w.tt.province_name=t.village.province_name,w.tt.points=t.village.points,w.tt.character_name=t.village.character_name||"-",w.tt.character_points=t.village.character_points||0,w.tt.tribe_name=t.village.tribe_name||"-",w.tt.tribe_tag=t.village.tribe_tag||"-",w.tt.tribe_points=t.village.tribe_points||0,w.tt.morale=t.village.morale||0,w.tt.position={},w.tt.position.x=t.event.pageX+50,w.tt.position.y=t.event.pageY+50,w.tt.visible=!0,i=L.getBoundingClientRect(),e=C.getBoundingClientRect(),G.x=i.width+50,G.y=i.height+50,a=w.tt.position.y+G.y>e.top+e.height,n=w.tt.position.x+G.x>e.width,a&&(w.tt.position.y-=50),L.classList.toggle("left",n),L.classList.toggle("top",a)},50)},V=function(){clearTimeout(N),w.tt.visible=!1,L.classList.add("ng-hide"),x.appendChild(L)},B=function(e,a,n,o){var l,r,s=i.$new(),u=!0;s.colorPalettes=A.palette,"setting"===e?(r=a,l=S.settings[r],u=!1,s.submit=function(){S.settings[r]="#"+s.selectedColor,s.closeWindow()},s.reset=function(){S.settings[r]=d[r].default,s.closeWindow()}):"add_custom_highlight"===e?(l=S.addHighlightColor,s.submit=function(){S.addHighlightColor="#"+s.selectedColor,s.closeWindow()}):"edit_custom_highlight"===e&&(l=S.highlights[a][n],s.submit=function(){t.addHighlight({id:n,type:a},"#"+s.selectedColor),s.closeWindow()}),s.selectedColor=l.replace("#",""),s.hasCustomColors=!0,s.hideReset=u,s.finishAction=function(e,t){s.selectedColor=t},c.getModal("modal_color_palette",s)},H=function(){t.addHighlight(S.selectedHighlight,S.addHighlightColor)},j=function(){var e=angular.copy(S.settings);e[u.RIGHT_CLICK_ACTION]=e[u.RIGHT_CLICK_ACTION].value,t.updateSettings(e)},F=function(e){var t=angular.copy(e);return t[u.RIGHT_CLICK_ACTION]={value:t[u.RIGHT_CLICK_ACTION],name:_("i18n")(t[u.RIGHT_CLICK_ACTION],i.loc.ale,"minimap")},t},Y=function(){var e=i.$new();e.title=_("i18n")("reset_confirm_title",i.loc.ale,"minimap"),e.text=_("i18n")("reset_confirm_text",i.loc.ale,"minimap"),e.submitText=_("i18n")("reset",i.loc.ale,"common"),e.cancelText=_("i18n")("cancel",i.loc.ale,"common"),e.showQuestionMarkIcon=!0,e.switchColors=!0,e.submit=function(){t.resetSettings(),e.closeWindow()},e.cancel=function(){e.closeWindow()},c.getModal("modal_attention",e)},W=function(){return Object.keys(S.highlights.character).length+Object.keys(S.highlights.tribe).length},z=function(e,t){("character"===e?s.openCharacterProfile:s.openTribeProfile)(t)},Q={addHighlightAutoCompleteSelect:function(e){S.selectedHighlight={id:e.id,type:e.type,name:e.name}},settingsReset:function(){S.settings=F(t.getSettings()),E.emitNotif("success",_("i18n")("settings_reset",i.loc.ale,"minimap"))},settingsSave:function(){E.emitNotif("success",_("i18n")("settings_saved",i.loc.ale,"minimap"))},highlightUpdate:function(e){U()},highlightAddErrorExists:function(e){E.emitNotif("error",_("i18n")("highlight_add_error_exists",i.loc.ale,"minimap"))},highlightAddErrorNoEntry:function(e){E.emitNotif("error",_("i18n")("highlight_add_error_no_entry",i.loc.ale,"minimap"))},highlightAddErrorInvalidColor:function(e){E.emitNotif("error",_("i18n")("highlight_add_error_invalid_color",i.loc.ale,"minimap"))},onMouseLeaveMinimap:function(t){t=new MouseEvent("mouseup",{view:e,bubbles:!0,cancelable:!0});V(),R.dispatchEvent(t)},onMouseMoveMinimap:function(e){V(),R.style.cursor="url("+h.getPath("/img/cursor/grab_pushed.png")+"), move"},onMouseStopMoveMinimap:function(e){R.style.cursor=""}},K=function(){(S=i.$new()).textObject="minimap",S.textObjectCommon="common",S.SETTINGS=u,S.TAB_TYPES=y,S.selectedTab=M,S.selectedHighlight=!1,S.addHighlightColor="#000000",S.highlights=t.getHighlights(),S.highlightNames=P,S.settings=F(t.getSettings()),S.actionTypes=D,S.autoComplete={type:["character","tribe","village"],placeholder:_("i18n")("placeholder_search",i.loc.ale,"minimap"),onEnter:Q.addHighlightAutoCompleteSelect},S.selectTab=k,S.openColorPalette=B,S.addCustomHighlight=H,S.removeHighlight=t.removeHighlight,S.saveSettings=j,S.resetSettings=Y,S.highlightsCount=W,S.openProfile=z,eventScope=new b("twoverflow_minimap_window"),eventScope.register(r.MINIMAP_SETTINGS_RESET,Q.settingsReset),eventScope.register(r.MINIMAP_SETTINGS_SAVE,Q.settingsSave),eventScope.register(r.GROUPS_VILLAGES_CHANGED,Q.highlightUpdate,!0),eventScope.register(r.MINIMAP_HIGHLIGHT_ADD_ERROR_EXISTS,Q.highlightAddErrorExists),eventScope.register(r.MINIMAP_HIGHLIGHT_ADD_ERROR_NO_ENTRY,Q.highlightAddErrorNoEntry),eventScope.register(r.MINIMAP_HIGHLIGHT_ADD_ERROR_INVALID_COLOR,Q.highlightAddErrorInvalidColor),eventScope.register(r.MINIMAP_VILLAGE_HOVER,q),eventScope.register(r.MINIMAP_VILLAGE_BLUR,V),eventScope.register(r.MINIMAP_MOUSE_LEAVE,Q.onMouseLeaveMinimap),eventScope.register(r.MINIMAP_START_MOVE,Q.onMouseMoveMinimap),eventScope.register(r.MINIMAP_STOP_MOVE,Q.onMouseStopMoveMinimap),c.getScreenWithInjectedScope("!twoverflow_minimap_window",S),U(),(O=document.querySelector("#two-minimap .minimap-container")).appendChild(I),O.appendChild(R),t.enableRendering()};return function(){var e;for(e in w=a.getSharedData("MapController"),(I=document.createElement("canvas")).className="minimap",(R=document.createElement("canvas")).className="cross",t.setViewport(I),t.setCross(R),L=document.querySelector("#map-tooltip"),C=document.querySelector("#wrapper"),x=document.querySelector("#map"),n)D.push({value:n[e],name:_("i18n")(n[e],i.loc.ale,"minimap")});new m("Minimap",{classHover:!1,classBlur:!1,onClick:function(){var e=t.getMapPosition();if(!e)return!1;t.setCurrentPosition(e[0],e[1]),K()}}),g.addTemplate("twoverflow_minimap_window",'<div id="two-minimap" class="win-content two-window"><header class="win-head"><h2>Minimap</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main small-select" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" ng-click="selectTab(TAB_TYPES.MINIMAP)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.MINIMAP}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.MINIMAP}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.MINIMAP}">{{ \'minimap\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.HIGHLIGHTS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.HIGHLIGHTS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.HIGHLIGHTS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.HIGHLIGHTS}">{{ \'highlights\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.SETTINGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SETTINGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SETTINGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SETTINGS}">{{ \'settings\' | i18n:loc.ale:textObjectCommon }}</a></div></div></div></div></div><div ng-show="selectedTab === TAB_TYPES.MINIMAP" class="minimap-container"></div><div class="box-paper" ng-class="{\'footer\': selectedTab == TAB_TYPES.SETTINGS}"><div class="scroll-wrap"><div ng-show="selectedTab == TAB_TYPES.HIGHLIGHTS"><h5 class="twx-section">{{ \'add\' | i18n:loc.ale:textObject }}</h5><table class="tbl-border-light tbl-striped add-highlight"><colgroup><col width="40%"><col><col width="4%"><col width="4%"></colgroup><tbody><tr><td><div auto-complete="autoComplete"></div></td><td class="text-center"><span ng-show="selectedHighlight" class="icon-26x26-rte-{{ selectedHighlight.type }}"></span> {{ selectedHighlight.name }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'add_custom_highlight\')" ng-style="{\'background-color\': addHighlightColor }" tooltip="" tooltip-content="{{ \'tooltip_pick_color\' | i18n:loc.ale:textObject }}"></div></td><td><span class="btn-orange icon-26x26-plus" ng-click="addCustomHighlight()" tooltip="" tooltip-content="{{ \'add\' | i18n:loc.ale:textObject }}"></span></td></tr></tbody></table><h5 class="twx-section">{{ TAB_TYPES.HIGHLIGHTS | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!highlightsCount()">{{ \'no_highlights\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light tbl-striped" ng-show="highlightsCount()"><colgroup><col width="4%"><col><col width="4%"><col width="4%"></colgroup><tbody><tr ng-repeat="(id, color) in highlights.character"><td><span class="icon-26x26-rte-character"></span></td><td><span class="open-profile" ng-click="openProfile(\'character\', id)">{{ highlightNames.character[id] }}</span></td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'edit_custom_highlight\', \'character\', id)" ng-style="{\'background-color\': color }"></div></td><td><a class="size-26x26 btn-red icon-20x20-close" ng-click="removeHighlight(\'character\', id)" tooltip="" tooltip-content="{{ \'remove\' | i18n:loc.ale:textObject }}"></a></td></tr><tr ng-repeat="(id, color) in highlights.tribe"><td><span class="icon-26x26-rte-tribe"></span></td><td><span class="open-profile" ng-click="openProfile(\'tribe\', id)">{{ highlightNames.tribe[id] }}</span></td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'edit_custom_highlight\', \'tribe\', id)" ng-style="{\'background-color\': color }"></div></td><td><a class="size-26x26 btn-red icon-20x20-close" ng-click="removeHighlight(\'tribe\', id)" tooltip="" tooltip-content="{{ \'remove\' | i18n:loc.ale:textObject }}"></a></td></tr></tbody></table></div><div ng-show="selectedTab == TAB_TYPES.SETTINGS"><table class="tbl-border-light tbl-striped"><colgroup><col width="60%"><col><col width="56px"></colgroup><tbody><tr><th colspan="3">{{ \'misc\' | i18n:loc.ale:textObject }}</th></tr><tr><td>{{ \'settings_right_click_action\' | i18n:loc.ale:textObject }}</td><td colspan="3"><div select="" list="actionTypes" selected="settings[SETTINGS.RIGHT_CLICK_ACTION]" drop-down="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_cross\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_CROSS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_demarcations\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_DEMARCATIONS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_barbarians\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_BARBARIANS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_ghost_villages\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_GHOST_VILLAGES]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_only_custom_highlights\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_ONLY_CUSTOM_HIGHLIGHTS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_highlight_own\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.HIGHLIGHT_OWN]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_highlight_selected\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.HIGHLIGHT_SELECTED]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_highlight_diplomacy\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.HIGHLIGHT_DIPLOMACY]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr></tbody></table><table class="tbl-border-light tbl-striped"><colgroup><col><col width="29px"></colgroup><tbody><tr><th colspan="2">{{ \'colors_misc\' | i18n:loc.ale:textObject }}</th></tr><tr><td>{{ \'settings_colors_background\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_BACKGROUND)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_BACKGROUND] }"></div></td></tr><tr><td>{{ \'settings_colors_province\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_PROVINCE)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_PROVINCE] }"></div></td></tr><tr><td>{{ \'settings_colors_continent\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_CONTINENT)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_CONTINENT] }"></div></td></tr><tr><td>{{ \'settings_colors_cross\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_CROSS)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_CROSS] }"></div></td></tr><tr><td>{{ \'settings_colors_quick_highlight\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_QUICK_HIGHLIGHT)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_QUICK_HIGHLIGHT] }"></div></td></tr><tr><td>{{ \'settings_colors_ghost\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_GHOST)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_GHOST] }"></div></td></tr></tbody></table></div></div></div></div><footer class="win-foot" ng-show="selectedTab === TAB_TYPES.SETTINGS"><ul class="list-btn list-center"><li><a href="#" class="btn-border btn-red" ng-click="resetSettings()">{{ \'reset\' | i18n:loc.ale:textObjectCommon }}</a></li><li><a href="#" class="btn-border btn-green" ng-click="saveSettings()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li></ul></footer></div>'),g.addStyle("#map-tooltip{z-index:1000}#two-minimap .minimap{position:absolute;left:0;top:38px;z-index:5}#two-minimap .cross{position:absolute;left:0;top:38px;z-index:6}#two-minimap .box-paper:not(.footer) .scroll-wrap{margin-bottom:40px}#two-minimap span.select-wrapper{width:100%}#two-minimap .add-highlight input{width:100%}#two-minimap .open-profile:hover{font-weight:bold;text-shadow:-1px 1px 0 #e0cc97}")}}),define("two/ui2",["conf/conf","conf/cdn"],function(e,t){var a={},n={},o=document.querySelector("head"),l=injector.get("httpService"),r=injector.get("templateManagerService"),s=injector.get("$templateCache");return r.load=function(a,o,r){var c,d=function(e,t,a,n){s.put(c.substr(1),e),angular.isFunction(o)&&o(e,t,a,n),i.$$phase||i.$apply()};c=0!==a.indexOf("!")?e.TEMPLATE_PATH_EXT.join(a):a.substr(1),s.get(c.substr(1))?d(s.get(c.substr(1)),304):t.versionMap[c]?l.get(c,d,function(e,t,i,a){angular.isFunction(r)&&r(e,t,i,a)}):d(n[c],304)},a.addTemplate=function(e,t){n[e]=t},a.addStyle=function(e){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),o.appendChild(t)},a}),define("two/ui/autoComplete",["two/utils","helper/dom","struct/MapData"],function(t,a,n){var s="two-autocomplete",c=!1,d=function(e){var i=e.srcElement||e.target;t.matchesElem(i,".custom-select")||u.hide()},u={hide:function(){i.$broadcast(r.SELECT_HIDE,s),$(e).off("click",d),$(".win-main").off("mousewheel",u.hide),c=!1}};return u.show=function(t,a,n,o){return s=n,!!t.length&&(i.$broadcast(r.SELECT_SHOW,s,t,null,function(e){!function(e,t){u.hide(),i.$broadcast(r.SELECT_HIDE,s),i.$broadcast(r.SELECT_SELECTED,s,e,t)}(e,o)},a,!0,0,_("i18n")("no-results",i.loc.ale,"common")),c||(c=!0,$(".win-main").on("mousewheel",u.hide),$(e).on("click",d)),!0)},u.search=function(e,i,a,r){var s=[];if(t.isValidCoords(e)){var c=e.split("|").map(function(e){return parseInt(e,10)});n.loadTownDataAsync(c[0],c[1],1,1,function(e){e&&s.push({id:e.id,type:"village",name:t.genVillageLabel(e),raw:e}),i(s)})}else o.emit(l.AUTOCOMPLETE,{types:a||["village","character","tribe"],string:e,amount:r||5},function(e){for(var a in e.result)e.result[a].forEach(function(e,i){"village"===a&&(e.raw=angular.copy(e),e.name=t.genVillageLabel(e)),e.type=a,e.leftIcon="size-34x34 icon-26x26-rte-"+a,s.push(e)});i(s)})},u}),define("two/FrontButton",[],function(){function e(e,t){this.options=t=angular.merge({label:e,className:"",classHover:"expand-button",classBlur:"contract-button",tooltip:!1,onClick:function(){}},t),this.buildWrapper(),this.appendButton();var a=this.$elem,n=a.querySelector(".label"),o=a.querySelector(".quickview");return t.classHover&&a.addEventListener("mouseenter",function(){a.classList.add(t.classHover),a.classList.remove(t.classBlur),n.style.display="none",o.style.display=""}),t.classBlur&&a.addEventListener("mouseleave",function(){a.classList.add(t.classBlur),a.classList.remove(t.classHover),o.style.display="none",n.style.display=""}),t.tooltip&&(a.addEventListener("mouseenter",function(e){i.$broadcast(r.TOOLTIP_SHOW,"twoverflow-tooltip",t.tooltip,!0,e)}),a.addEventListener("mouseleave",function(){i.$broadcast(r.TOOLTIP_HIDE,"twoverflow-tooltip")})),t.onClick&&a.addEventListener("click",t.onClick),this}return e.prototype.updateQuickview=function(e){this.$elem.querySelector(".quickview").innerHTML=e},e.prototype.hover=function(e){this.$elem.addEventListener("mouseenter",e)},e.prototype.click=function(e){this.$elem.addEventListener("click",e)},e.prototype.buildWrapper=function(){var e=document.getElementById("two-bar");e||((e=document.createElement("div")).id="two-bar",document.querySelector("#wrapper").appendChild(e)),this.$wrapper=e},e.prototype.appendButton=function(){var e=document.createElement("div");e.innerHTML='<div class="btn-border btn-green button '+this.options.className+'"><div class="top-left"></div><div class="top-right"></div><div class="middle-top"></div><div class="middle-bottom"></div><div class="middle-left"></div><div class="middle-right"></div><div class="bottom-left"></div><div class="bottom-right"></div><div class="label">'+this.options.label+'</div><div class="quickview"></div></div>';var t=e.children[0];this.$wrapper.appendChild(t),this.$elem=t},e.prototype.destroy=function(){this.$elem.remove()},e}),require(["two/ui2"],function(e){e.addStyle(".two-window a.select-handler{-webkit-box-shadow:none;box-shadow:none}.two-window .small-select a.select-handler{height:22px;line-height:22px}.two-window .small-select a.select-button{height:22px}.two-window input::placeholder{color:rgba(255,243,208,0.7)}.two-window .green{color:#07770b}.two-window .red{color:#770707}.two-window .blue{color:#074677}#toolbar-left{height:calc(100% - 358px) !important;top:250px !important}#two-bar{position:absolute;top:110px;left:5px;margin-bottom:7px;z-index:10;width:100px}#two-bar .button{white-space:nowrap;position:relative;top:-17px;left:0px;min-width:70px;height:24px;padding:0 3px}#two-bar .label,#two-bar .quickview{margin:5px 0;font-size:12px}#two-bar .quickview{display:none}#wrapper.window-open #two-bar .button{left:715px}")})}(this);
//# sourceMappingURL=tw2overflow.map